var Oo=Object.defineProperty;var Ro=(e,t,o)=>t in e?Oo(e,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[t]=o;var c=(e,t,o)=>(Ro(e,typeof t!="symbol"?t+"":t,o),o);import{n as nt,l as f,c as d,w as A,a as re,b as Do,d as $,o as G,r as L,e as V,f as u,g as v,h as Y,F as x,i as S,j as T,t as Ho,k as M,m as I,p as h,q as le,s as B,v as ct,u as te,x as J,y as xo,z as no,A as wt,B as Rt,C as Q,D as Bo,E as Wo,G as Zo,H as Z,I as mt,J as F,K as Vo,L as jo,M as Fo,N as Go,O as qo,P as Ko,Q as Yo,V as Qo}from"./vendor-a196f4dd.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))a(r);new MutationObserver(r=>{for(const n of r)if(n.type==="childList")for(const s of n.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&a(s)}).observe(document,{childList:!0,subtree:!0});function o(r){const n={};return r.integrity&&(n.integrity=r.integrity),r.referrerPolicy&&(n.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?n.credentials="include":r.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function a(r){if(r.ep)return;r.ep=!0;const n=o(r);fetch(r.href,n)}})();const Jo=["chatNoMessages","chatTitle","chatLogin","chatSend","chatPlaceholder","chatErrorDisabled","chatErrorUnknown","serversHeading","markersHeading","markersSkeleton","markersSetSkeleton","markersUnnamed","markersSearchPlaceholder","markersSearchSkeleton","worldsSkeleton","playersSkeleton","playersTitle","playersTitleHidden","playersTitleOtherWorld","playersSearchPlaceholder","playersSearchSkeleton","followingHeading","followingUnfollow","followingTitleUnfollow","followingHidden","linkTitle","loadingTitle","locationRegion","locationChunk","contextMenuCopyLink","contextMenuCenterHere","toggleTitle","mapTitle","layersTitle","copyToClipboardSuccess","copyToClipboardError","loginTitle","loginHeading","loginUsernameLabel","loginPasswordLabel","loginSubmit","loginErrorUnknown","loginErrorDisabled","loginErrorIncorrect","loginSuccess","registerHeading","registerDescription","registerConfirmPasswordLabel","registerCodeLabel","registerSubmit","registerErrorUnknown","registerErrorDisabled","registerErrorVerifyFailed","registerErrorIncorrect","logoutTitle","logoutErrorUnknown","logoutSuccess","closeTitle","showMore","day","night","nightDay"],Xo=["chatPlayerJoin","chatPlayerQuit","chatAnonymousJoin","chatAnonymousQuit","chatErrorNotAllowed","chatErrorRequiresLogin","chatErrorCooldown","worldsHeading","playersHeading"];class ue extends Error{constructor(t){super(t),this.name=""}}const ea=document.createRange(),ta=/<br ?\/?>/g,so=/ยง[0-9a-f]/ig,oa=/[_\s]?nether([\s_]|$)/i,aa=/(^|[_\s])end([\s_]|$)/i,Dt=e=>{const t=e>=0&&e<13700;return{serverTime:e,days:Math.floor((e+8e3)/24e3),hours:(Math.floor(e/1e3)+6)%24,minutes:Math.floor(e/1e3%1*60),seconds:Math.floor(e/1e3%1*60%1*60),day:t,night:!t}},ra=e=>{const t=new URLSearchParams(e.search),o=e.hash.replace("#","");return o?na(o):sa(t)},na=e=>{let t,o,a,r;if(e=e.replace("#",""),e[0]==="/"&&e.split("/").length===7){const n=e.split("/");r=void 0,t=n[5],o=n[6],a=[n[1],n[2],n[3]].map(s=>parseFloat(s)).filter(s=>!isNaN(s)&&isFinite(s))}else{const n=e.split(";");t=n[0]||void 0,o=n[1]||void 0,a=(n[2]||"").split(",").map(s=>parseFloat(s)).filter(s=>!isNaN(s)&&isFinite(s)),r=typeof n[3]<"u"?parseInt(n[3]):void 0}return io({world:t?decodeURIComponent(t):void 0,map:o?decodeURIComponent(o):void 0,location:a.length===3?{x:a[0],y:a[1],z:a[2]}:void 0,zoom:r,legacy:!1})},sa=e=>{let t=e.get("worldname")||e.get("world")||void 0,o=e.has("worldname")&&e.get("mapname")||void 0;const a=[e.get("x")||"",e.get("y")||"64",e.get("z")||""].map(n=>parseFloat(n)).filter(n=>!isNaN(n)&&isFinite(n)),r=e.has("zoom")?parseInt(e.get("zoom")):void 0;return t=t?decodeURIComponent(t):void 0,o=o?decodeURIComponent(o):void 0,io({world:t,map:o,location:a.length===3?{x:a[0],y:a[1],z:a[2]}:void 0,zoom:r,legacy:!0})},io=e=>(typeof e.zoom<"u"&&(isNaN(e.zoom)||e.zoom<0||!isFinite(e.zoom))&&(e.zoom=void 0),e.world?e:null),lo=(e,t,o)=>{const a=Math.round(t.x),r=Math.round(t.y),n=Math.round(t.z),s=`${a},${r},${n}`;return e?`#${e.world.name};${e.name};${s};${o}`:""},de=(e,t,o)=>{try{const a=new URL(e,window.location.href);a.origin!==window.location.origin&&console.warn(`[${t}]: ${o} URL is on a different origin to LiveAtlas (${a.origin} vs ${window.location.origin}).
Ensure you have configured appropriate CORS headers (https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS)`)}catch{throw console.error(`[${t}]: ${o} URL (${e}) is missing or invalid.`),new ue(`${o} URL is missing or invalid`)}},ia=e=>{const t=document.querySelector(e);t&&t.focus()},Xt=document.createElement("textarea"),la=e=>(Xt.innerHTML=e,Xt.textContent||""),ae=e=>ea.createContextualFragment(e.replace(ta,"&nbsp;")).textContent||"",Vt=e=>()=>nt(e.state.messages.copyToClipboardSuccess),jt=e=>t=>{nt({type:"error",text:e.state.messages.copyToClipboardError}),console.error("Error copying to clipboard",t)},da=(e={})=>Object.assign(eo(Jo,e),eo(Xo,e)),eo=(e,t={})=>{const o={};for(const a of e)o[a]=typeof t[a]=="string"&&t[a]?t[a]:`Missing message: ${a}`;return o},co=(e,t,o)=>({min:{x:Math.min.apply(null,e),y:Math.min.apply(null,t),z:Math.min.apply(null,o)},max:{x:Math.max.apply(null,e),y:Math.max.apply(null,t),z:Math.max.apply(null,o)}}),Ht=e=>{const t={max:{x:-1/0,y:-1/0,z:-1/0},min:{x:1/0,y:1/0,z:1/0}},o=a=>{Array.isArray(a)?a.map(o):(t.max.x=Math.max(a.x,t.max.x),t.max.y=Math.max(a.y,t.max.y),t.max.z=Math.max(a.z,t.max.z),t.min.x=Math.min(a.x,t.min.x),t.min.y=Math.min(a.y,t.min.y),t.min.z=Math.min(a.z,t.min.z))};return e.map(o),t},pt=e=>({x:e.min.x+(e.max.x-e.min.x)/2,y:e.min.y+(e.max.y-e.min.y)/2,z:e.min.z+(e.max.z-e.min.z)/2}),ca=async()=>{const e=document.createElement("iframe");return e.hidden=!0,e.sandbox.add("allow-scripts"),e.srcdoc=`<script>window.addEventListener("message", function(e) {	
		if(!e.data?.key) {
			console.warn('Ignoring postmessage without key');
			return;
		}
		
	 	try {
			e.source.postMessage({
				key: e.data.key,
				success: true,
				result: Function('', "'use strict';" + e.data.code)(),
			}, e.origin);
	 	} catch(ex) {
			e.source.postMessage({
				key: e.data.key,
				success: false,
				error: ex
			}, e.origin);
	 	}
	})<\/script>`,window.addEventListener("message",t=>{var o;if(t.origin!=="null"||t.source!==e.contentWindow){console.warn("Ignoring postmessage with invalid source");return}if(!((o=t.data)!=null&&o.key)){console.warn("Ignoring postmessage without key");return}if(!xt.has(t.data.key)){console.warn("Ignoring postmessage with invalid key");return}t.data.success?xt.get(t.data.key).call(void 0,t.data.result):mo.get(t.data.key).call(void 0,t.data.error)}),new Promise(t=>{document.body.appendChild(e),e.onload=()=>{t(e.contentWindow)}})};let Ut=null;const xt=new Map,mo=new Map,ft=async e=>(Ut||(Ut=await ca()),new Promise((t,o)=>{const a=Math.random();xt.set(a,t),mo.set(a,o),Ut.postMessage({key:a,code:e},"*")})),po=e=>{let t="overworld";return oa.test(e)||e=="DIM-1"?t="nether":(aa.test(e)||e=="DIM1")&&(t="end"),t},ma={playerMarkersEnabled(e){return e.components.players.markers!==void 0},markerUIEnabled(e){return!e.ui.disableMarkerUI},coordinatesControlEnabled(e){return e.components.coordinatesControl!==void 0},clockControlEnabled(e){return e.components.clockControl!==void 0},loginEnabled(e){return e.components.login||e.loginRequired},night(e){return Dt(e.currentWorldState.timeOfDay||0).night},mapBackground(e){return e.currentMap?e.currentMap.nightAndDay?Dt(e.currentWorldState.timeOfDay||0).night?e.currentMap.backgroundNight||e.currentMap.background||"transparent":e.currentMap.backgroundDay||e.currentMap.background||"transparent":e.currentMap.background||"transparent":"transparent"},url(e){return!e.currentWorld||!e.currentMap?"":lo(e.currentMap,e.currentLocation,e.currentZoom)},pageTitle(e){var t,o;return e.configuration.title.replace(/{world}/gi,((t=e.currentWorld)==null?void 0:t.displayName)||"No world").replace(/{map}/gi,((o=e.currentMap)==null?void 0:o.displayName)||"No map")},playersHeading(e){return e.messages.playersHeading.replace("{cur}",e.players.size.toString()).replace("{max}",e.maxPlayers.toString())}};var m=(e=>(e.SET_UI_CONFIGURATION="setUIConfiguration",e.SET_MESSAGES="setMessages",e.SET_SERVERS="setServers",e.SET_SERVER_CONFIGURATION="setServerConfiguration",e.SET_SERVER_CONFIGURATION_HASH="setServerConfigurationHash",e.SET_WORLDS="setWorlds",e.SET_COMPONENTS="setComponents",e.SET_MARKER_SETS="setMarkerSets",e.SET_MARKERS="setMarkers",e.SET_WORLD_STATE="setWorldState",e.ADD_MARKER_SET_UPDATES="addMarkerSetUpdates",e.ADD_MARKER_UPDATES="addMarkerUpdates",e.ADD_TILE_UPDATES="addTileUpdates",e.ADD_CHAT="addChat",e.POP_MARKER_UPDATES="popMarkerUpdates",e.POP_TILE_UPDATES="popTileUpdates",e.SET_MAX_PLAYERS="setMaxPlayers",e.SET_PLAYERS_ASYNC="setPlayersAsync",e.SYNC_PLAYERS="syncPlayers",e.SET_LOADED="setLoaded",e.SET_CURRENT_SERVER="setCurrentServer",e.SET_CURRENT_MAP="setCurrentMap",e.SET_CURRENT_LOCATION="setCurrentLocation",e.SET_CURRENT_ZOOM="setCurrentZoom",e.SET_PARSED_URL="setParsedUrl",e.CLEAR_PARSED_URL="clearParsedUrl",e.SET_FOLLOW_TARGET="setFollowTarget",e.SET_VIEW_TARGET="setViewTarget",e.CLEAR_FOLLOW_TARGET="clearFollow",e.CLEAR_VIEW_TARGET="clearViewTarget",e.SET_SCREEN_SIZE="setScreenSize",e.TOGGLE_UI_ELEMENT_VISIBILITY="toggleUIElementVisibility",e.SET_UI_ELEMENT_VISIBILITY="setUIElementVisibility",e.SHOW_UI_MODAL="showUIModal",e.HIDE_UI_MODAL="hideUIModal",e.TOGGLE_SIDEBAR_SECTION_COLLAPSED_STATE="toggleSidebarSectionCollapsedState",e.SET_LOGGED_IN="setLoggedIn",e.SET_LOGIN_REQUIRED="setLoginRequired",e.RESET="reset",e))(m||{});const St="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAMAAAAoLQ9TAAAAXVBMVEUrHQ1DIAxsQi29jXOqfWYnGwr///9SPYm7iXK0hG20e2ScaUyQXkCKTD2CVDpAKhMzJBEvHw7GloC3gnKtgG22iWy+iGycclysdlqiakecY0aWX0CAUzR6TjMkGAjN/gIgAAAAbElEQVQY02XKRw7AIAxEUTuYGkJI79z/mDESO39pNk8D0wQ8rUvRGjgBrZxHDqCihG1Tap4Vd545SyDynmhdj8O5npPgvTHWhuCctcYQSbjvEJal4/b9ut5XQozPgzhwiDGmJKGesZXS9wn4AR4zCfm0oDjBAAAAAElFTkSuQmCC",vt=new Map,yt=new Map,kt=new Set,Bt=[],uo=e=>{switch(e){case"large":case"body":return 32;case"small":default:return 16}},ho=(e,t)=>{const o=typeof e=="string"?e:e.name,a=typeof e=="string"?void 0:e.uuid,r=`${o}-${t}`;if(vt.has(r))return Promise.resolve(vt.get(r));if(yt.has(r))return yt.get(r);const n=new Promise((s,i)=>{const l=new Image;l.onload=function(){vt.set(r,l),kt.delete(r),_t(),s(l)},l.onerror=function(p){console.warn(`Failed to retrieve face of ${o} with size ${t}!`),kt.delete(r),_t(),i(p)},Bt.push({name:o,uuid:a,size:t,cacheKey:r,image:l})}).finally(()=>yt.delete(r));return yt.set(r,n),_t(),n},ut=()=>St,_t=()=>{if(kt.size>8||!Bt.length)return;const e=Bt.pop();kt.add(e.cacheKey),e.image.src=E().state.components.players.imageUrl(e),_t()},to=()=>{vt.clear()},pa={version:"git-7ce444",firstLoad:!0,initialTitle:document.title,servers:new Map,configuration:{defaultMap:"",defaultWorld:"",defaultZoom:0,followMap:"",followZoom:0,title:"",expandUI:!1,singleMapWorlds:!1},configurationHash:void 0,messages:da(),loggedIn:!1,loginRequired:!1,worlds:new Map,maps:new Map,players:new Map,sortedPlayers:[],maxPlayers:0,chat:{unread:0,messages:[]},markerSets:new Map,pendingMarkerUpdates:[],pendingTileUpdates:[],components:{markers:{showLabels:!1},nightDay:{mode:"night_day",value:-1},players:{markers:void 0,grayHiddenPlayers:!0,showImages:!1,imageUrl:ut},coordinatesControl:void 0,clockControl:void 0,linkControl:!1,layerControl:!1,logoControls:[],chatSending:void 0,chatBox:void 0,chatBalloons:!1,login:!1},followTarget:void 0,viewTarget:void 0,currentMapProvider:void 0,currentServer:void 0,currentWorld:void 0,currentMap:void 0,currentLocation:{x:0,y:0,z:0},currentZoom:0,currentWorldState:{raining:!1,thundering:!1,timeOfDay:0},ui:{playersAboveMarkers:!0,playersSearch:!0,compactPlayerMarkers:!1,disableContextMenu:!1,disableMarkerUI:!1,customLoginUrl:null,screenWidth:window.innerWidth,screenHeight:window.innerHeight,smallScreen:!1,visibleElements:new Set,visibleModal:void 0,previouslyVisibleElements:new Set,sidebar:{servers:{},players:{},maps:{},markers:{}}}},K=Object.freeze({markers:new Map});var D=(e=>(e.INIT="init",e.LOAD_CONFIGURATION="loadConfiguration",e.START_UPDATES="startUpdates",e.STOP_UPDATES="stopUpdates",e.SET_PLAYERS="setPlayers",e.POP_MARKER_UPDATES="popMarkerUpdates",e.POP_TILE_UPDATES="popTileUpdates",e.SEND_CHAT_MESSAGE="sendChatMessage",e.LOGIN="login",e.LOGOUT="logout",e.REGISTER="register",e))(D||{});class bt extends Error{constructor(t){super(t),this.name="ChatError"}}class he{constructor(t,o){c(this,"store",E());c(this,"name");c(this,"config");this.name=t,this.config=o}async populateWorld(t){}async populateMap(t){}startUpdates(){}stopUpdates(){}sendChatMessage(t){throw new Error("Provider does not support chat")}async login(t){throw new Error("Provider does not support logging in")}async logout(){throw new Error("Provider does not support logging out")}async register(t){throw new Error("Provider does not support registration")}static async fetch(t,o){let a;try{a=await fetch(t,o)}catch(r){throw r instanceof DOMException&&r.name==="AbortError"?(console.warn(`Request aborted (${t}`),r):(console.error(r),new Error("Network request failed"))}if(!a.ok)throw new Error(`Network request failed (${a.statusText||"Unknown"})`);return a}static async fetchText(t,o){const a=await this.fetch(t,o);let r;try{r=await a.text()}catch(n){throw n instanceof DOMException&&n.name==="AbortError"&&console.warn(`Request aborted (${t}`),n}return r}static async fetchJSON(t,o){const a=await this.fetch(t,o);let r;try{r=await a.json()}catch(n){throw n instanceof DOMException&&n.name==="AbortError"?(console.warn(`Request aborted (${t}`),n):new Error("Request returned invalid json")}return r}static async getText(t,o){return he.fetchText(t,{signal:o,credentials:"include"})}static async getJSON(t,o){return he.fetchJSON(t,{signal:o,credentials:"include"})}}class Ft extends f.Polyline{constructor(t,o){super(t,o.style),this.options.minZoom=o.minZoom,this.options.maxZoom=o.maxZoom}}class go extends f.Polygon{constructor(t,o){super(t,o.style)}}const st={direction:"top",sticky:!0,opacity:1,interactive:!1},ua=(e,t)=>JSON.stringify(e)===JSON.stringify(t),ha=(e,t)=>e&&t&&e.color===t.color&&e.weight===t.weight&&e.opacity===t.opacity&&e.fillColor===t.fillColor&&e.fillOpacity===t.fillOpacity,it=(e,t)=>{const o=document.createElement("span");return e.isPopupHTML?(o.classList.add(t),o.insertAdjacentHTML("afterbegin",e.popup)):o.textContent=e.popup,o},fo=(e,t)=>{const o=!e.style.fillOpacity||e.style.fillOpacity<=0,a=e.points.map(Gt,t),r=o?new Ft(a,e):new go(a,e);return e.popup&&r.bindPopup(()=>it(e,"AreaPopup")),e.tooltip&&r.bindTooltip(()=>e.tooltipHTML||e.tooltip,st),r},ga=(e,t,o)=>{if(!e)return fo(t,o);const a=t.points.map(Gt,o),r=e.getLatLngs();let n=!1;return ha(e.options,t.style)||(e.setStyle(t.style),n=!0),ua(r.length===1?r[0]:r,a)||(e.setLatLngs(a),n=!0),e.closePopup(),e.unbindPopup(),e.closeTooltip(),e.unbindTooltip(),t.popup&&e.bindPopup(()=>it(t,"AreaPopup")),t.tooltip&&e.bindTooltip(()=>t.tooltipHTML||t.tooltip,st),n&&e.redraw(),e},Gt=function(e){return Array.isArray(e)?e.map(Gt,this):this(e)},fa=(e,t,o,a)=>e.length===2?t[0]===t[1]?wa(e,t,o,a):ya(e,t,o):t[0]===t[1]?_a(e,t,o,a):va(e,t,o),ya=(e,t,o)=>{const a=e[0],r=e[1],n=t[0],s=t[1],i=o[0],l=o[1];return[[{x:r,y:s,z:l},{x:a,y:s,z:l},{x:a,y:s,z:i},{x:r,y:s,z:i}],[{x:r,y:n,z:l},{x:a,y:n,z:l},{x:a,y:n,z:i},{x:r,y:n,z:i}],[{x:r,y:s,z:l},{x:r,y:n,z:l},{x:a,y:n,z:l},{x:a,y:s,z:l}],[{x:a,y:s,z:l},{x:a,y:n,z:l},{x:a,y:n,z:i},{x:a,y:s,z:i}],[{x:r,y:s,z:i},{x:r,y:n,z:i},{x:a,y:n,z:i},{x:a,y:s,z:i}],[{x:r,y:s,z:l},{x:r,y:n,z:l},{x:r,y:n,z:i},{x:r,y:s,z:i}]]},wa=(e,t,o,a)=>{const r=e[0],n=e[1],s=t[1],i=o[0],l=o[1];return a?[{x:n,y:s,z:l},{x:r,y:s,z:l},{x:r,y:s,z:i},{x:n,y:s,z:i},{x:n,y:s,z:l}]:[{x:n,y:s,z:l},{x:r,y:s,z:l},{x:r,y:s,z:i},{x:n,y:s,z:i}]},va=(e,t,o)=>{const a=[],r=[],n=[];for(let s=0;s<e.length;s++)a[s]={x:e[s],y:t[0],z:o[s]},r[s]={x:e[s],y:t[1],z:o[s]};for(let s=0;s<e.length;s++)n[s]=[a[s],r[s],r[(s+1)%e.length],a[(s+1)%e.length]];return n[e.length]=r,n[e.length+1]=a,n},_a=(e,t,o,a)=>{const r=[];for(let n=0;n<e.length;n++)r[n]={x:e[n],y:t[1],z:o[n]};return a&&r.push(r[0]),r},yo=(e,t)=>{const o=e.points.map(qt,t),a=new Ft(o,e);return e.popup&&a.bindPopup(()=>it(e,"LinePopup")),e.tooltip&&a.bindTooltip(()=>e.tooltipHTML||e.tooltip,st),a},ba=(e,t,o)=>e?(e.closePopup(),e.unbindPopup(),e.closeTooltip(),e.unbindTooltip(),t.popup&&e.bindPopup(()=>it(t,"AreaPopup")),t.tooltip&&e.bindTooltip(()=>t.tooltipHTML||t.tooltip,st),e.setStyle(t.style),e.setLatLngs(t.points.map(qt,o)),e.redraw(),e):yo(t,o),qt=function(e){return Array.isArray(e)?qt(e):this(e)},Sa=(e,t,o)=>{const a=[];for(let r=0;r<e.length;r++)a.push({x:e[r],y:t[r],z:o[r]});return a};class $t{constructor(t){c(this,"world");c(this,"appendedWorld");c(this,"name");c(this,"displayName");c(this,"icon");c(this,"baseUrl");c(this,"imageFormat");c(this,"tileSize");c(this,"projection");c(this,"prefix");c(this,"background");c(this,"nightAndDay");c(this,"backgroundDay");c(this,"backgroundNight");c(this,"nativeZoomLevels");c(this,"extraZoomLevels");c(this,"minZoom");c(this,"maxZoom");c(this,"defaultZoom");c(this,"tileUpdateInterval");c(this,"center");c(this,"overlays");c(this,"scale");this.world=t.world,this.appendedWorld=t.appendedWorld,this.name=t.name,this.displayName=t.displayName||"",this.icon=t.icon||void 0,this.background=t.background||"#000000",this.nightAndDay=t.nightAndDay||!1,this.backgroundDay=t.backgroundDay||"#000000",this.backgroundNight=t.backgroundNight||"#000000",this.baseUrl=t.baseUrl,this.imageFormat=t.imageFormat,this.tileSize=t.tileSize,this.projection=t.projection||void 0,this.prefix=t.prefix||"",this.nativeZoomLevels=t.nativeZoomLevels||1,this.extraZoomLevels=t.extraZoomLevels||0,this.minZoom=t.minZoom||0,this.maxZoom=t.maxZoom||void 0,this.defaultZoom=t.defaultZoom||void 0,this.tileUpdateInterval=t.tileUpdateInterval||void 0,this.center=t.center||void 0,this.overlays=t.overlays||new Map,this.scale=1/Math.pow(2,this.nativeZoomLevels)}locationToLatLng(t){return this.projection?this.projection.locationToLatLng(t):new f.LatLng(-t.z*this.scale,t.x*this.scale)}latLngToLocation(t,o){return this.projection?this.projection.latLngToLocation(t,o):{x:t.lng/this.scale,y:o,z:-t.lat/this.scale}}hasCustomIcon(){return!!this.icon&&!this.icon.startsWith("liveatlas_")}getIcon(){let t,o;if(this.icon)return this.icon.startsWith("liveatlas_")?this.icon.replace("liveatlas_",""):this.icon;const a=this.name.split(/[^a-zA-Z\d]/,1)[0];if(["biome"].includes(a))t="world",o=a;else switch(this.world.dimension){case"nether":t="nether",o=["surface","nether"].includes(a)?"surface":"flat";break;case"end":t="the_end",o=["surface","the_end"].includes(a)?"surface":"flat";break;case"overworld":default:t="world",o=["surface","flat","cave"].includes(a)?a:"flat";break}return`block_${t}_${o}`}}const wo=(e,t)=>{const o=!e.style.fillOpacity||e.style.fillOpacity<=0,a=vo(e,t,o),r=o?new Ft(a,e):new go(a,e);return e.popup&&r.bindPopup(()=>it(e,"CirclePopup")),e.tooltip&&r.bindTooltip(()=>e.tooltipHTML||e.tooltip,st),r},ka=(e,t,o)=>{if(!e)return wo(t,o);const a=t.style&&t.style.fillOpacity&&t.style.fillOpacity<=0;return e.closePopup(),e.unbindPopup(),e.closeTooltip(),e.unbindTooltip(),t.popup&&e.bindPopup(()=>it(t,"AreaPopup")),t.tooltip&&e.bindTooltip(()=>t.tooltipHTML||t.tooltip,st),e.setStyle(t.style),e.setLatLngs(vo(t,o,a)),e.redraw(),e},vo=(e,t,o)=>{const a=[];for(let r=0;r<360;r++){const n=r*Math.PI/180,s=e.radius[0]*Math.sin(n)+e.location.x,i=e.radius[1]*Math.cos(n)+e.location.z;a.push(t({x:s,y:e.location.y,z:i}))}return o&&a.length&&a.push(a[0]),a},_o=document.createElement("div");_o.className="marker";const bo=document.createElement("img");bo.className="marker__icon";const So=document.createElement("span");So.className="marker__label";const Ea={iconUrl:"default",label:"",iconSize:void 0,popupAnchor:[0,0],iconAnchor:[0,0],tooltipAnchor:[0,0],isHtml:!1,className:""};class ko extends f.Layer{constructor(o){super(o);c(this,"_image");c(this,"_label");c(this,"_container");c(this,"_labelCreated",!1);c(this,"_onHover",()=>{this.createLabel()});f.Util.setOptions(this,Object.assign(Ea,o))}createIcon(o){o&&o.remove();const a=_o.cloneNode(!1);return this._image=bo.cloneNode(!1),a.appendChild(this._image),a.classList.add("marker","leaflet-marker-icon"),this.options.className&&a.classList.add(this.options.className),this._image.addEventListener("mouseover",this._onHover),this._container=a,this.update(),a}createLabel(){var o;!this._container||this._labelCreated||((o=this._image)==null||o.removeEventListener("mouseover",this._onHover),this._label=So.cloneNode(!1),this.update(),this._container.appendChild(this._label),this._labelCreated=!0)}removeLabel(){!this._container||!this._labelCreated||(this._label.remove(),this._label=void 0,this._labelCreated=!1)}update(o){if(o&&(this.options.iconUrl=o.iconUrl,this.options.iconSize=o.iconSize,this.options.iconAnchor=o.iconAnchor,this.options.isHtml=o.isHtml,this.options.label=o.label),!!this._container){if(this._container.classList.toggle("marker--auto-size",!this.options.iconSize),this._image){const a=this.options.iconSize?f.point(this.options.iconSize):void 0,r=this.options.iconAnchor?f.point(this.options.iconAnchor):void 0,n=r?-r.x:a?-(a.x/2):0,s=r?-r.y:a?-(a.y/2):0;a?(this._image.width=a.x,this._image.height=a.y):(this._image.removeAttribute("width"),this._image.removeAttribute("height")),this._container.style.marginLeft=n?`${n}px`:"",this._container.style.marginTop=s?`${s}px`:"",this._container.style.height=a?`${a.y}px`:"auto",this._image.src!==this.options.iconUrl&&(this._image.src=this.options.iconUrl)}this._label&&(this.options.isHtml&&this._label.innerHTML!==this.options.label?this._label.innerHTML=this.options.label:this._label.textContent!==this.options.label&&(this._label.textContent=this.options.label))}}}class Et extends f.Marker{constructor(t,o){super(t,{}),this.options.icon=new ko({iconUrl:o.iconUrl,label:o.tooltipHTML||o.tooltip,iconSize:o.iconSize,iconAnchor:o.iconAnchor,isHtml:!!o.tooltipHTML}),this.options.maxZoom=o.maxZoom,this.options.minZoom=o.maxZoom}_resetZIndex(){}getIcon(){return this.options.icon}createLabel(){this.options.icon.createLabel()}removeLabel(){this.options.icon.createLabel()}onRemove(t){return this.options.icon.removeLabel(),super.onRemove(t),this}}const Eo=(e,t)=>{const o=new Et(t(e.location),e);return o.on("click",a=>{(!a.target.getPopup()||a.target.isPopupOpen())&&a.target._map.panTo(a.target.getLatLng())}),e.popup&&o.bindPopup(()=>Lo(e)),o},La=(e,t,o)=>{if(!e)return Eo(t,o);const a=e.getLatLng(),r=o(t.location);if(a.equals(r)||e.setLatLng(r),e instanceof Et){const n=e.getIcon();n&&n instanceof ko&&n.update({iconUrl:t.iconUrl,label:t.tooltipHTML||t.tooltip,iconSize:t.iconSize,iconAnchor:t.iconAnchor,isHtml:!!t.tooltipHTML})}return e.closePopup(),e.unbindPopup(),t.popup&&e.bindPopup(()=>Lo(t)),e},Lo=e=>{const t=document.createElement("span");return e.popup&&(t.classList.add("MarkerPopup"),t.insertAdjacentHTML("afterbegin",e.popup)),t};var W=(e=>(e[e.POINT=0]="POINT",e[e.AREA=1]="AREA",e[e.LINE=2]="LINE",e[e.CIRCLE=3]="CIRCLE",e))(W||{});let me=0,Wt;const Kt=new Set,pe={},Ca=()=>{const e=E();Wt=d(()=>e.state.pendingMarkerUpdates.length),A(Wt,(t,o)=>{t&&t>0&&o===0&&!me&&(me=requestAnimationFrame(()=>To()))})},Ma=()=>{me&&(cancelAnimationFrame(me),me=0)},Ta=e=>{Kt.add(e)},Ia=e=>{Kt.delete(e)},Co=(e,t)=>{pe[t]||(pe[t]=new Set),pe[t].add(e)},Mo=(e,t)=>{pe[t]&&pe[t].delete(e)},To=async()=>{const e=E(),t=await e.dispatch(D.POP_MARKER_UPDATES,10);for(const o of t)Kt.forEach(a=>a(o)),pe[o.set]&&pe[o.set].forEach(a=>a(o));Wt.value?me=requestAnimationFrame(()=>To()):me=0},$a=(e,t)=>{switch(e.type){case 0:return Eo(e,t);case 1:return fo(e,t);case 2:return yo(e,t);case 3:return wo(e,t)}},oo=(e,t,o)=>{switch(t.type){case 0:return La(e,t,o);case 1:return ga(e,t,o);case 2:return ba(e,t,o);case 3:return ka(e,t,o)}};class Aa{constructor(t){c(this,"mapToWorld");c(this,"worldToMap");c(this,"nativeZoomLevels");c(this,"tileSize");this.mapToWorld=t.mapToWorld||[0,0,0,0,0,0,0,0],this.worldToMap=t.worldToMap||[0,0,0,0,0,0,0,0],this.nativeZoomLevels=t.nativeZoomLevels||1,this.tileSize=t.tileSize}locationToLatLng(t){const o=this.worldToMap,a=o[3]*t.x+o[4]*t.y+o[5]*t.z,r=o[0]*t.x+o[1]*t.y+o[2]*t.z;return new f.LatLng(-((this.tileSize-a)/(1<<this.nativeZoomLevels)),r/(1<<this.nativeZoomLevels))}latLngToLocation(t,o){const a=this.mapToWorld,r=this.tileSize+t.lat*(1<<this.nativeZoomLevels),n=t.lng*(1<<this.nativeZoomLevels),s=a[0]*n+a[1]*r+a[2]*o,i=a[6]*n+a[7]*r+a[8]*o;return{x:s,y:o,z:i}}}function za(e){let t="Dynmap";e.title&&(t=e.title.replace(so,"")||t);const o=parseInt(e.followzoom||"",10);return{defaultMap:e.defaultmap||void 0,defaultWorld:e.defaultworld||void 0,defaultZoom:e.defaultzoom||0,followMap:e.followmap||void 0,followZoom:isNaN(o)?void 0:o,title:t,singleMapWorlds:!1,expandUI:!!e.sidebaropened&&e.sidebaropened!=="false"}}function Pa(e){return{chatPlayerJoin:e.joinmessage||"",chatPlayerQuit:e.quitmessage||"",chatAnonymousJoin:e["msg-hiddennamejoin"]||"",chatAnonymousQuit:e["msg-hiddennamequit"]||"",chatErrorNotAllowed:e["msg-chatnotallowed"]||"",chatErrorRequiresLogin:e["msg-chatrequireslogin"]||"",chatErrorCooldown:e.spammessage||"",worldsHeading:e["msg-maptypes"]||"",playersHeading:e["msg-players"]?`${e["msg-players"]} ({cur}/{max})`:""}}function Ua(e,t){const o=new Map;return(e.worlds||[]).forEach(a=>{o.set(a.name,{name:a.name,displayName:a.title||"",dimension:po(a.name),seaLevel:a.sealevel||64,maps:new Set})}),(e.worlds||[]).forEach(a=>{(a.maps||[]).forEach(r=>{const n=o.get(a.name),s=r.append_to_world||a.name,i=o.get(s);if(!i||!n){console.warn(`Ignoring map '${r.name}' associated with non-existent world '${s}'`);return}const l=128<<(r.tilescale||0),p=r.mapzoomout||1,g=Object.freeze(new $t({world:n,appendedWorld:n!==i?i:void 0,name:r.name||"(Unnamed map)",displayName:r.title,icon:r.icon||void 0,baseUrl:`${t.tiles}${encodeURIComponent(n.name)}/`,imageFormat:r["image-format"]||"png",tileSize:l,projection:new Aa({mapToWorld:r.maptoworld||void 0,worldToMap:r.worldtomap||void 0,nativeZoomLevels:p,tileSize:l}),prefix:r.prefix||"",background:r.background||"#000000",nightAndDay:r.nightandday,backgroundDay:r.backgroundday||"#000000",backgroundNight:r.backgroundnight||"#000000",center:{x:a.center.x||0,y:a.center.y||0,z:a.center.z||0},nativeZoomLevels:p,extraZoomLevels:r.mapzoomin}));n.maps.add(g),n!==i&&i.maps.add(g)})}),Array.from(o.values())}function Na(e,t){const o={markers:{showLabels:!1},nightDay:{mode:"night_day",value:-1},chatBox:void 0,chatBalloons:!1,players:{markers:void 0,grayHiddenPlayers:!1,imageUrl:a=>{const r=`${t.markers}faces/`;if(a.size==="body")return`${r}body/${a.name}.png`;const n=uo(a.size);return`${r}${n}x${n}/${a.name}.png`},showImages:e.showplayerfacesinmenu||!1},coordinatesControl:void 0,layerControl:!!e.showlayercontrol&&e.showlayercontrol!=="false",linkControl:!1,clockControl:void 0,logoControls:[],login:e["login-enabled"]||!1};return(e.components||[]).forEach(a=>{const r=a.type||"unknown";let n="large";switch(r){case"markers":o.markers={showLabels:a.showlabel||!1};break;case"playermarkers":a.showplayerfaces?a.smallplayerfaces?n="small":a.showplayerbody&&(n="body"):n="none",o.players.grayHiddenPlayers=e.grayplayerswhenhidden||!1,o.players.markers={hideByDefault:a.hidebydefault||!1,layerName:a.label||"Players",layerPriority:a.layerprio||0,imageSize:n,showHealth:a.showplayerhealth||!1,showArmor:a.showplayerhealth||!1,showYaw:!1};break;case"coord":o.coordinatesControl={showY:!a.hidey,label:a.label||"Location: ",showRegion:a["show-mcr"]||!1,showChunk:a["show-chunk"]||!1};break;case"link":o.linkControl=!0;break;case"digitalclock":o.clockControl={showDigitalClock:!0,showWeather:!1,showTimeOfDay:!1};break;case"timeofdayclock":o.clockControl={showTimeOfDay:!0,showDigitalClock:a.showdigitalclock||!1,showWeather:a.showweather||!1};break;case"logo":o.logoControls.push({text:a.text||"",url:a.linkurl||void 0,position:a.position.replace("-","")||"topleft",image:a.logourl||void 0});break;case"chat":e.allowwebchat&&(o.chatSending={loginRequired:e["webchat-requires-login"]||!1,maxLength:e.chatlengthlimit||256,cooldown:e["webchat-interval"]||5});break;case"chatbox":o.chatBox={allowUrlName:a.allowurlname||!1,showPlayerFaces:a.showplayerfaces||!1,messageLifetime:a.messagettl||1/0,messageHistory:a.scrollback||1/0};break;case"chatballoon":o.chatBalloons=!0}}),o}function Io(e,t){return{id:e,label:t.label||"Unnamed set",hidden:t.hide||!1,priority:t.layerprio||0,showLabels:t.showlabels||void 0,minZoom:typeof t.minzoom<"u"&&t.minzoom>-1?t.minzoom:void 0,maxZoom:typeof t.maxzoom<"u"&&t.maxzoom>-1?t.maxzoom:void 0}}function Oa(e,t,o){let a;for(const r in e)Object.prototype.hasOwnProperty.call(e,r)&&(a=`point_${r}`,t.set(a,$o(a,e[r],o)))}function $o(e,t,o){let a;t.dim&&(a=t.dim.split("x").filter(n=>!isNaN(Number(n))),a.length!==2&&(a=void 0));const r={id:e,type:W.POINT,location:{x:isNaN(t.x)?0:Number.isInteger(t.x)?t.x+.5:t.x,y:isNaN(t.y)?0:Number.isInteger(t.y)?t.y+.5:t.y,z:isNaN(t.z)?0:Number.isInteger(t.z)?t.z+.5:t.z},iconUrl:`${o.markers}_markers_/${t.icon||"default"}.png`,iconSize:a||[16,16],minZoom:typeof t.minzoom<"u"&&t.minzoom>-1?t.minzoom:void 0,maxZoom:typeof t.maxzoom<"u"&&t.maxzoom>-1?t.maxzoom:void 0,tooltip:t.markup?ae(t.label):t.label,tooltipHTML:t.markup?t.label:void 0,popup:t.desc||void 0,isPopupHTML:!0};return r.tooltipHTML||(r.tooltip=la(r.tooltip)),r}function Ra(e,t){let o;for(const a in e)Object.prototype.hasOwnProperty.call(e,a)&&(o=`area_${a}`,t.set(o,Ao(o,e[a])))}function Ao(e,t){const o=t.x||[0,0],a=[t.ybottom||0,t.ytop||0],r=t.z||[0,0],n=co(o,a,r),s=pt(n);return{id:e,type:W.AREA,style:{color:t.color||"#ff0000",opacity:t.opacity||1,weight:t.weight||1,fillColor:t.fillcolor||"#ff0000",fillOpacity:t.fillopacity||0},outline:!t.fillopacity,bounds:n,location:s,points:fa(o,a,r,!t.fillopacity),minZoom:typeof t.minzoom<"u"&&t.minzoom>-1?t.minzoom:void 0,maxZoom:typeof t.maxzoom<"u"&&t.maxzoom>-1?t.maxzoom:void 0,tooltip:t.markup?ae(t.label):t.label,tooltipHTML:t.markup?t.label:void 0,popup:t.desc||t.label||void 0,isPopupHTML:t.desc?!0:t.markup||!1}}function Da(e,t){let o;for(const a in e)Object.prototype.hasOwnProperty.call(e,a)&&(o=`line_${a}`,t.set(o,zo(o,e[a])))}function zo(e,t){const o=t.x||[0,0],a=t.y||[0,0],r=t.z||[0,0],n=co(o,a,r),s=pt(n);return{id:e,type:W.LINE,style:{color:t.color||"#ff0000",opacity:t.opacity||1,weight:t.weight||1},location:s,bounds:n,points:Sa(o,a,r),minZoom:typeof t.minzoom<"u"&&t.minzoom>-1?t.minzoom:void 0,maxZoom:typeof t.maxzoom<"u"&&t.maxzoom>-1?t.maxzoom:void 0,tooltip:t.markup?ae(t.label):t.label,tooltipHTML:t.markup?t.label:void 0,popup:t.desc||t.label||void 0,isPopupHTML:t.desc?!0:t.markup||!1}}function Ha(e,t){let o;for(const a in e)Object.prototype.hasOwnProperty.call(e,a)&&(o=`circle_${a}`,t.set(o,Po(o,e[a])))}function Po(e,t){return{id:e,type:W.CIRCLE,location:{x:t.x||0,y:t.y||0,z:t.z||0},bounds:{max:{x:(t.x||0)+(t.xr||0),y:t.y||0,z:(t.z||0)+(t.zr||0)},min:{x:(t.x||0)-(t.xr||0),y:t.y||0,z:(t.z||0)-(t.zr||0)}},radius:[t.xr||0,t.zr||0],style:{fillColor:t.fillcolor||"#ff0000",fillOpacity:t.fillopacity||0,color:t.color||"#ff0000",opacity:t.opacity||1,weight:t.weight||1},minZoom:typeof t.minzoom<"u"&&t.minzoom>-1?t.minzoom:void 0,maxZoom:typeof t.maxzoom<"u"&&t.maxzoom>-1?t.maxzoom:void 0,tooltip:t.markup?ae(t.label):t.label,tooltipHTML:t.markup?t.label:void 0,popup:t.desc||t.label||void 0,isPopupHTML:t.desc?!0:t.markup||!1}}function xa(e,t,o){const a={markerSets:[],markers:[],tiles:[],chat:[]},r={stale:0,noSet:0,noId:0,unknownType:0,unknownCType:0,incomplete:0,notImplemented:0};let n=0;for(const s of e)switch(s.type){case"component":{if(t&&s.timestamp<t){r.stale++;continue}if(!s.id){r.noId++;continue}const i=s.msg.startsWith("set")?s.id:s.set;if(!i){r.noSet++;continue}if(s.ctype!=="markers"){r.unknownCType++;continue}const l={id:s.id,removed:s.msg.endsWith("deleted"),set:i};s.msg.startsWith("set")?(l.removed||(l.payload=Io(i,s)),a.markerSets.push(Object.freeze(l))):(s.msg.startsWith("marker")?(l.id=`point_${s.id}`,l.type=W.POINT,l.payload=l.removed?void 0:$o(l.id,s,o)):s.msg.startsWith("area")?(l.id=`area_${s.id}`,l.type=W.AREA,l.payload=l.removed?void 0:Ao(l.id,s)):s.msg.startsWith("circle")?(l.id=`circle_${s.id}`,l.type=W.CIRCLE,l.payload=l.removed?void 0:Po(l.id,s)):s.msg.startsWith("line")&&(l.id=`line_${s.id}`,l.type=W.LINE,l.payload=l.removed?void 0:zo(l.id,s)),a.markers.push(Object.freeze(l))),n++;break}case"chat":if(!s.message||!s.timestamp){r.incomplete++;continue}if(s.timestamp<t){r.stale++;continue}if(s.source!=="player"&&s.source!=="web"&&s.source!=="plugin"){r.notImplemented++;continue}a.chat.push({type:"chat",source:s.source||void 0,playerAccount:s.account||void 0,playerName:s.playerName||void 0,message:s.message||"",timestamp:s.timestamp,channel:s.channel||void 0});break;case"playerjoin":if(!s.account||!s.timestamp){r.incomplete++;continue}if(s.timestamp<t){r.stale++;continue}a.chat.push({type:"playerjoin",playerAccount:s.account,playerName:s.playerName||"",timestamp:s.timestamp||void 0});break;case"playerquit":if(!s.account||!s.timestamp){r.incomplete++;continue}if(s.timestamp<t){r.stale++;continue}a.chat.push({type:"playerleave",playerAccount:s.account,playerName:s.playerName||"",timestamp:s.timestamp||void 0});break;case"tile":if(!s.name||!s.timestamp){r.incomplete++;continue}if(t&&s.timestamp<t){r.stale++;continue}a.tiles.push({name:s.name,timestamp:s.timestamp}),n++;break;default:r.unknownType++}return a.chat=a.chat.sort((s,i)=>i.timestamp-s.timestamp),console.debug(`Updates: ${n} accepted. Rejected: `,r),a}const Ba=f.Util.falseFn,It=class It extends f.TileLayer{constructor(o){super("",{errorTileUrl:"images/blank.png",zoomReverse:!0,tileSize:o.tileSize,maxNativeZoom:o.nativeZoomLevels,minZoom:o.minZoom,maxZoom:o.maxZoom||o.nativeZoomLevels+(o.extraZoomLevels||0)});c(this,"tileTemplate");c(this,"loadQueue",[]);c(this,"loadingTiles",Object.seal(new Set));c(this,"refreshTimeout");f.Util.setOptions(this,{imageFormat:o.imageFormat,baseUrl:o.baseUrl,tileUpdateInterval:o.tileUpdateInterval,nightAndDay:!!o.nightAndDay,prefix:o.prefix||"",extraZoomLevels:o.extraZoomLevels||0,nativeZoomLevels:o.nativeZoomLevels}),this.tileTemplate=f.DomUtil.create("img","leaflet-tile"),this.tileTemplate.style.width=this.tileTemplate.style.height=this.options.tileSize+"px",this.tileTemplate.alt="",this.tileTemplate.tileName="",this.tileTemplate.callback=Ba,this.tileTemplate.setAttribute("role","presentation"),(this.options.crossOrigin||this.options.crossOrigin==="")&&(this.tileTemplate.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),Object.seal(this.tileTemplate)}createTile(o,a){const r=this.tileTemplate.cloneNode(!1);return this.loadQueue.push(r),r.onload=()=>{URL.revokeObjectURL(r.src),this._tileOnLoad(a,r),this.loadingTiles.delete(r),this.tickLoadQueue()},r.onerror=()=>{this._tileOnError(a,r,It.genericLoadError),this.loadingTiles.delete(r),this.tickLoadQueue()},r.url=this.getTileUrl(o),r.callback=a,this.tickLoadQueue(),r}async fetchTile(o){o.abortController&&!o.abortController.signal.aborted&&o.abortController.abort(),o.abortController=new AbortController;try{const a=await fetch(o.url,{signal:o.abortController.signal});if(!a.ok){this._tileOnError(o.callback,o,new Error("Response was not ok"));return}const r=await a.blob();o.src=URL.createObjectURL(r)}catch(a){if(a instanceof DOMException&&a.name==="AbortError")return;console.error(a),this._tileOnError(o.callback,o,a)}}tickLoadQueue(){if(this.loadingTiles.size>6)return;const o=this.loadQueue.shift();o&&(this.loadingTiles.add(o),this.fetchTile(o))}refresh(){for(const o in this._tiles){if(!Object.prototype.hasOwnProperty.call(this._tiles,o))continue;const a=this._tiles[o];a.loaded&&this.loadQueue.push(a.el)}this.tickLoadQueue()}_abortLoading(){let o;for(const a in this._tiles)Object.prototype.hasOwnProperty.call(this._tiles,a)&&(o=this._tiles[a],o.coords.z!==this._tileZoom&&(!o.loaded&&o.el&&o.el.abortController&&o.el.abortController.abort(),this.loadQueue.includes(o.el)&&this.loadQueue.splice(this.loadQueue.indexOf(o.el),1),this.loadingTiles.delete(o.el)));super._abortLoading.call(this)}_removeTile(o){const a=this._tiles[o];a&&(this.loadingTiles.delete(a.el),this.loadQueue.includes(a.el)&&this.loadQueue.splice(this.loadQueue.indexOf(a.el),1),a.el.onerror=null,a.el.onload=null,!a.loaded&&a.el.abortController&&a.el.abortController.abort(),super._removeTile(o))}onAdd(o){return this.options.tileUpdateInterval&&(this.refreshTimeout=setTimeout(()=>this.handlePeriodicRefresh(),this.options.tileUpdateInterval)),super.onAdd(o)}remove(){return this.refreshTimeout&&clearTimeout(this.refreshTimeout),super.remove()}handlePeriodicRefresh(){this._map&&this.refresh(),this.refreshTimeout=setTimeout(()=>this.handlePeriodicRefresh(),this.options.tileUpdateInterval)}};c(It,"genericLoadError",new Error("Tile failed to load"));let ht=It;class Wa extends ht{constructor(o){super(o);c(this,"_namedTiles");c(this,"_store",E());c(this,"_night");c(this,"_nightDayMode");c(this,"_pendingUpdates");c(this,"_nightUnwatch",null);c(this,"_updateUnwatch",null);c(this,"_updateFrame",0);this._namedTiles=Object.seal(new Map),this._pendingUpdates=d(()=>!!this._store.state.pendingTileUpdates.length),this._nightDayMode=d(()=>this._store.state.components.nightDay.mode),this._night=d(()=>this._nightDayMode.value==="night_day"?this._store.getters.night:this._nightDayMode.value==="night")}onAdd(o){return super.onAdd(o),this._updateUnwatch=A(this._pendingUpdates,(a,r)=>{a&&!r&&!this._updateFrame&&this.handlePendingUpdates()}),this._nightUnwatch=A(this._night,()=>{this.options.nightAndDay&&this.redraw()}),this}getTileName(o){const a=this.getTileInfo(o);return a.y=-a.y,a.scaledy=a.y>>5,`${a.prefix}${a.nightday}/${a.scaledx}_${a.scaledy}/${a.zoom}${a.x}_${a.y}.${a.fmt}`}getTileUrl(o){return this.getTileUrlFromName(this.getTileName(o))}getTileUrlFromName(o,a){let r=this.options.baseUrl+o;return typeof a<"u"&&(r+=r.indexOf("?")===-1?`?timestamp=${a}`:`&timestamp=${a}`),r}updateNamedTile(o,a){const r=this._namedTiles.get(o);r&&(r.classList.remove("leaflet-tile-loaded"),r.dataset.src=this.getTileUrlFromName(o,a),this.loadQueue.push(r),this.tickLoadQueue())}createTile(o,a){const r=super.createTile(o,a);return r.tileName=this.getTileName(o),this._namedTiles.set(r.tileName,r),r}_abortLoading(){let o;for(const a in this._tiles)Object.prototype.hasOwnProperty.call(this._tiles,a)&&(o=this._tiles[a],o.coords.z!==this._tileZoom&&o.loaded&&o.el&&o.el.tileName&&this._namedTiles.delete(o.el.tileName));super._abortLoading.call(this)}_removeTile(o){const a=this._tiles[o];if(!a)return;const r=a.el.tileName;r&&this._namedTiles.delete(r),super._removeTile.call(this,o)}zoomprefix(o){return"z".repeat(o)+(o===0?"":"_")}getTileInfo(o){const a=this._getZoomForUrl(),r=Math.max(0,a-(this.options.extraZoomLevels||0)),n=1<<r,s=n*o.x,i=n*o.y;return{prefix:encodeURIComponent(this.options.prefix||""),nightday:this.options.nightAndDay&&!this._night.value?"_day":"",scaledx:s>>5,scaledy:i>>5,zoom:this.zoomprefix(r),zoomprefix:r==0?"":this.zoomprefix(r)+"_",x:s,y:i,fmt:this.options.imageFormat||"png"}}async handlePendingUpdates(){const o=await this._store.dispatch(D.POP_TILE_UPDATES,10);for(const a of o)this.updateNamedTile(a.name,a.timestamp);this._pendingUpdates.value?this._updateFrame=requestAnimationFrame(()=>this.handlePendingUpdates()):this._updateFrame=0}remove(){return super.remove(),this._nightUnwatch&&this._nightUnwatch(),this._updateFrame&&cancelAnimationFrame(this._updateFrame),this._updateUnwatch&&this._updateUnwatch(),this}}class rt extends he{constructor(o,a){super(o,a);c(this,"configurationAbort");c(this,"markersAbort");c(this,"updateAbort");c(this,"updatesEnabled",!1);c(this,"updateTimeout",null);c(this,"updateTimestamp",new Date);c(this,"updateInterval",3e3);c(this,"markerSets",new Map);c(this,"markers",new Map);this.validateConfig()}validateConfig(){if(typeof this.config<"u"){if(!this.config||this.config.constructor!==Object)throw new ue("Dynmap configuration object missing");de(this.config.configuration,this.name,"configuration"),de(this.config.update,this.name,"update"),de(this.config.markers,this.name,"markers"),de(this.config.tiles,this.name,"tiles"),de(this.config.sendmessage,this.name,"sendmessage")}}async getMarkerSets(o){const a=`${this.config.markers}_markers_/marker_${encodeURIComponent(o.name)}.json`;this.markersAbort&&this.markersAbort.abort(),this.markersAbort=new AbortController;const r=await this.getJSON(a,this.markersAbort.signal);r.sets=r.sets||{};for(const n in r.sets){if(!Object.prototype.hasOwnProperty.call(r.sets,n))continue;const s=r.sets[n],i=Io(n,s),l=new Map;Oa(s.markers||{},l,this.config),Ra(s.areas||{},l),Da(s.lines||{},l),Ha(s.circles||{},l),this.markerSets.set(n,i),this.markers.set(n,l)}}async loadServerConfiguration(){this.configurationAbort&&this.configurationAbort.abort(),this.configurationAbort=new AbortController;const o=await this.getJSON(this.config.configuration,this.configurationAbort.signal);if(o.error)throw new Error(o.error);const a=za(o);this.updateInterval=o.updaterate||3e3,this.store.commit(m.SET_SERVER_CONFIGURATION,a),this.store.commit(m.SET_SERVER_CONFIGURATION_HASH,o.confighash||0),this.store.commit(m.SET_MAX_PLAYERS,o.maxcount||0),this.store.commit(m.SET_MESSAGES,Pa(o)),this.store.commit(m.SET_WORLDS,Ua(o,this.config)),this.store.commit(m.SET_COMPONENTS,Na(o,this.config)),this.store.commit(m.SET_LOGGED_IN,o.loggedin||!1)}async populateWorld(o){await this.getMarkerSets(o),this.store.commit(m.SET_MARKER_SETS,this.markerSets),this.store.commit(m.SET_MARKERS,this.markers),this.markerSets.clear(),this.markers.clear()}createTileLayer(o){return new Wa(o)}async getUpdate(){let o=this.config.update;o=o.replace("{world}",encodeURIComponent(this.store.state.currentWorld.name)),o=o.replace("{timestamp}",this.updateTimestamp.getTime().toString()),this.updateAbort&&this.updateAbort.abort(),this.updateAbort=new AbortController;const a=await this.getJSON(o,this.updateAbort.signal),r=new Set,n=xa(a.updates||[],this.updateTimestamp,this.config),s={timeOfDay:a.servertime||0,thundering:a.isThundering||!1,raining:a.hasStorm||!1};(a.players||[]).forEach(i=>{const l=i.world&&i.world!=="-some-other-bogus-world-"?i.world:void 0;r.add({name:i.account||"",displayName:i.name||"",health:i.health||0,armor:i.armor||0,sort:i.sort||0,hidden:!l,location:{x:isNaN(i.x)?0:i.x+.5,y:isNaN(i.y)?0:i.y,z:isNaN(i.z)?0:i.z+.5,world:l}})}),this.updateTimestamp=new Date(a.timestamp||0),this.store.commit(m.SET_WORLD_STATE,s),this.store.commit(m.ADD_MARKER_SET_UPDATES,n.markerSets),this.store.commit(m.ADD_MARKER_UPDATES,n.markers),this.store.commit(m.ADD_TILE_UPDATES,n.tiles),this.store.commit(m.ADD_CHAT,n.chat),a.confighash&&this.store.commit(m.SET_SERVER_CONFIGURATION_HASH,a.confighash),await this.store.dispatch(D.SET_PLAYERS,r)}sendChatMessage(o){return this.store.state.components.chatSending?fetch(this.config.sendmessage,{method:"POST",credentials:"include",body:JSON.stringify({name:null,message:o})}).then(a=>{if(a.status===403)throw new bt(this.store.state.messages.chatErrorCooldown.replace("%interval%",this.store.state.components.chatSending.cooldown.toString()));if(!a.ok)throw new Error("Network request failed");return a.json()}).then(a=>{if(a.error!=="none")throw new bt(this.store.state.messages.chatErrorNotAllowed)}).catch(a=>{throw a instanceof bt||(console.error(this.store.state.messages.chatErrorUnknown),console.trace(a)),a}):Promise.reject(this.store.state.messages.chatErrorDisabled)}startUpdates(){this.updatesEnabled=!0,this.update()}async update(){try{await this.getUpdate()}finally{this.updatesEnabled&&(this.updateTimeout&&clearTimeout(this.updateTimeout),this.updateTimeout=setTimeout(()=>this.update(),this.updateInterval))}}stopUpdates(){this.updatesEnabled=!1,this.updateTimeout&&clearTimeout(this.updateTimeout),this.updateTimeout=null,this.configurationAbort&&this.configurationAbort.abort(),this.updateAbort&&this.updateAbort.abort(),this.markersAbort&&this.markersAbort.abort()}async login(o){if(!this.store.getters.loginEnabled)return Promise.reject(this.store.state.messages.loginErrorDisabled);this.store.commit(m.SET_LOGGED_IN,!1);try{const a=new URLSearchParams;switch(a.append("j_username",o.username||""),a.append("j_password",o.password||""),(await rt.fetchJSON(this.config.login,{method:"POST",body:a})).result){case"success":this.store.commit(m.SET_LOGGED_IN,!0);return;case"loginfailed":return Promise.reject(this.store.state.messages.loginErrorIncorrect);default:return Promise.reject(this.store.state.messages.loginErrorUnknown)}}catch(a){return console.error(this.store.state.messages.loginErrorUnknown),console.trace(a),Promise.reject(this.store.state.messages.loginErrorUnknown)}}async logout(){if(!this.store.getters.loginEnabled)return Promise.reject(this.store.state.messages.loginErrorDisabled);try{await rt.fetchJSON(this.config.login,{method:"POST"}),this.store.commit(m.SET_LOGGED_IN,!1)}catch{return Promise.reject(this.store.state.messages.logoutErrorUnknown)}}async register(o){if(!this.store.getters.loginEnabled)return Promise.reject(this.store.state.messages.loginErrorDisabled);this.store.commit(m.SET_LOGGED_IN,!1);try{const a=new URLSearchParams;switch(a.append("j_username",o.username||""),a.append("j_password",o.password||""),a.append("j_verify_password",o.password||""),a.append("j_passcode",o.code||""),(await rt.fetchJSON(this.config.register,{method:"POST",body:a})).result){case"success":this.store.commit(m.SET_LOGGED_IN,!0);return;case"verifyfailed":return Promise.reject(this.store.state.messages.registerErrorVerifyFailed);case"registerfailed":return Promise.reject(this.store.state.messages.registerErrorIncorrect);default:return Promise.reject(this.store.state.messages.registerErrorUnknown)}}catch(a){return console.error(this.store.state.messages.registerErrorUnknown),console.trace(a),Promise.reject(this.store.state.messages.registerErrorUnknown)}}async getJSON(o,a){return he.fetchJSON(o,{signal:a,credentials:"include"}).then(r=>{if(r.error==="login-required")throw this.store.commit(m.SET_LOGIN_REQUIRED,!0),new Error("Login required");return r})}}const Za=1,Zt=new Map,Yt=new Map,At=(e,t)=>{if(Zt.has(e))throw new TypeError(`${e} is already registered`);Zt.set(e,t)},Va=e=>Yt.get(e),ja=e=>{const t=`
Check your server configuration in index.html is correct.`,o=new Map;if(!Object.keys(e).length)throw new ue(`No servers defined. ${t}`);for(const a in e){if(!Object.hasOwnProperty.call(e,a))continue;const r=e[a];let n=!1;for(const s of Zt)if(r&&Object.hasOwnProperty.call(r,s[0])){try{Yt.set(a,new s[1](a,r[s[0]]))}catch(i){throw i.message=`Server "${a}": ${i.message}. ${t}`,i}o.set(a,r),n=!0}if(!n)throw new ue(`Server "${a}": No configuration found for any supported map type. ${t}`);r.id=a}return o},Fa=e=>{const t=`
Check your standalone/config.js file exists and is being loaded correctly.`,o=new Map;o.set("dynmap",{id:"dynmap",label:"dynmap",dynmap:e});try{Yt.set("dynmap",new rt("dynmap",e))}catch(a){throw a.message=`${a.message}. ${t}`,a}return o},Ga=e=>{var t;if(!e)throw new ue(`No configuration found.
Check for any syntax errors in your configuration in index.html. Your browser console may contain additional information.`);if(e.version!==Za)throw new ue(`Configuration version mismatch.
Use a fresh copy of index.html from your current LiveAtlas version (${E().state.version}) and reapply any customisations.`);return typeof e.servers<"u"?ja(e.servers):Fa(((t=window.config)==null?void 0:t.url)||null)},qa={[m.SET_UI_CONFIGURATION](e,t){try{const o=JSON.parse(localStorage.getItem("uiSettings")||"{}");if(o&&o.sidebar)for(const a in o.sidebar){const r=o.sidebar[a];r&&typeof e.ui.sidebar[a]<"u"&&(e.ui.sidebar[a].collapsed=!!r.collapsed)}}catch(o){console.warn("Failed to load saved UI settings",o)}typeof t.playersAboveMarkers=="boolean"&&(e.ui.playersAboveMarkers=t.playersAboveMarkers),typeof t.compactPlayerMarkers=="boolean"&&(e.ui.compactPlayerMarkers=t.compactPlayerMarkers),typeof t.disableContextMenu=="boolean"&&(e.ui.disableContextMenu=t.disableContextMenu),typeof t.disableMarkerUI=="boolean"&&(e.ui.disableMarkerUI=t.disableMarkerUI),typeof t.playersSearch=="boolean"&&(e.ui.playersSearch=t.playersSearch),typeof t.customLoginUrl=="string"&&(e.ui.customLoginUrl=t.customLoginUrl)},[m.SET_MESSAGES](e,t){e.messages=Object.assign(e.messages,t)},[m.SET_SERVERS](e,t){e.servers=t,e.currentServer&&!e.servers.has(e.currentServer.id)&&(e.currentServer=void 0)},[m.SET_SERVER_CONFIGURATION](e,t){e.configuration=Object.assign(e.configuration,t)},[m.SET_SERVER_CONFIGURATION_HASH](e,t){e.configurationHash=t},[m.SET_WORLDS](e,t){e.worlds.clear(),e.maps.clear(),e.followTarget=void 0,e.viewTarget=void 0,e.currentWorldState.timeOfDay=0,e.currentWorldState.raining=!1,e.currentWorldState.thundering=!1,t.forEach(o=>{e.worlds.set(o.name,o),o.maps.forEach(a=>e.maps.set(`${a.world.name}_${a.name}`,a))}),e.currentWorld&&e.worlds.has(e.currentWorld.name)?e.currentWorld=e.worlds.get(e.currentWorld.name):e.currentWorld=void 0,e.currentWorld&&e.currentMap&&e.maps.has(`${e.currentWorld.name}_${e.currentMap.name}`)?e.currentMap=e.maps.get(`${e.currentWorld.name}_${e.currentMap.name}`):e.currentMap=void 0},[m.SET_COMPONENTS](e,t){e.components=Object.assign(e.components,t)},[m.SET_MARKER_SETS](e,t){e.markerSets.clear(),e.pendingMarkerUpdates.splice(0),K.markers.clear();for(const o of t)e.markerSets.set(o[0],o[1]),K.markers.set(o[0],new Map)},[m.SET_MARKERS](e,t){K.markers.clear();for(const o of t)K.markers.set(o[0],o[1])},[m.SET_WORLD_STATE](e,t){e.currentWorldState=Object.assign(e.currentWorldState,t)},[m.ADD_MARKER_SET_UPDATES](e,t){for(const o of t){if(o.removed){e.markerSets.delete(o.id),K.markers.delete(o.id);continue}if(o.payload)if(e.markerSets.has(o.id)){const a=e.markerSets.get(o.id);a.showLabels=o.payload.showLabels,a.minZoom=o.payload.minZoom,a.maxZoom=o.payload.maxZoom,a.priority=o.payload.priority,a.label=o.payload.label,a.hidden=o.payload.hidden}else e.markerSets.set(o.id,{id:o.id,showLabels:o.payload.showLabels,minZoom:o.payload.minZoom,maxZoom:o.payload.maxZoom,priority:o.payload.priority,label:o.payload.label,hidden:o.payload.hidden}),K.markers.set(o.id,new Map)}},[m.ADD_MARKER_UPDATES](e,t){let o;for(const a of t)K.markers.has(a.set)&&(o=K.markers.get(a.set),a.removed?o.delete(a.id):o.set(a.id,a.payload));e.pendingMarkerUpdates=e.pendingMarkerUpdates.concat(t)},[m.ADD_TILE_UPDATES](e,t){e.pendingTileUpdates=e.pendingTileUpdates.concat(t)},[m.ADD_CHAT](e,t){e.chat.messages.unshift(...t)},[m.POP_MARKER_UPDATES](e,t){e.pendingMarkerUpdates.splice(0,t)},[m.POP_TILE_UPDATES](e,t){e.pendingTileUpdates.splice(0,t)},[m.SET_MAX_PLAYERS](e,t){e.maxPlayers=t},[m.SET_PLAYERS_ASYNC](e,t){let o=0;for(const a of t){if(e.players.has(a.name)){const r=e.players.get(a.name);r.health=a.health,r.uuid=a.uuid,r.armor=a.armor,r.location=Object.assign(r.location,a.location),r.yaw=a.yaw,r.hidden=a.hidden,r.displayName=a.displayName,r.sort=a.sort,(r.displayName!==a.displayName||r.sort!==a.sort)&&(e.sortedPlayers.dirty=!0)}else e.sortedPlayers.dirty=!0,e.players.set(a.name,{name:a.name,uuid:a.uuid,health:a.health,armor:a.armor,location:a.location,yaw:a.yaw,displayName:a.displayName,sort:a.sort,hidden:a.hidden});if(t.delete(a),++o>=10)break}return!t.size&&e.sortedPlayers.dirty&&(e.sortedPlayers=[...e.players.values()].sort((a,r)=>a.sort!==r.sort?a.sort-r.sort:a.name.toLowerCase().localeCompare(r.name.toLowerCase()))),t},[m.SYNC_PLAYERS](e,t){for(const[o,a]of e.players)t.has(a.name)||(e.sortedPlayers.splice(e.sortedPlayers.indexOf(a),1),e.players.delete(o))},[m.SET_LOADED](e){e.firstLoad=!1},[m.SET_CURRENT_SERVER](e,t){if(!e.servers.has(t))throw new RangeError(`Unknown server ${t}`);e.currentServer=e.servers.get(t),e.currentMapProvider&&e.currentMapProvider.stopUpdates(),e.currentMapProvider=Va(t)},[m.SET_CURRENT_MAP](e,{worldName:t,mapName:o}){if(o=`${t}_${o}`,!e.worlds.has(t))throw new RangeError(`Unknown world ${t}`);if(!e.maps.has(o))throw new RangeError(`Unknown map ${o}`);const a=e.worlds.get(t);e.currentWorld!==a&&(e.currentWorld=a,e.markerSets.clear(),e.pendingMarkerUpdates.splice(0),e.pendingTileUpdates.splice(0),e.currentWorldState.timeOfDay=void 0,e.currentWorldState.raining=!1,e.currentWorldState.thundering=!1,e.followTarget&&e.followTarget.location.world!==a.name&&(e.followTarget=void 0)),e.currentMap=e.maps.get(o)},[m.SET_CURRENT_LOCATION](e,t){e.currentLocation=t},[m.SET_CURRENT_ZOOM](e,t){e.currentZoom=t},[m.SET_PARSED_URL](e,t){e.parsedUrl=t},[m.CLEAR_PARSED_URL](e){e.parsedUrl=void 0},[m.SET_FOLLOW_TARGET](e,t){e.followTarget=t},[m.SET_VIEW_TARGET](e,t){e.followTarget=void 0,e.viewTarget=t},[m.CLEAR_FOLLOW_TARGET](e){e.followTarget=void 0},[m.CLEAR_VIEW_TARGET](e){e.viewTarget=void 0},[m.SET_SCREEN_SIZE](e,t){e.ui.screenWidth=t.width,e.ui.screenHeight=t.height;const o=e.ui.screenWidth<480||e.ui.screenHeight<500;!e.ui.smallScreen&&o&&e.ui.visibleElements.size>1&&e.ui.visibleElements.clear(),e.ui.smallScreen=o},[m.TOGGLE_UI_ELEMENT_VISIBILITY](e,t){const o=!e.ui.visibleElements.has(t);o&&e.ui.smallScreen&&e.ui.visibleElements.clear(),e.ui.previouslyVisibleElements.add(t),o?e.ui.visibleElements.add(t):e.ui.visibleElements.delete(t)},[m.SET_UI_ELEMENT_VISIBILITY](e,t){t.state&&e.ui.smallScreen&&e.ui.visibleElements.clear(),(t.state||e.ui.visibleElements.has(t.element))&&e.ui.previouslyVisibleElements.add(t.element),t.state?e.ui.visibleElements.add(t.element):e.ui.visibleElements.delete(t.element)},[m.SHOW_UI_MODAL](e,t){e.ui.smallScreen&&e.ui.visibleElements.clear(),e.ui.visibleModal=t},[m.HIDE_UI_MODAL](e,t){e.ui.visibleModal===t&&(e.ui.visibleModal=void 0)},[m.TOGGLE_SIDEBAR_SECTION_COLLAPSED_STATE](e,t){e.ui.sidebar[t].collapsed=!e.ui.sidebar[t].collapsed},[m.SET_LOGGED_IN](e,t){e.loggedIn=t},[m.SET_LOGIN_REQUIRED](e,t){t&&(e.loggedIn=!1),e.loginRequired=t},[m.RESET](e){e.followTarget=void 0,e.viewTarget=void 0,e.players.clear(),e.sortedPlayers.splice(0,e.sortedPlayers.length),e.maxPlayers=0,e.currentWorld=void 0,e.currentMap=void 0,e.markerSets.clear(),e.pendingMarkerUpdates.splice(0),e.pendingTileUpdates.splice(0),e.worlds.clear(),e.maps.clear(),e.currentZoom=0,e.currentLocation={x:0,y:0,z:0},e.currentWorldState.timeOfDay=0,e.currentWorldState.raining=!1,e.currentWorldState.thundering=!1,e.configurationHash=void 0,e.configuration.title="",e.components.markers.showLabels=!1,e.components.players={markers:void 0,showImages:!0,grayHiddenPlayers:!0,imageUrl:ut},e.components.coordinatesControl=void 0,e.components.clockControl=void 0,e.components.linkControl=!1,e.components.layerControl=!1,e.components.logoControls=[],e.components.chatSending=void 0,e.components.chatBox=void 0,e.components.chatBalloons=!1,e.components.login=!1,e.ui.visibleModal=void 0,e.chat.messages=[],e.loggedIn=!1,e.loginRequired=!1}},Ka={async[D.INIT]({commit:e},t){e(m.SET_UI_CONFIGURATION,(t==null?void 0:t.ui)||{}),e(m.SET_MESSAGES,(t==null?void 0:t.messages)||{}),e(m.SET_SERVERS,t.servers)},async[D.LOAD_CONFIGURATION]({commit:e,state:t,dispatch:o}){var n,s;if(await o(D.STOP_UPDATES,void 0),e(m.RESET,void 0),!t.currentServer){console.warn("No current server");return}if(await t.currentMapProvider.loadServerConfiguration(),t.currentMap)return;!t.ui.visibleElements.size&&t.configuration.expandUI&&!t.ui.smallScreen&&(e(m.SET_UI_ELEMENT_VISIBILITY,{element:"players",state:!0}),e(m.SET_UI_ELEMENT_VISIBILITY,{element:"maps",state:!0}),t.ui.disableMarkerUI||e(m.SET_UI_ELEMENT_VISIBILITY,{element:"markers",state:!0}));let a,r;if(t.configuration.defaultWorld&&t.worlds.has(t.configuration.defaultWorld)&&(a=t.configuration.defaultWorld),(n=t.parsedUrl)!=null&&n.world&&t.worlds.has(t.parsedUrl.world)&&(a=t.parsedUrl.world),a||(a=t.worlds.size?t.worlds.entries().next().value[1].name:void 0),a&&(t.configuration.defaultMap&&t.maps.has(`${a}_${t.configuration.defaultMap}`)&&(r=t.configuration.defaultMap),(s=t.parsedUrl)!=null&&s.map&&t.maps.has(`${a}_${t.parsedUrl.map}`)&&(r=t.parsedUrl.map),!r)){const i=t.worlds.get(a);r=i.maps.size?i.maps.values().next().value.name:void 0}a&&r&&e(m.SET_CURRENT_MAP,{worldName:a,mapName:r}),await re(()=>e(m.SET_LOADED,void 0))},async[D.START_UPDATES]({state:e}){if(!e.currentWorld)return Promise.reject("No current world");e.currentMapProvider.startUpdates(),Ca()},async[D.STOP_UPDATES]({state:e}){e.currentMapProvider.stopUpdates(),Ma()},[D.SET_PLAYERS]({commit:e},t){const o=new Set;for(const r of t)o.add(r.name);e(m.SYNC_PLAYERS,o);const a=(r,n)=>{e(m.SET_PLAYERS_ASYNC,r),r.size?requestAnimationFrame(()=>a(r,n)):n()};return new Promise(r=>{requestAnimationFrame(()=>a(t,r))})},async[D.POP_MARKER_UPDATES]({commit:e,state:t},o){const a=t.pendingMarkerUpdates.slice(0,o);return e(m.POP_MARKER_UPDATES,o),a},async[D.POP_TILE_UPDATES]({commit:e,state:t},o){const a=t.pendingTileUpdates.slice(0,o);return e(m.POP_TILE_UPDATES,o),a},async[D.SEND_CHAT_MESSAGE]({state:e},t){await e.currentMapProvider.sendChatMessage(t)},async[D.LOGIN]({state:e,commit:t},o){o?await e.currentMapProvider.login(o):e.ui.customLoginUrl?window.location.href=e.ui.customLoginUrl:t(m.SHOW_UI_MODAL,"login")},async[D.LOGOUT]({state:e}){await e.currentMapProvider.logout()},async[D.REGISTER]({state:e},t){await e.currentMapProvider.register(t)}},ee=Do({state:pa,mutations:qa,getters:ma,actions:Ka});function E(){return ee}const Ya=$({props:{options:{type:Object,required:!0},leaflet:{type:Object,required:!0}},setup(e){const t=E(),o=d(()=>e.options instanceof $t&&e.options===t.state.currentMap);let a=t.state.currentMapProvider.createTileLayer(Object.freeze(JSON.parse(JSON.stringify(e.options))));const r=()=>e.leaflet.addLayer(a),n=()=>a.remove();A(o,s=>s?r():n()),o.value&&r(),G(()=>n())},render(){return null}}),Qt=document.createElement("img");Qt.src=St;Qt.className="player__icon";class Qa extends f.Layer{constructor(o,a){super(a);c(this,"_player");c(this,"_container");c(this,"_playerImage");c(this,"_playerInfo");c(this,"_playerName");c(this,"_currentName");c(this,"_playerHealth");c(this,"_playerArmor");c(this,"_playerYaw");c(this,"_currentYaw",0);f.Util.setOptions(this,a),this._player=o}createIcon(){return this._container?(this.update(),this._container):(this._currentName=void 0,this._container=document.createElement("div"),this._container.classList.add("marker","marker--player","leaflet-marker-icon"),this._playerInfo=document.createElement("div"),this._playerInfo.className="marker__label",this._playerName=document.createElement("span"),this._playerName.className="player__name",this.options.compact&&this._container.classList.add("marker--compact"),this.options.imageSize!="none"&&(this._playerImage=Qt.cloneNode(),this._playerImage.height=this._playerImage.width=uo(this.options.imageSize),this.updateImage(),this._playerInfo.appendChild(this._playerImage)),this._playerInfo.appendChild(this._playerName),this.options.showHealth&&(this._playerHealth=document.createElement("meter"),this._playerHealth.className="player__health",this._playerHealth.hidden=!0,this._playerHealth.max=20,this._playerInfo.appendChild(this._playerHealth)),this.options.showArmor&&(this._playerArmor=document.createElement("meter"),this._playerArmor.className="player__armor",this._playerArmor.hidden=!0,this._playerArmor.max=20,this._playerInfo.appendChild(this._playerArmor)),this.options.showYaw&&(this._container.classList.add("player--yaw"),this._playerYaw=document.createElement("div"),this._playerYaw.className="player__yaw",this._container.appendChild(this._playerYaw)),this._container.appendChild(this._playerInfo),this.update(),this._container)}updateImage(){ho(this._player,this.options.imageSize).then(o=>{this._playerImage.src=o.src}).catch(()=>{})}update(){if(this._container&&(this._player.displayName!==this._currentName&&(this._playerName.innerHTML=this._currentName=this._player.displayName),this.options.showHealth&&(this._player.health!==void 0?(this._playerHealth.hidden=!1,this._playerHealth.value=this._player.health):this._playerHealth.hidden=!0),this.options.showArmor&&(this._player.armor!==void 0?(this._playerArmor.hidden=!1,this._playerArmor.value=this._player.armor):this._playerArmor.hidden=!0),this.options.showYaw&&this._player.yaw!==void 0)){const o=((this._player.yaw-this._currentYaw)%360+540)%360-180;this._currentYaw=this._currentYaw+o,this._playerYaw.style.setProperty("--player-yaw",`${this._currentYaw}deg`)}}detach(){this._container&&this._container.parentNode&&(this._container=this._container.parentNode.removeChild(this._container))}}class Ja extends f.Marker{constructor(o,a){super(new f.LatLng(0,0),a);c(this,"_PlayerIcon");c(this,"_player");c(this,"_playerUnwatch");c(this,"_imageUrlUnwatch");this._player=o,this._PlayerIcon=a.icon=new Qa(o,{imageSize:a.imageSize,showHealth:a.showHealth,showArmor:a.showArmor,showYaw:a.showYaw,compact:a.compact}),f.Util.setOptions(this,a)}onAdd(o){const a=d(()=>E().state.components.players.imageUrl);return this._playerUnwatch=A(this._player,()=>this._PlayerIcon.update(),{deep:!0}),this._imageUrlUnwatch=A(a,()=>re(()=>this._PlayerIcon.updateImage())),super.onAdd(o)}onRemove(o){return this._playerUnwatch&&this._playerUnwatch(),this._imageUrlUnwatch&&this._imageUrlUnwatch(),this._icon&&this._PlayerIcon.detach(),super.onRemove(o)}_resetZIndex(){}}const Xa=$({props:{player:{type:Object,required:!0},layerGroup:{type:Object,required:!0}},setup(e){let t=0;const o=E(),a=d(()=>o.state.components.players.markers),r=d(()=>o.state.currentMap),n=d(()=>o.state.currentWorld),s=d(()=>o.state.components.chatBalloons),i=L(!1),l=new Ja(e.player,{compact:o.state.ui.compactPlayerMarkers,imageSize:a.value.imageSize,showHealth:a.value.showHealth,showArmor:a.value.showArmor,showYaw:a.value.showYaw,pane:"players"}),p=new f.Popup({autoClose:!1,autoPan:!1,keepInView:!1,closeButton:!1,closeOnEscapeKey:!1,closeOnClick:!1,className:"leaflet-popup--chat",minWidth:0}),g=L(!1),y=L(null),_=d(()=>{const w=[];if(!s.value)return w;for(const P of o.state.chat.messages){if(P.timestamp<=t||w.length===5)break;P.type==="chat"&&P.playerAccount===e.player.name&&w.push(P)}return!w.length&&o.state.chat.messages.length&&(t=o.state.chat.messages[0].timestamp),w}),C=()=>{const w=_.value.reduceRight((P,k)=>{const N=document.createElement("span");return N.appendChild(document.createTextNode(k.message||"")),P+N.outerHTML},"");(w!=p.getContent()||!g.value)&&(p.setContent(w),g.value||(e.layerGroup.addLayer(p),g.value=!0,t=_.value[_.value.length-1].timestamp-1),y.value&&clearTimeout(y.value),y.value=setTimeout(()=>z(),8e3))},z=()=>{e.layerGroup.removeLayer(p),g.value=!1,_.value[0]&&(t=_.value[0].timestamp)},O=()=>{if(r.value&&!i.value){const w=r.value.locationToLatLng(e.player.location);e.layerGroup.addLayer(l),l.setLatLng(w),p.setLatLng(w),i.value=!0,t=new Date().getTime()}},U=()=>{i.value&&(e.layerGroup.removeLayer(l),e.layerGroup.removeLayer(p),i.value=!1,z(),y.value&&clearTimeout(y.value))};return V(()=>{r.value&&n.value.name===e.player.location.world&&O()}),G(()=>U()),{componentSettings:a,currentMap:r,currentWorld:n,chatBalloonsEnabled:s,marker:l,markerVisible:i,chatBalloon:p,playerChat:_,updateChatBalloon:C,enableLayer:O,disableLayer:U}},watch:{player:{deep:!0,handler(e){if(this.currentMap&&e.location.world===this.currentWorld.name)if(!this.markerVisible)this.enableLayer();else{const t=this.currentMap.locationToLatLng(e.location);this.marker.setLatLng(t),this.chatBalloon.setLatLng(t)}else this.markerVisible&&this.disableLayer()}},playerChat(e){!this.chatBalloonsEnabled||!this.markerVisible||!e.length||this.updateChatBalloon()},currentWorld(e){e&&e.name===this.player.location.world?this.enableLayer():this.markerVisible&&this.disableLayer()},currentMap(e){if(e){const t=e.locationToLatLng(this.player.location);this.marker.setLatLng(t),this.chatBalloon.setLatLng(t)}}},render(){return null}}),er=$({components:{PlayerMarker:Xa},props:{leaflet:{type:Object,required:!0}},setup(e){const t=E(),o=e.leaflet.getPane("players")||e.leaflet.createPane("players"),a=d(()=>t.state.players),r=d(()=>t.state.players.size),n=d(()=>t.state.ui.playersAboveMarkers),s=d(()=>t.state.components.players.markers),i=new f.LayerGroup([],{pane:"players"});return A(r,l=>o.classList.toggle("no-animations",l>150)),V(()=>{s.value.hideByDefault?e.leaflet.getLayerManager().addHiddenLayer(i,t.state.components.players.markers.layerName,s.value.layerPriority):e.leaflet.getLayerManager().addLayer(i,!0,t.state.components.players.markers.layerName,s.value.layerPriority)}),G(()=>e.leaflet.getLayerManager().removeLayer(i)),n.value&&(o.style.zIndex="600"),{players:a,componentSettings:s,layerGroup:i}},render(){return null}}),R=(e,t)=>{const o=e.__vccOpts||e;for(const[a,r]of t)o[a]=r;return o};function tr(e,t,o,a,r,n){const s=S("PlayerMarker");return u(!0),v(x,null,Y(e.players,([i,l])=>(u(),T(s,{key:i,player:l,layerGroup:e.layerGroup},null,8,["player","layerGroup"]))),128)}const or=R(er,[["render",tr]]);class ot extends f.LayerGroup{constructor(o){super([],o);c(this,"_zoomLimitedLayers");c(this,"_markerPane");c(this,"_zoomEndCallback",()=>this._updateLayerVisibility());f.Util.setOptions(this,o),this._zoomLimitedLayers=new Set}onAdd(o){return o.on("zoomend",this._zoomEndCallback,this),this._map=o,this._markerPane=o.getPane(`${this.options.id}-markers`)||o.createPane(`${this.options.id}-markers`),this._markerPane.classList.toggle("leaflet-pane--show-labels",this.options.showLabels),this._markerPane.style.zIndex=(401+this.options.priority).toString(),this._updateLayerVisibility(!0),this}onRemove(o){return super.onRemove(o),o.off("zoomend",this._zoomEndCallback,this),this}clearLayers(){return this._zoomLimitedLayers.clear(),super.clearLayers()}addLayer(o){const a=this.getLayerId(o);this._layers[a]=o,o instanceof f.Marker?o.options.pane=`${this.options.id}-markers`:o instanceof f.Path&&(o.options.pane="vectors");const r=ot._isLayerZoomLimited(o);return r&&this._zoomLimitedLayers.add(o),this._map&&(r?ot._isLayerVisible(o,this._map.getZoom())&&this._addToMap(o):this._addToMap(o)),this}removeLayer(o){return this._zoomLimitedLayers.delete(o),super.removeLayer(o)}update(o){this.options.showLabels!==o.showLabels&&(this.eachLayer(a=>{a instanceof Et&&(o.showLabels?a.createLabel():a.removeLabel())}),this.options.showLabels=o.showLabels),this._markerPane&&this._markerPane.classList.toggle("leaflet-pane--show-labels",o.showLabels),(o.minZoom!==this.options.minZoom||o.maxZoom!==this.options.maxZoom)&&(this.options.minZoom=o.minZoom,this.options.maxZoom=o.maxZoom,this._updateLayerVisibility()),o.priority!==this.options.priority&&(this.options.priority=o.priority,this._markerPane&&(this._markerPane.style.zIndex=(401+this.options.priority).toString()))}_updateLayerVisibility(o){if(!this._map)return;const a=this._map.getZoom();if(this._isZoomLimited()){const r=a>=(this.options.minZoom||-1/0)&&a<=(this.options.maxZoom||1/0);this.eachLayer(n=>{this._zoomLimitedLayers.has(n)?ot._isLayerVisible(n,a)?this._addToMap(n):this._removeFromMap(n):r?this._addToMap(n):this._removeFromMap(n)},this)}else this._zoomLimitedLayers.size?this._zoomLimitedLayers.forEach(r=>{ot._isLayerVisible(r,a)?this._addToMap(r):this._removeFromMap(r)}):o&&this.eachLayer(r=>this._addToMap(r),this._map)}_isZoomLimited(){return this.options.maxZoom!==void 0||this.options.minZoom!==void 0}static _isLayerZoomLimited(o){return o.options&&o.options.minZoom!==void 0&&o.options&&o.options.maxZoom!==void 0}static _isLayerVisible(o,a){let r=-1/0,n=1/0;return o.options&&o.options.minZoom!==void 0&&(r=o.options.minZoom),o.options&&o.options.maxZoom!==void 0&&(n=o.options.maxZoom),a>=r&&a<=n}_addToMap(o){this._map.addLayer(o),o instanceof Et&&this.options.showLabels&&o.createLabel()}_removeFromMap(o){this._map.removeLayer(o)}}const ar=$({props:{set:{type:Object,required:!0},layerGroup:{type:Object,required:!0}},setup(e){const t=E(),o=d(()=>t.state.currentMap),a=Object.freeze(new Map);let r=o.value.locationToLatLng.bind(o.value);const n=()=>{K.markers.get(e.set.id).forEach((l,p)=>{const g=$a(l,r);a.set(p,g),e.layerGroup.addLayer(g)})},s=l=>{let p=a.get(l);p&&(e.layerGroup.removeLayer(p),a.delete(l))},i=l=>{if(l.removed)s(l.id);else{const p=oo(a.get(l.id),l.payload,r);a.has(l.id)||e.layerGroup.addLayer(p),a.set(l.id,p)}};A(o,(l,p)=>{if(l&&(!p||p.world===l.world)&&K.markers.has(e.set.id)){r=l.locationToLatLng.bind(l);for(const[g,y]of K.markers.get(e.set.id))oo(a.get(g),y,r)}}),V(()=>{n(),Co(i,e.set.id)}),G(()=>{Mo(i,e.set.id)})},render(){return null}}),rr=$({components:{MapMarkers:ar},props:{leaflet:{type:Object,required:!0},markerSet:{type:Object,required:!0}},setup(e){const t=E(),o=d(()=>t.state.components.markers),a=new ot({id:e.markerSet.id,minZoom:e.markerSet.minZoom,maxZoom:e.markerSet.maxZoom,showLabels:e.markerSet.showLabels||t.state.components.markers.showLabels,priority:e.markerSet.priority});return A(e.markerSet,r=>{r&&a&&(a.update({id:e.markerSet.id,minZoom:e.markerSet.minZoom,maxZoom:e.markerSet.maxZoom,showLabels:e.markerSet.showLabels||t.state.components.markers.showLabels,priority:e.markerSet.priority}),r.hidden?e.leaflet.getLayerManager().addHiddenLayer(a,r.label,e.markerSet.priority):e.leaflet.getLayerManager().addLayer(a,!0,r.label,e.markerSet.priority))},{deep:!0}),V(()=>{e.markerSet.hidden?e.leaflet.getLayerManager().addHiddenLayer(a,e.markerSet.label,e.markerSet.priority):e.leaflet.getLayerManager().addLayer(a,!0,e.markerSet.label,e.markerSet.priority)}),G(()=>e.leaflet.getLayerManager().removeLayer(a)),{markerSettings:o,layerGroup:a}},render(){return null}});function nr(e,t,o,a,r,n){const s=S("MapMarkers");return u(),T(s,{"layer-group":e.layerGroup,set:e.markerSet},null,8,["layer-group","set"])}const sr=R(rr,[["render",nr]]),ve=E();class ao extends f.Control{constructor(o){super(o);c(this,"_location");c(this,"_locationChanged",!1);c(this,"_coordsContainer");c(this,"_regionContainer");c(this,"_chunkContainer");this._coordsContainer=f.DomUtil.create("span","value coordinates"),this._chunkContainer=f.DomUtil.create("span","value chunk"),this._regionContainer=f.DomUtil.create("span","value region"),o.position="bottomleft",f.Util.setOptions(this,o)}onAdd(o){const a=f.DomUtil.create("div","leaflet-control-coordinates");return this._coordsContainer.textContent=this.options.showY?"-----, ---, -----":"-----, -----",this._coordsContainer.dataset.label=this.options.label,a.appendChild(this._coordsContainer),this.options.showRegion&&(this._regionContainer.textContent="--------------",this._regionContainer.dataset.label=ve.state.messages.locationRegion,a.appendChild(this._regionContainer)),this.options.showChunk&&(this._chunkContainer.textContent="----, ----",this._chunkContainer.dataset.label=ve.state.messages.locationChunk,a.appendChild(this._chunkContainer)),o.on("mousemove",this._onMouseMove,this),o.on("mouseout",this._onMouseOut,this),a}remove(){return this._map?(this._map.off("mousemove",this._onMouseMove,this),this._map.off("mouseout",this._onMouseOut,this),super.remove(),this):this}_onMouseMove(o){!this._map||!ve.state.currentMap||(this._location=ve.state.currentMap.latLngToLocation(o.latlng,ve.state.currentWorld.seaLevel+1),this._locationChanged||(this._locationChanged=!0,requestAnimationFrame(()=>this._update())))}_onMouseOut(){this._map&&(this._location=void 0,this._locationChanged||(this._locationChanged=!0,requestAnimationFrame(()=>this._update())))}_update(){if(!this._map||!ve.state.currentWorld||!this._locationChanged)return;if(this._locationChanged=!1,!this._location){this.options.showY?this._coordsContainer.textContent="-----, ---, -----":this._coordsContainer.textContent="-----, -----",this.options.showRegion&&(this._regionContainer.textContent="--------------"),this.options.showChunk&&(this._chunkContainer.textContent="----, ----");return}const o=Math.round(this._location.x).toString().padStart(5," "),a=this._location.y.toString().padStart(3," "),r=Math.round(this._location.z).toString().padStart(5," "),n=Math.floor(this._location.x/512).toString().padStart(3," "),s=Math.floor(this._location.z/512).toString().padStart(3," "),i=Math.floor(this._location.x/16).toString().padStart(4," "),l=Math.floor(this._location.z/16).toString().padStart(4," ");this.options.showY?this._coordsContainer.textContent=`${o}, ${a}, ${r}`:this._coordsContainer.textContent=`${o}, ${r}`,this.options.showRegion&&(this._regionContainer.textContent=`r.${n}, ${s}.mca`),this.options.showChunk&&(this._chunkContainer.textContent=`${i}, ${l}`)}}const ir=$({props:{leaflet:{type:Object,required:!0}},setup(e){const t=E(),o=d(()=>t.state.components.coordinatesControl);let a=new ao(o.value);A(o,r=>{e.leaflet.removeControl(a),r&&(a=new ao(r),e.leaflet.addControl(a))},{deep:!0}),V(()=>e.leaflet.addControl(a)),G(()=>e.leaflet.removeControl(a))},render(){return null}});let lr=document.getElementById("icon--clock_moon"),_e=document.getElementById("svg-sprite-component-wrap");_e||(_e=document.createElementNS("http://www.w3.org/2000/svg","svg"),_e.id="svg-sprite-component-wrap",_e.style.setProperty("display","none"),document.body.appendChild(_e));if(!lr){let e=document.createElementNS("http://www.w3.org/2000/svg","symbol");_e.appendChild(e),e.setAttribute("id","icon--clock_moon"),e.setAttribute("viewBox","0 0 200 160"),e.innerHTML='<path d="M85.562 65.682v9.225h6.469v6.75h-6.469V94.79h12.031V89h3.469v-3.625h5.406v9.415h8.203V65.683H98.874v4.974H92.25v-4.974h-6.687zm25.545 5.367v7.215h-7.521v-7.213l7.521-.002zM79.347 55.26a1.068 1.068 0 0 0-1.068 1.066v6.74a1.068 1.068 0 0 0 1.068 1.069 1.068 1.068 0 0 0 1.066-1.069v-6.74a1.068 1.068 0 0 0-1.066-1.066z"></path><path d="M75.973 58.629a1.068 1.068 0 0 0-1.066 1.068 1.068 1.068 0 0 0 1.066 1.067h6.74a1.068 1.068 0 0 0 1.069-1.067 1.068 1.068 0 0 0-1.069-1.068h-6.74zM115.424 98.608a1.068 1.068 0 0 0-1.068 1.068 1.068 1.068 0 0 0 1.069 1.069h6.74a1.068 1.068 0 0 0 1.068-1.069 1.068 1.068 0 0 0-1.068-1.068h-6.74z"></path><path d="M118.784 95.239a1.068 1.068 0 0 0-1.066 1.068v6.739a1.068 1.068 0 0 0 1.066 1.068 1.068 1.068 0 0 0 1.069-1.068v-6.739a1.068 1.068 0 0 0-1.069-1.068z"></path>'}let dr=document.getElementById("icon--clock_moon_rain"),be=document.getElementById("svg-sprite-component-wrap");be||(be=document.createElementNS("http://www.w3.org/2000/svg","svg"),be.id="svg-sprite-component-wrap",be.style.setProperty("display","none"),document.body.appendChild(be));if(!dr){let e=document.createElementNS("http://www.w3.org/2000/svg","symbol");be.appendChild(e),e.setAttribute("id","icon--clock_moon_rain"),e.setAttribute("viewBox","0 0 200 160"),e.innerHTML='<path d="M89.938 59.713v9.225h6.469v3.078c.242.244.462.516.664.808.91 1.027.916 1.781.916 1.781 4.571-2.083 9.359-1.688 10.61 4.801h2.247v5.62c1.729.898 2.598 2.319 2.875 3.794h5.328V59.713H103.25v4.975h-6.625v-4.975zm25.545 5.367v7.215h-7.521v-7.213zm-36.14-9.851a1.068 1.068 0 0 0-1.068 1.066v6.74a1.068 1.068 0 0 0 1.068 1.069 1.068 1.068 0 0 0 1.066-1.068v-6.74a1.068 1.068 0 0 0-1.066-1.067z"></path><path d="M75.972 58.598a1.068 1.068 0 0 0-1.066 1.068 1.068 1.068 0 0 0 1.066 1.067h6.74a1.068 1.068 0 0 0 1.069-1.067 1.068 1.068 0 0 0-1.069-1.068zm39.448 38.417a1.068 1.068 0 0 0-1.068 1.068 1.068 1.068 0 0 0 1.068 1.069h6.74a1.068 1.068 0 0 0 1.069-1.069 1.068 1.068 0 0 0-1.069-1.068z"></path><path d="M118.79 93.646a1.068 1.068 0 0 0-1.066 1.068v6.739a1.068 1.068 0 0 0 1.066 1.068 1.068 1.068 0 0 0 1.068-1.068v-6.739a1.068 1.068 0 0 0-1.068-1.068zm-27.686-22.58a9.532 9.532 0 0 0-3.443.615c-2.191.834-3.889 2.415-4.305 4.422-.416 2.008.344 4.71 3.793 8.031a1.071 1.071 0 0 1 .03 1.514 1.071 1.071 0 0 1-1.514.03c-1.215-1.17-2.147-2.321-2.856-3.446-4.735-1.035-7.512.638-8.758 3.023-1.22 2.338-.859 5.482 1.291 7.8h36.11c.846-.747 1.59-2.604 1.173-4.29-.418-1.692-1.724-3.247-5.195-3.562-.955 1.204-2.293 2.169-4.041 2.67a1.071 1.071 0 0 1-1.324-.735 1.071 1.071 0 0 1 .734-1.324c1.408-.403 2.444-1.178 3.146-2.139a1.071 1.071 0 0 1 .246-.365l.004-.006c.926-1.506 1.108-3.38.657-5.004-.396-1.422-1.26-2.577-2.537-3.154-1.21-.547-2.883-.616-5.123.33.126.756.184 1.562.127 2.438a1.071 1.071 0 0 1-1.14.998 1.071 1.071 0 0 1-.997-1.14c.218-3.333-1.042-5.06-2.89-5.995-.925-.468-2.035-.7-3.188-.711zM80.875 96.59a1.071 1.071 0 0 0-.902.496l-2.455 3.856a1.071 1.071 0 0 0 .328 1.478 1.071 1.071 0 0 0 1.478-.328l2.455-3.856a1.071 1.071 0 0 0-.326-1.478 1.071 1.071 0 0 0-.578-.168zm13.258 0a1.071 1.071 0 0 0-.9.496l-2.457 3.856a1.071 1.071 0 0 0 .328 1.478 1.071 1.071 0 0 0 1.478-.328l2.457-3.856a1.071 1.071 0 0 0-.328-1.478 1.071 1.071 0 0 0-.578-.168zm13.257 0a1.071 1.071 0 0 0-.9.496l-2.455 3.856a1.071 1.071 0 0 0 .328 1.478 1.071 1.071 0 0 0 1.478-.328l2.455-3.856a1.071 1.071 0 0 0-.328-1.478 1.071 1.071 0 0 0-.578-.168zm-21.212 7.95a1.071 1.071 0 0 0-.9.494l-2.457 3.856a1.071 1.071 0 0 0 .328 1.48 1.071 1.071 0 0 0 1.478-.328l2.457-3.855a1.071 1.071 0 0 0-.328-1.479 1.071 1.071 0 0 0-.578-.168zm13.26 0a1.071 1.071 0 0 0-.902.494l-2.455 3.856a1.071 1.071 0 0 0 .328 1.48 1.071 1.071 0 0 0 1.478-.328l2.455-3.855a1.071 1.071 0 0 0-.328-1.479 1.071 1.071 0 0 0-.576-.168z"></path>'}let cr=document.getElementById("icon--clock_moon_storm"),Se=document.getElementById("svg-sprite-component-wrap");Se||(Se=document.createElementNS("http://www.w3.org/2000/svg","svg"),Se.id="svg-sprite-component-wrap",Se.style.setProperty("display","none"),document.body.appendChild(Se));if(!cr){let e=document.createElementNS("http://www.w3.org/2000/svg","symbol");Se.appendChild(e),e.setAttribute("id","icon--clock_moon_storm"),e.setAttribute("viewBox","0 0 200 160"),e.innerHTML='<path d="M89.938 59.713v9.225h6.469v3.078c.242.244.462.516.664.808.91 1.027.916 1.781.916 1.781 4.571-2.083 9.359-1.688 10.61 4.801h2.247v5.62c1.729.898 2.598 2.319 2.875 3.794h5.328V59.713H103.25v4.975h-6.625v-4.975zm25.545 5.367v7.215h-7.521v-7.213z"></path><path d="M91.104 71.066a9.532 9.532 0 0 0-3.443.615c-2.191.834-3.889 2.415-4.305 4.422-.416 2.008.344 4.71 3.793 8.031a1.071 1.071 0 0 1 .03 1.514 1.071 1.071 0 0 1-1.514.03c-1.215-1.17-2.147-2.321-2.856-3.446-4.735-1.035-7.512.638-8.758 3.023-1.22 2.338-.859 5.482 1.291 7.8h36.11c.846-.747 1.59-2.604 1.173-4.29-.418-1.692-1.724-3.247-5.195-3.562-.955 1.204-2.293 2.169-4.041 2.67a1.071 1.071 0 0 1-1.324-.735 1.071 1.071 0 0 1 .734-1.324c1.408-.403 2.444-1.178 3.146-2.139a1.071 1.071 0 0 1 .246-.365l.004-.006c.926-1.506 1.108-3.38.657-5.004-.396-1.422-1.26-2.577-2.537-3.154-1.21-.547-2.883-.616-5.123.33.126.756.184 1.562.127 2.438a1.071 1.071 0 0 1-1.14.998 1.071 1.071 0 0 1-.997-1.14c.218-3.333-1.042-5.06-2.89-5.995-.925-.468-2.035-.7-3.188-.711zm-4.758 24.989a1.071 1.071 0 0 0-.879.535l-2.506 4.34a1.071 1.071 0 0 0 .733 1.588l1.892.351-3.385 5.862a1.071 1.071 0 0 0 .393 1.463 1.071 1.071 0 0 0 1.463-.393l4.14-7.172a1.071 1.071 0 0 0-.732-1.588l-1.89-.351 1.747-3.03a1.071 1.071 0 0 0-.392-1.463 1.071 1.071 0 0 0-.584-.142zm15.464 0a1.071 1.071 0 0 0-.879.535l-2.506 4.34a1.071 1.071 0 0 0 .733 1.588l1.892.351-3.385 5.862a1.071 1.071 0 0 0 .393 1.463 1.071 1.071 0 0 0 1.463-.393l4.14-7.172a1.071 1.071 0 0 0-.732-1.588l-1.89-.351 1.747-3.03a1.071 1.071 0 0 0-.392-1.463 1.071 1.071 0 0 0-.584-.142z"></path>'}let mr=document.getElementById("icon--clock_sun"),ke=document.getElementById("svg-sprite-component-wrap");ke||(ke=document.createElementNS("http://www.w3.org/2000/svg","svg"),ke.id="svg-sprite-component-wrap",ke.style.setProperty("display","none"),document.body.appendChild(ke));if(!mr){let e=document.createElementNS("http://www.w3.org/2000/svg","symbol");ke.appendChild(e),e.setAttribute("id","icon--clock_sun"),e.setAttribute("viewBox","0 0 200 160"),e.innerHTML='<path d="M118.96 79.605a1.068 1.068 0 0 0-1.068 1.068 1.068 1.068 0 0 0 1.068 1.069h6.74a1.068 1.068 0 0 0 1.069-1.069 1.068 1.068 0 0 0-1.069-1.068h-6.74zm6.63-11.654a1.068 1.068 0 0 0-.283.035l-6.512 1.744a1.068 1.068 0 0 0-.754 1.309 1.068 1.068 0 0 0 1.307.756l6.511-1.746a1.068 1.068 0 0 0 .754-1.307 1.068 1.068 0 0 0-1.023-.791zm-6.5 21.565a1.068 1.068 0 0 0-1.05.791 1.068 1.068 0 0 0 .753 1.309l6.512 1.744a1.068 1.068 0 0 0 1.306-.756 1.068 1.068 0 0 0-.753-1.307l-6.512-1.744a1.068 1.068 0 0 0-.256-.037zm4.84-33.807a1.068 1.068 0 0 0-.725.31l-4.765 4.766a1.068 1.068 0 0 0 0 1.512 1.068 1.068 0 0 0 1.51 0l4.765-4.766a1.068 1.068 0 0 0 0-1.511 1.068 1.068 0 0 0-.785-.311zM99.68 98.006a1.068 1.068 0 0 0-1.068 1.068v6.739a1.068 1.068 0 0 0 1.068 1.068 1.068 1.068 0 0 0 1.068-1.068v-6.739a1.068 1.068 0 0 0-1.068-1.068zm9.92.115a1.068 1.068 0 0 0-.283.035 1.068 1.068 0 0 0-.754 1.309l1.744 6.51a1.068 1.068 0 0 0 1.307.753 1.068 1.068 0 0 0 .755-1.306l-1.744-6.51a1.068 1.068 0 0 0-1.025-.791zm-19.811-.004a1.068 1.068 0 0 0-1.05.791l-1.745 6.51a1.068 1.068 0 0 0 .756 1.306 1.068 1.068 0 0 0 1.307-.753l1.746-6.51a1.068 1.068 0 0 0-.756-1.309 1.068 1.068 0 0 0-.258-.035zm28.991.129a1.068 1.068 0 0 0-.725.313 1.068 1.068 0 0 0 0 1.51l4.766 4.765a1.068 1.068 0 0 0 1.51 0 1.068 1.068 0 0 0 0-1.51l-4.766-4.765a1.068 1.068 0 0 0-.785-.313zM74.541 78.73a1.068 1.068 0 0 0-1.068 1.066 1.068 1.068 0 0 0 1.068 1.069h6.74a1.068 1.068 0 0 0 1.067-1.069 1.068 1.068 0 0 0-1.067-1.066h-6.74zm6.633 9.911a1.068 1.068 0 0 0-.285.037l-6.51 1.744a1.068 1.068 0 0 0-.754 1.309 1.068 1.068 0 0 0 1.307.754l6.51-1.744a1.068 1.068 0 0 0 .755-1.307 1.068 1.068 0 0 0-1.023-.793zm-6.496-21.565a1.068 1.068 0 0 0-1.049.791 1.068 1.068 0 0 0 .754 1.309l6.51 1.744a1.068 1.068 0 0 0 1.309-.756 1.068 1.068 0 0 0-.756-1.307l-6.51-1.744a1.068 1.068 0 0 0-.258-.037zm6.334 30.787a1.068 1.068 0 0 0-.727.313l-4.765 4.765a1.068 1.068 0 0 0 0 1.51 1.068 1.068 0 0 0 1.512 0l4.765-4.766a1.068 1.068 0 0 0 0-1.51 1.068 1.068 0 0 0-.785-.312zm19.548-44.371a1.068 1.068 0 0 0-1.068 1.066v6.74a1.068 1.068 0 0 0 1.068 1.069 1.068 1.068 0 0 0 1.066-1.068v-6.74a1.068 1.068 0 0 0-1.066-1.067zm-11.652.115a1.068 1.068 0 0 0-.285.035 1.068 1.068 0 0 0-.754 1.309l1.744 6.51a1.068 1.068 0 0 0 1.309.753 1.068 1.068 0 0 0 .754-1.306l-1.745-6.51a1.068 1.068 0 0 0-1.023-.791zm23.322.004a1.068 1.068 0 0 0-1.05.791l-1.745 6.51a1.068 1.068 0 0 0 .756 1.306 1.068 1.068 0 0 0 1.307-.753l1.744-6.51a1.068 1.068 0 0 0-.754-1.309 1.068 1.068 0 0 0-.258-.035zm-35.603 1.616a1.067 1.067 0 0 0-.725.313 1.067 1.067 0 0 0 0 1.51l4.766 4.765a1.067 1.067 0 0 0 1.51 0 1.067 1.067 0 0 0 0-1.51l-4.766-4.766a1.067 1.067 0 0 0-.785-.312zm8.936 10.454h29.108V94.79H85.563z"></path>'}let pr=document.getElementById("icon--clock_sun_rain"),Ee=document.getElementById("svg-sprite-component-wrap");Ee||(Ee=document.createElementNS("http://www.w3.org/2000/svg","svg"),Ee.id="svg-sprite-component-wrap",Ee.style.setProperty("display","none"),document.body.appendChild(Ee));if(!pr){let e=document.createElementNS("http://www.w3.org/2000/svg","symbol");Ee.appendChild(e),e.setAttribute("id","icon--clock_sun_rain"),e.setAttribute("viewBox","0 0 200 160"),e.innerHTML='<path d="M123.33 73.355a1.068 1.068 0 0 0-1.068 1.068 1.068 1.068 0 0 0 1.068 1.069h6.74a1.068 1.068 0 0 0 1.069-1.069 1.068 1.068 0 0 0-1.069-1.068zm6.63-11.654a1.068 1.068 0 0 0-.283.035l-6.512 1.744a1.068 1.068 0 0 0-.754 1.309 1.068 1.068 0 0 0 1.307.756l6.511-1.746a1.068 1.068 0 0 0 .754-1.307 1.068 1.068 0 0 0-1.023-.791zm-6.5 21.565a1.068 1.068 0 0 0-1.05.791 1.068 1.068 0 0 0 .753 1.309l6.512 1.744a1.068 1.068 0 0 0 1.306-.756 1.068 1.068 0 0 0-.753-1.307l-6.512-1.744a1.068 1.068 0 0 0-.256-.037zm4.84-33.807a1.068 1.068 0 0 0-.725.31l-4.765 4.766a1.068 1.068 0 0 0 0 1.512 1.068 1.068 0 0 0 1.51 0l4.765-4.766a1.068 1.068 0 0 0 0-1.511 1.068 1.068 0 0 0-.785-.311zm-13.93 44.744a1.068 1.068 0 0 0-.283.047 1.068 1.068 0 0 0-.701 1.338l1.302 4.177a1.068 1.068 0 0 0 1.336.702 1.068 1.068 0 0 0 .703-1.336l-1.302-4.18a1.068 1.068 0 0 0-1.055-.748zm8.79-2.207a1.068 1.068 0 0 0-.725.313 1.068 1.068 0 0 0 0 1.51l4.766 4.765a1.068 1.068 0 0 0 1.51 0 1.068 1.068 0 0 0 0-1.51l-4.766-4.765a1.068 1.068 0 0 0-.785-.313zm-18.23-44.754a1.068 1.068 0 0 0-1.068 1.066v6.74a1.068 1.068 0 0 0 1.068 1.069 1.068 1.068 0 0 0 1.066-1.068v-6.74a1.068 1.068 0 0 0-1.066-1.067zm-11.647.115a1.068 1.068 0 0 0-.285.035 1.068 1.068 0 0 0-.754 1.309l1.744 6.51a1.068 1.068 0 0 0 1.309.753 1.068 1.068 0 0 0 .754-1.306l-1.745-6.51a1.068 1.068 0 0 0-1.023-.791zm23.317.004a1.068 1.068 0 0 0-1.05.791l-1.745 6.51a1.068 1.068 0 0 0 .756 1.306 1.068 1.068 0 0 0 1.307-.753l1.744-6.51a1.068 1.068 0 0 0-.754-1.309 1.068 1.068 0 0 0-.258-.035zm-35.598 1.616a1.068 1.068 0 0 0-.725.313 1.068 1.068 0 0 0 0 1.51l4.766 4.765a1.068 1.068 0 0 0 1.51 0 1.068 1.068 0 0 0 0-1.51l-4.766-4.766a1.068 1.068 0 0 0-.785-.312zm8.936 10.455v10.852c3.426-.394 6.93.938 7.992 4.61.404-.213.359-.19.446-.237 8.372-3.856 11.803 4.574 8.57 9.422 4.24.207 6.19 2.239 6.726 4.46h5.375V59.434zm8.621 15.486c-65.706-49.945-32.853-24.973 0 0zM80.875 96.59a1.071 1.071 0 0 0-.902.496l-2.455 3.856a1.071 1.071 0 0 0 .328 1.478 1.071 1.071 0 0 0 1.478-.328l2.455-3.856a1.071 1.071 0 0 0-.326-1.478 1.071 1.071 0 0 0-.578-.168zm13.258 0a1.071 1.071 0 0 0-.9.496l-2.457 3.856a1.071 1.071 0 0 0 .328 1.478 1.071 1.071 0 0 0 1.478-.328l2.457-3.856a1.071 1.071 0 0 0-.328-1.478 1.071 1.071 0 0 0-.578-.168zm13.257 0a1.071 1.071 0 0 0-.9.496l-2.455 3.856a1.071 1.071 0 0 0 .328 1.478 1.071 1.071 0 0 0 1.478-.328l2.455-3.856a1.071 1.071 0 0 0-.328-1.478 1.071 1.071 0 0 0-.578-.168zm-21.212 7.95a1.071 1.071 0 0 0-.9.494l-2.457 3.856a1.071 1.071 0 0 0 .328 1.48 1.071 1.071 0 0 0 1.478-.328l2.457-3.855a1.071 1.071 0 0 0-.328-1.479 1.071 1.071 0 0 0-.578-.168zm13.26 0a1.071 1.071 0 0 0-.902.494l-2.455 3.856a1.071 1.071 0 0 0 .328 1.48 1.071 1.071 0 0 0 1.478-.328l2.455-3.855a1.071 1.071 0 0 0-.328-1.479 1.071 1.071 0 0 0-.576-.168z"></path><path d="M91.104 71.066a9.532 9.532 0 0 0-3.443.615c-2.191.834-3.889 2.415-4.305 4.422-.416 2.008.344 4.71 3.793 8.031a1.071 1.071 0 0 1 .03 1.514 1.071 1.071 0 0 1-1.514.03c-1.215-1.17-2.147-2.321-2.856-3.446-4.735-1.035-7.512.638-8.758 3.023-1.22 2.338-.859 5.482 1.291 7.8h36.11c.846-.747 1.59-2.604 1.173-4.29-.418-1.692-1.724-3.247-5.195-3.562-.955 1.204-2.293 2.169-4.041 2.67a1.071 1.071 0 0 1-1.324-.735 1.071 1.071 0 0 1 .734-1.324c1.408-.403 2.444-1.178 3.146-2.139a1.071 1.071 0 0 1 .246-.365l.004-.006c.926-1.506 1.108-3.38.657-5.004-.396-1.422-1.26-2.577-2.537-3.154-1.21-.547-2.883-.616-5.123.33.126.756.184 1.562.127 2.438a1.071 1.071 0 0 1-1.14.998 1.071 1.071 0 0 1-.997-1.14c.218-3.333-1.042-5.06-2.89-5.995-.925-.468-2.035-.7-3.188-.711z"></path>'}let ur=document.getElementById("icon--clock_sun_storm"),Le=document.getElementById("svg-sprite-component-wrap");Le||(Le=document.createElementNS("http://www.w3.org/2000/svg","svg"),Le.id="svg-sprite-component-wrap",Le.style.setProperty("display","none"),document.body.appendChild(Le));if(!ur){let e=document.createElementNS("http://www.w3.org/2000/svg","symbol");Le.appendChild(e),e.setAttribute("id","icon--clock_sun_storm"),e.setAttribute("viewBox","0 0 200 160"),e.innerHTML='<path d="M123.33 73.355a1.068 1.068 0 0 0-1.068 1.068 1.068 1.068 0 0 0 1.068 1.069h6.74a1.068 1.068 0 0 0 1.069-1.069 1.068 1.068 0 0 0-1.069-1.068zm6.63-11.654a1.068 1.068 0 0 0-.283.035l-6.512 1.744a1.068 1.068 0 0 0-.754 1.309 1.068 1.068 0 0 0 1.307.756l6.511-1.746a1.068 1.068 0 0 0 .754-1.307 1.068 1.068 0 0 0-1.023-.791zm-6.5 21.565a1.068 1.068 0 0 0-1.05.791 1.068 1.068 0 0 0 .753 1.309l6.512 1.744a1.068 1.068 0 0 0 1.306-.756 1.068 1.068 0 0 0-.753-1.307l-6.512-1.744a1.068 1.068 0 0 0-.256-.037zm4.84-33.807a1.068 1.068 0 0 0-.725.31l-4.765 4.766a1.068 1.068 0 0 0 0 1.512 1.068 1.068 0 0 0 1.51 0l4.765-4.766a1.068 1.068 0 0 0 0-1.511 1.068 1.068 0 0 0-.785-.311zm-13.93 44.744a1.068 1.068 0 0 0-.283.047 1.068 1.068 0 0 0-.701 1.338l1.302 4.177a1.068 1.068 0 0 0 1.336.702 1.068 1.068 0 0 0 .703-1.336l-1.302-4.18a1.068 1.068 0 0 0-1.055-.748zm8.79-2.207a1.068 1.068 0 0 0-.725.313 1.068 1.068 0 0 0 0 1.51l4.766 4.765a1.068 1.068 0 0 0 1.51 0 1.068 1.068 0 0 0 0-1.51l-4.766-4.765a1.068 1.068 0 0 0-.785-.313zm-18.23-44.754a1.068 1.068 0 0 0-1.068 1.066v6.74a1.068 1.068 0 0 0 1.068 1.069 1.068 1.068 0 0 0 1.066-1.068v-6.74a1.068 1.068 0 0 0-1.066-1.067zm-11.647.115a1.068 1.068 0 0 0-.285.035 1.068 1.068 0 0 0-.754 1.309l1.744 6.51a1.068 1.068 0 0 0 1.309.753 1.068 1.068 0 0 0 .754-1.306l-1.745-6.51a1.068 1.068 0 0 0-1.023-.791zm23.317.004a1.068 1.068 0 0 0-1.05.791l-1.745 6.51a1.068 1.068 0 0 0 .756 1.306 1.068 1.068 0 0 0 1.307-.753l1.744-6.51a1.068 1.068 0 0 0-.754-1.309 1.068 1.068 0 0 0-.258-.035zm-35.598 1.616a1.068 1.068 0 0 0-.725.313 1.068 1.068 0 0 0 0 1.51l4.766 4.765a1.068 1.068 0 0 0 1.51 0 1.068 1.068 0 0 0 0-1.51l-4.766-4.766a1.068 1.068 0 0 0-.785-.312zm8.936 10.455v10.852c3.426-.394 6.93.938 7.992 4.61.404-.213.359-.19.446-.237 8.372-3.856 11.803 4.574 8.57 9.422 4.24.207 6.19 2.239 6.726 4.46h5.375V59.434zm8.621 15.486c-65.706-49.945-32.853-24.973 0 0z"></path><path d="M91.104 71.066a9.532 9.532 0 0 0-3.443.615c-2.191.834-3.889 2.415-4.305 4.422-.416 2.008.344 4.71 3.793 8.031a1.071 1.071 0 0 1 .03 1.514 1.071 1.071 0 0 1-1.514.03c-1.215-1.17-2.147-2.321-2.856-3.446-4.735-1.035-7.512.638-8.758 3.023-1.22 2.338-.859 5.482 1.291 7.8h36.11c.846-.747 1.59-2.604 1.173-4.29-.418-1.692-1.724-3.247-5.195-3.562-.955 1.204-2.293 2.169-4.041 2.67a1.071 1.071 0 0 1-1.324-.735 1.071 1.071 0 0 1 .734-1.324c1.408-.403 2.444-1.178 3.146-2.139a1.071 1.071 0 0 1 .246-.365l.004-.006c.926-1.506 1.108-3.38.657-5.004-.396-1.422-1.26-2.577-2.537-3.154-1.21-.547-2.883-.616-5.123.33.126.756.184 1.562.127 2.438a1.071 1.071 0 0 1-1.14.998 1.071 1.071 0 0 1-.997-1.14c.218-3.333-1.042-5.06-2.89-5.995-.925-.468-2.035-.7-3.188-.711zm-4.758 24.989a1.071 1.071 0 0 0-.879.535l-2.506 4.34a1.071 1.071 0 0 0 .733 1.588l1.892.351-3.385 5.862a1.071 1.071 0 0 0 .393 1.463 1.071 1.071 0 0 0 1.463-.393l4.14-7.172a1.071 1.071 0 0 0-.732-1.588l-1.89-.351 1.747-3.03a1.071 1.071 0 0 0-.392-1.463 1.071 1.071 0 0 0-.584-.142zm15.464 0a1.071 1.071 0 0 0-.879.535l-2.506 4.34a1.071 1.071 0 0 0 .733 1.588l1.892.351-3.385 5.862a1.071 1.071 0 0 0 .393 1.463 1.071 1.071 0 0 0 1.463-.393l4.14-7.172a1.071 1.071 0 0 0-.732-1.588l-1.89-.351 1.747-3.03a1.071 1.071 0 0 0-.392-1.463 1.071 1.071 0 0 0-.584-.142z"></path>'}class ro extends f.Control{constructor(o){super(Object.assign(o,{position:"topcenter"}));c(this,"_sun");c(this,"_moon");c(this,"_clock");c(this,"_currentMoonIcon");c(this,"_currentSunIcon");c(this,"_unwatchHandler");f.Util.setOptions(this,o)}onAdd(){const o=!this.options.showTimeOfDay&&!this.options.showWeather&&this.options.showDigitalClock,a=E().state.currentWorldState;return this._container=f.DomUtil.create("div","clock"+(o?" clock--digital":"")),this._sun=f.DomUtil.create("div","clock__sun",this._container),this._moon=f.DomUtil.create("div","clock__moon",this._container),this._sun.style.transform="translate(-150px, -150px)",this._moon.style.transform="translate(-150px, -150px)",this._sun.innerHTML=`
		<svg class="svg-icon" aria-hidden="true">
	  		<use xlink:href="#icon--clock_sun" />
		</svg>`,this._moon.innerHTML=`
		<svg class="svg-icon" aria-hidden="true">
	  		<use xlink:href="#icon--clock_moon" />
		</svg>`,this.options.showDigitalClock&&(this._clock=f.DomUtil.create("div","clock__time",this._container)),this._unwatchHandler=A(a,r=>{this._update(r)},{deep:!0}),this._container}onRemove(){this._unwatchHandler&&this._unwatchHandler()}_update(o){const a=o.timeOfDay;let r;if(typeof a>"u")return;if(a>23100||a<12900){let i=a+900;i=i>=24e3?i-24e3:i,r=i/27600*2*Math.PI}else{const i=a-12900;r=Math.PI+i/20400*2*Math.PI}const n=r+Math.PI;a>=0?(this._sun.style.transform="translate("+Math.round(-50*Math.cos(r))+"px, "+Math.round(-50*Math.sin(r))+"px)",this._moon.style.transform="translate("+Math.round(-50*Math.cos(n))+"px, "+Math.round(-50*Math.sin(n))+"px)"):(this._sun.style.transform="translate(-150px, -150px)",this._moon.style.transform="translate(-150px, -150px)");const s=Dt(a);this.options.showDigitalClock&&(a>=0?(this._clock.classList.remove(s.night?"day":"night"),this._clock.classList.add(s.day?"day":"night"),this._clock.textContent=[s.hours.toString().padStart(2,"0"),s.minutes.toString().padStart(2,"0")].join(":")):(this._clock.classList.remove(s.night?"day":"night"),this._clock.textContent="")),this.options.showWeather&&(o.thundering?(this._setSunIcon("clock_sun_storm"),this._setMoonIcon("clock_moon_storm")):o.raining?(this._setSunIcon("clock_sun_rain"),this._setMoonIcon("clock_moon_rain")):(this._setSunIcon("clock_sun"),this._setMoonIcon("clock_moon")))}_setSunIcon(o){this._sun&&this._currentSunIcon!==o&&(this._sun.innerHTML=`
				<svg class="svg-icon" aria-hidden="true">
					<use xlink:href="#icon--${o}" />
				</svg>`,this._currentSunIcon=o)}_setMoonIcon(o){this._moon&&this._currentMoonIcon!==o&&(this._moon.innerHTML=`
				<svg class="svg-icon" aria-hidden="true">
					<use xlink:href="#icon--${o}" />
				</svg>`,this._currentMoonIcon=o)}}const hr=$({props:{leaflet:{type:Object,required:!0}},setup(e){const t=E(),o=d(()=>t.state.components.clockControl);let a=new ro(o.value);A(o,r=>{e.leaflet.removeControl(a),r&&(a=new ro(r),e.leaflet.addControl(a))},{deep:!0}),V(()=>e.leaflet.addControl(a)),G(()=>e.leaflet.removeControl(a))},render(){return null}});let gr=document.getElementById("icon--link"),Ce=document.getElementById("svg-sprite-component-wrap");Ce||(Ce=document.createElementNS("http://www.w3.org/2000/svg","svg"),Ce.id="svg-sprite-component-wrap",Ce.style.setProperty("display","none"),document.body.appendChild(Ce));if(!gr){let e=document.createElementNS("http://www.w3.org/2000/svg","symbol");Ce.appendChild(e),e.setAttribute("viewBox","0 0 269.4 271.84"),e.setAttribute("id","icon--link"),e.innerHTML='<path d="M110.774 86.501c-13.432 0-26.865 5.12-37.01 15.357l-58.551 59.088c-20.29 20.476-20.29 53.87 0 74.346l21.008 21.201c20.29 20.476 53.704 20.448 74.006.012l38.221-38.473a13.5 13.5 0 0 0-.064-19.092 13.5 13.5 0 0 0-19.092.062l-38.22 38.473c-10.117 10.185-25.582 10.195-35.673.012l-21.006-21.199c-10.091-10.183-10.091-26.155 0-36.338l58.55-59.086c10.092-10.183 25.57-10.183 35.66 0l10.995 11.094a13.5 13.5 0 0 0 19.092.086 13.5 13.5 0 0 0 .086-19.092l-10.992-11.094C137.639 91.62 124.206 86.5 110.774 86.5z"></path><path d="M196.174 0c-13.428.002-26.857 5.117-37.008 15.336l-38.219 38.473a13.5 13.5 0 0 0 .063 19.092 13.5 13.5 0 0 0 19.091-.063l38.22-38.473c10.117-10.185 25.582-10.195 35.673-.012l21.008 21.2c10.091 10.182 10.091 26.154 0 36.337l-58.55 59.088c-10.091 10.183-25.571 10.183-35.662 0l-10.992-11.094a13.5 13.5 0 0 0-19.092-.088 13.5 13.5 0 0 0-.088 19.092l10.994 11.094c20.29 20.476 53.727 20.476 74.018 0l58.55-59.088c20.29-20.476 20.29-53.87 0-74.346l-21.007-21.2c-10.145-10.24-23.57-15.351-36.998-15.35z"></path>'}class fr extends f.Control{constructor(t){super(t)}onAdd(){const t=E(),o=f.DomUtil.create("button","leaflet-control-button leaflet-control-link"),a=Vt(t),r=jt(t);return o.type="button",o.title=t.state.messages.linkTitle,o.innerHTML=`
		<svg class="svg-icon" aria-hidden="true">
		  <use xlink:href="#icon--link" />
		</svg>`,o.addEventListener("click",n=>{n.preventDefault(),Ho(window.location.href.split("#")[0]+t.getters.url).then(a).catch(r)}),o}}const yr=$({props:{leaflet:{type:Object,required:!0}},setup(e){const t=new fr({position:"bottomleft"});V(()=>e.leaflet.addControl(t)),G(()=>e.leaflet.removeControl(t))},render(){return null}});let wr=document.getElementById("icon--chat"),Me=document.getElementById("svg-sprite-component-wrap");Me||(Me=document.createElementNS("http://www.w3.org/2000/svg","svg"),Me.id="svg-sprite-component-wrap",Me.style.setProperty("display","none"),document.body.appendChild(Me));if(!wr){let e=document.createElementNS("http://www.w3.org/2000/svg","symbol");Me.appendChild(e),e.setAttribute("viewBox","0 0 255.35 204.89"),e.setAttribute("id","icon--chat"),e.innerHTML='<path d="M61.254 0C27.32 0 0 27.318 0 61.252v42.163c0 33.934 27.319 61.252 61.254 61.252h15.259l-21.095 38.319c-.46 1.82.236 2.723 3.955.918 13.531-6.566 53.741-27.223 77.092-39.237h57.636c33.934 0 61.254-27.318 61.254-61.252V61.252C255.355 27.317 228.036 0 194.101 0zm.053 80.558a17.531 17.531 0 0 1 .095 0 17.531 17.531 0 0 1 17.53 17.531 17.531 17.531 0 0 1-17.53 17.531A17.531 17.531 0 0 1 43.87 98.089a17.531 17.531 0 0 1 17.436-17.531zm67.688 0a17.531 17.531 0 0 1 .095 0 17.531 17.531 0 0 1 17.53 17.531 17.531 17.531 0 0 1-17.53 17.531 17.531 17.531 0 0 1-17.531-17.531 17.531 17.531 0 0 1 17.436-17.531zm67.733 0a17.531 17.531 0 0 1 .095 0 17.531 17.531 0 0 1 17.53 17.531 17.531 17.531 0 0 1-17.53 17.531 17.531 17.531 0 0 1-17.531-17.531 17.531 17.531 0 0 1 17.436-17.531z"></path>'}class vr extends f.Control{constructor(t){super(t)}onAdd(){const t=E(),o=f.DomUtil.create("button","leaflet-control-bottom leaflet-control-button leaflet-control-chat");return o.type="button",o.title=t.state.messages.chatTitle,o.innerHTML=`
		<svg class="svg-icon">
		  <use xlink:href="#icon--chat" />
		</svg>`,o.addEventListener("click",a=>{t.commit(m.TOGGLE_UI_ELEMENT_VISIBILITY,"chat"),a.stopPropagation(),a.preventDefault()}),f.DomEvent.on(o,"keydown",a=>{a.key==="ArrowRight"&&t.commit(m.SET_UI_ELEMENT_VISIBILITY,{element:"chat",state:!0})}),A(t.state.ui.visibleElements,a=>{o.setAttribute("aria-expanded",a.has("chat").toString())}),o}}const _r=$({props:{leaflet:{type:Object,required:!0}},setup(e){const t=new vr({position:"topleft"});V(()=>e.leaflet.addControl(t)),G(()=>e.leaflet.removeControl(t))},render(){return null}});class br extends f.Control{constructor(t){super(t)}onAdd(){const t=f.DomUtil.create("div","leaflet-control-logo");let o;if(this.options.url&&(o=f.DomUtil.create("a","",t),o.href=this.options.url,o.setAttribute("aria-label",this.options.text)),this.options.image){const a=f.DomUtil.create("img","",o);a.src=this.options.image,a.alt=this.options.text}else t.textContent=this.options.text;return t}}const Sr=$({props:{options:{type:Object,required:!0},leaflet:{type:Object,required:!0}},setup(e){return{control:new br(e.options)}},mounted(){this.leaflet.addControl(this.control)},unmounted(){this.leaflet.removeControl(this.control)},render(){return null}}),kr=new Set(["ArrowUp","ArrowDown","ArrowLeft","ArrowRight","Home","End"]),zt=(e,t)=>{if(e.target){if(kr.has(e.key)){const o=t.indexOf(e.target);if(o<0)return;let a=o;switch(e.key){case"ArrowUp":case"ArrowLeft":a=o-1;break;case"ArrowDown":case"ArrowRight":a=o+1;break;case"Home":a=0;break;case"End":a=t.length-1;break}a<0?a=t.length-1:a>=t.length&&(a=0),typeof t[a].dataset.ignore<"u"&&(a=e.key=="ArrowUp"||e.key=="ArrowLeft"?t.length-1:a+1),t[a].focus(),e.preventDefault()}else if(e.key==="Enter"&&e.target){const o=new MouseEvent("click",{ctrlKey:e.ctrlKey,shiftKey:e.shiftKey,metaKey:e.metaKey,altKey:e.altKey,bubbles:!0});e.target.dispatchEvent(o),e.preventDefault()}}};let Er=document.getElementById("icon--layers"),Te=document.getElementById("svg-sprite-component-wrap");Te||(Te=document.createElementNS("http://www.w3.org/2000/svg","svg"),Te.id="svg-sprite-component-wrap",Te.style.setProperty("display","none"),document.body.appendChild(Te));if(!Er){let e=document.createElementNS("http://www.w3.org/2000/svg","symbol");Te.appendChild(e),e.setAttribute("viewBox","0 0 234.46 247.78"),e.setAttribute("id","icon--layers"),e.innerHTML='<path d="m130.947 2.453 100.256 70.392c4.44 3.118 4.327 7.968-.254 10.876l-111.155 70.56c-4.58 2.908-11.842 2.739-16.282-.379L3.257 83.51c-4.44-3.117-4.327-7.968.253-10.875l111.155-70.56c4.58-2.908 11.842-2.74 16.282.378z"></path><path d="M217.846 154.897 119.79 217.14c-4.58 2.907-11.843 2.738-16.283-.38l-86.895-61.013-13.104 8.317c-4.58 2.908-4.693 7.757-.253 10.875l100.252 70.393c4.44 3.117 11.703 3.285 16.284.378l111.157-70.559c4.58-2.907 4.694-7.759.254-10.876z"></path><path d="m217.846 109.185-98.048 62.24c-4.58 2.908-11.843 2.739-16.283-.378L16.62 110.033 3.517 118.35c-4.58 2.908-4.694 7.759-.254 10.877l100.253 70.39c4.44 3.118 11.703 3.288 16.283.38l111.158-70.56c4.58-2.907 4.693-7.757.253-10.875z"></path>'}let Lr=document.getElementById("icon--checkbox"),Ie=document.getElementById("svg-sprite-component-wrap");Ie||(Ie=document.createElementNS("http://www.w3.org/2000/svg","svg"),Ie.id="svg-sprite-component-wrap",Ie.style.setProperty("display","none"),document.body.appendChild(Ie));if(!Lr){let e=document.createElementNS("http://www.w3.org/2000/svg","symbol");Ie.appendChild(e),e.setAttribute("viewBox","0 0 105.15 95.879"),e.setAttribute("id","icon--checkbox"),e.innerHTML='<path d="M97.014 14.81 48.221 63.603 26.547 41.929l-9.191 9.193L48.22 81.987l57.984-57.986z" stroke="#222" stroke-width="6"></path>'}f.Control.LayersObject;f.Control.LayersOptions;const se=E();class Cr extends f.Control.Layers{constructor(o,a,r){super(o,a,Object.assign(r||{},{sortLayers:!0,sortFunction:(n,s,i,l)=>{const p=this._layerPositions.get(n)||0,g=this._layerPositions.get(s)||0;return p!==g?p-g:i<l?-1:i>l?1:0}}));c(this,"_layersButton");c(this,"_layerPositions");c(this,"visible",!1);this._layerPositions=new Map}hasLayer(o){return!!super._getLayer(f.Util.stamp(o))}expand(){this._layersButton.setAttribute("aria-expanded","true"),this._section.style.display="",this.handleResize();const o=this._container.querySelector("input");return o&&o.focus(),super._checkDisabledLayers(),this}collapse(){return this._layersButton.setAttribute("aria-expanded","false"),this._section.style.display="none",this}_initLayout(){const o="leaflet-control-layers",a=this._container=f.DomUtil.create("div",o),r=this._section=f.DomUtil.create("section",o+"-list"),n=this._layersButton=f.DomUtil.create("button",o+"-toggle",a);f.DomEvent.disableClickPropagation(a),f.DomEvent.disableScrollPropagation(a),f.DomEvent.on(n,"keydown",s=>{s.key==="ArrowRight"&&se.commit(m.SET_UI_ELEMENT_VISIBILITY,{element:"layers",state:!0})}),f.DomEvent.on(a,"keydown",s=>{s.key==="ArrowLeft"&&(s.preventDefault(),se.commit(m.SET_UI_ELEMENT_VISIBILITY,{element:"layers",state:!1}),re(()=>n.focus()));const i=Array.from(a.querySelectorAll("input"));zt(s,i)}),f.DomEvent.on(n,"click",()=>se.commit(m.TOGGLE_UI_ELEMENT_VISIBILITY,"layers")),r.style.display="none",n.title=se.state.messages.layersTitle,n.setAttribute("aria-expanded","false"),n.innerHTML=`
			<svg class="svg-icon" aria-hidden="true">
			  <use xlink:href="#icon--layers" />
			</svg>`,A(se.state.ui.visibleElements,s=>{s.has("layers")&&!this.visible?this.expand():this.visible&&!s.has("layers")&&this.collapse(),this.visible=se.state.ui.visibleElements.has("layers")}),A(se.state.messages,s=>n.title=s.layersTitle),this.visible=se.state.ui.visibleElements.has("layers"),this.visible&&this.expand(),this._baseLayersList=f.DomUtil.create("div",o+"-base",r),this._separator=f.DomUtil.create("div",o+"-separator",r),this._overlaysList=f.DomUtil.create("div",o+"-overlays",r),a.appendChild(r),window.addEventListener("resize",()=>this.handleResize()),this.handleResize()}handleResize(){const o=this._layersButton.getBoundingClientRect().y;this._section.style.maxHeight=`calc(100vh - ${o+30+10+55}px)`}addOverlayAtPosition(o,a,r){return this._layerPositions.set(o,r),super.addOverlay(o,a)}addOverlay(o,a){return this._layerPositions.set(o,0),super.addOverlay(o,a)}removeLayer(o){return this._layerPositions.delete(o),super.removeLayer(o)}_addItem(o){const a=o.overlay?this._overlaysList:this._baseLayersList,r=document.createElement("label"),n=document.createElement("span"),s=this._map.hasLayer(o.layer);let i;return r.className="layer checkbox",o.overlay?(i=document.createElement("input"),i.type="checkbox",i.className="leaflet-control-layers-selector",i.defaultChecked=s):i=super._createRadioElement("leaflet-base-layers_"+f.Util.stamp(this),s),i.layerId=f.Util.stamp(o.layer),this._layerControlInputs.push(i),n.textContent=o.name,f.DomEvent.on(i,"click",l=>super._onInputClick(l),this),r.appendChild(i),r.insertAdjacentHTML("beforeend",`
		<svg class="svg-icon" aria-hidden="true">
	  		<use xlink:href="#icon--checkbox" />
		</svg>`),r.appendChild(n),a.appendChild(r),super._checkDisabledLayers(),n}onRemove(o){this._layerControlInputs=[],super.onRemove(o)}}class Mr{constructor(t){c(this,"layerControl");c(this,"map");const o=d(()=>E().state.components.layerControl);this.map=t,this.layerControl=new Cr({},{},{position:"topleft"}),o.value&&this.map.addControl(this.layerControl),A(o,a=>{a?this.map.addControl(this.layerControl):this.map.removeControl(this.layerControl)})}addLayer(t,o,a,r){this.map.addLayer(t),o&&(this.layerControl.hasLayer(t)&&this.layerControl.removeLayer(t),typeof r<"u"?this.layerControl.addOverlayAtPosition(t,a,r):this.layerControl.addOverlay(t,a))}addHiddenLayer(t,o,a){this.layerControl.hasLayer(t)&&this.layerControl.removeLayer(t),typeof a<"u"?this.layerControl.addOverlayAtPosition(t,o,a):this.layerControl.addOverlay(t,o)}removeLayer(t){this.map.removeLayer(t),this.layerControl.removeLayer(t)}}class Tr extends f.Map{constructor(o,a){super(o,a);c(this,"_layerManager");this._layerManager=Object.seal(new Mr(this))}getLayerManager(){return this._layerManager}_initControlPos(){const o=this._controlCorners={},a="leaflet-",r=this._controlContainer=f.DomUtil.create("div",a+"control-container",this._container);function n(s,i){const l=a+s+" "+a+i;o[`${s}${i}`]=f.DomUtil.create("div",l,r)}n("top","left"),n("top","right"),n("top","center"),n("bottom","center"),n("bottom","left"),n("bottom","right")}}let Ir=document.getElementById("icon--loading"),$e=document.getElementById("svg-sprite-component-wrap");$e||($e=document.createElementNS("http://www.w3.org/2000/svg","svg"),$e.id="svg-sprite-component-wrap",$e.style.setProperty("display","none"),document.body.appendChild($e));if(!Ir){let e=document.createElementNS("http://www.w3.org/2000/svg","symbol");$e.appendChild(e),e.setAttribute("stroke","#fff"),e.setAttribute("id","icon--loading"),e.setAttribute("viewBox","0 0 38 38"),e.innerHTML='<g transform="translate(1 1)" stroke-width="2" fill="none"><circle stroke-opacity=".5" cx="18" cy="18" r="18"></circle><path d="M36 18c0-9.94-8.06-18-18-18"><animatetransform attributeName="transform" type="rotate" from="0 18 18" to="360 18 18" dur="1s" repeatCount="indefinite"></animatetransform></path></g>'}class $r extends f.Control{constructor(o){super(o);c(this,"_dataLoaders",new Set);c(this,"_loadingIndicator");c(this,"_delayIndicatorTimeout",null);this._loadingIndicator=f.DomUtil.create("div","leaflet-control-button leaflet-control-loading")}onAdd(o){return this._loadingIndicator.title=E().state.messages.loadingTitle,this._loadingIndicator.hidden=!0,this._loadingIndicator.innerHTML=`
		<svg class="svg-icon">
		  <use xlink:href="#icon--loading" />
		</svg>`,this._addLayerListeners(o),this._addMapListeners(o),this._loadingIndicator}onRemove(o){this._removeLayerListeners(o),this._removeMapListeners(o)}addLoader(o){this._dataLoaders.add(o),this.options.delayIndicator&&!this._delayIndicatorTimeout?this._delayIndicatorTimeout=setTimeout(()=>{this.updateIndicator(),this._delayIndicatorTimeout=null},this.options.delayIndicator):this.updateIndicator()}removeLoader(o){this._dataLoaders.delete(o),this.updateIndicator(),this.options.delayIndicator&&this._delayIndicatorTimeout&&!this.isLoading()&&(clearTimeout(this._delayIndicatorTimeout),this._delayIndicatorTimeout=null)}updateIndicator(){this.isLoading()?this._showIndicator():this._hideIndicator()}isLoading(){return this._countLoaders()>0}_countLoaders(){return this._dataLoaders.size}_showIndicator(){this._loadingIndicator.hidden=!1}_hideIndicator(){this._loadingIndicator.hidden=!0}_handleLoading(o){this.addLoader(this.getEventId(o))}_handleBaseLayerChange(o){o.layer&&o.layer.eachLayer&&typeof o.layer.eachLayer=="function"&&o.layer.eachLayer(a=>{this._handleBaseLayerChange({layer:a})})}_handleLoad(o){this.removeLoader(this.getEventId(o))}getEventId(o){return o.id?o.id:o.layer?o.layer._leaflet_id:o.target._leaflet_id}_layerAdd(o){if(o.layer instanceof f.TileLayer)try{o.layer.isLoading()&&this.addLoader(o.layer._leaflet_id),o.layer.on("loading",this._handleLoading,this),o.layer.on("load",this._handleLoad,this)}catch(a){console.warn("L.Control.Loading: Tried and failed to add  event handlers to layer",o.layer),console.warn("L.Control.Loading: Full details",a)}}_layerRemove(o){if(o.layer instanceof f.TileLayer)try{o.layer.off("loading",this._handleLoading,this),o.layer.off("load",this._handleLoad,this)}catch(a){console.warn("L.Control.Loading: Tried and failed to remove event handlers from layer",o.layer),console.warn("L.Control.Loading: Full details",a)}}_addLayerListeners(o){o.eachLayer(a=>{a instanceof f.TileLayer&&(a.isLoading()&&this.addLoader(a._leaflet_id),a.on("loading",this._handleLoading,this),a.on("load",this._handleLoad,this))}),o.on("layeradd",this._layerAdd,this),o.on("layerremove",this._layerRemove,this)}_removeLayerListeners(o){o.eachLayer(a=>{a instanceof f.TileLayer&&(this.removeLoader(a._leaflet_id),a.off("loading",this._handleLoading,this),a.off("load",this._handleLoad,this))}),o.off("layeradd",this._layerAdd,this),o.off("layerremove",this._layerRemove,this)}_addMapListeners(o){o.on("baselayerchange",this._handleBaseLayerChange,this),o.on("dataloading",this._handleLoading,this),o.on("dataload",this._handleLoad,this),o.on("layerremove",this._handleLoad,this)}_removeMapListeners(o){o.off("baselayerchange",this._handleBaseLayerChange,this),o.off("dataloading",this._handleLoading,this),o.off("dataload",this._handleLoad,this),o.off("layerremove",this._handleLoad,this)}}const Ar={name:"svg-icon",props:{name:{type:String,required:!0},title:{type:String,default:null}},setup(e){const t=d(()=>`#icon--${e.name}`),o=d(()=>`svg-icon svg-icon--${e.name}`);return{iconPath:t,className:o}}},zr={key:0},Pr=["xlink:href"];function Ur(e,t,o,a,r,n){return u(),v("svg",{class:le(a.className),xmlns:"http://www.w3.org/2000/svg","aria-hidden":"true"},[o.title?(u(),v("title",zr,M(o.title),1)):I("",!0),h("use",{"xlink:href":a.iconPath},null,8,Pr)],2)}const ge=R(Ar,[["render",Ur]]);let Nr=document.getElementById("icon--block_world_surface"),Ae=document.getElementById("svg-sprite-component-wrap");Ae||(Ae=document.createElementNS("http://www.w3.org/2000/svg","svg"),Ae.id="svg-sprite-component-wrap",Ae.style.setProperty("display","none"),document.body.appendChild(Ae));if(!Nr){let e=document.createElementNS("http://www.w3.org/2000/svg","symbol");Ae.appendChild(e),e.setAttribute("viewBox","0 0 194.86 225"),e.setAttribute("id","icon--block_world_surface"),e.innerHTML='<g transform="translate(-56.845 -44.525)"><path d="m154.27 44.525-97.428 56.25 19.486 11.25 77.942-45 77.942 45 19.486-11.25z" fill="#66a443"></path><path d="m154.27 157.02-77.942-45 77.942-45 77.942 45z" fill="#77b551"></path><path d="m56.845 213.27v-112.5l19.486 11.25v90l77.942 45v22.5z" fill="#468234"></path><path d="m76.33 202.02v-90l77.942 45v90z" fill="#549141"></path><path d="m232.21 202.02v-90l-77.942 45v90z" fill="#3b823b"></path><path d="m232.21 112.02v90l-77.942 45v22.5l97.428-56.25v-112.5z" fill="#2c722d"></path></g>'}let Or=document.getElementById("icon--block_world_cave"),ze=document.getElementById("svg-sprite-component-wrap");ze||(ze=document.createElementNS("http://www.w3.org/2000/svg","svg"),ze.id="svg-sprite-component-wrap",ze.style.setProperty("display","none"),document.body.appendChild(ze));if(!Or){let e=document.createElementNS("http://www.w3.org/2000/svg","symbol");ze.appendChild(e),e.setAttribute("viewBox","0 0 194.86 225"),e.setAttribute("id","icon--block_world_cave"),e.innerHTML='<g transform="translate(-56.845 -44.525)"><path d="m154.27 44.525-97.428 56.25 19.486 11.25 77.942-45 77.942 45 19.486-11.25z" fill="#636767"></path><path d="m154.27 157.02-77.942-45 77.942-45 77.942 45z" fill="#9ba2a3"></path><path d="m56.845 213.27v-112.5l19.486 11.25v90l77.942 45v22.5z" fill="#67656a"></path><path d="m76.33 202.02v-90l77.942 45z" fill="#776d70"></path><path d="m76.33 202.02 77.942-45v90z" fill="#837f84"></path><path d="m232.21 202.02v-90l-77.942 45v90z" fill="#84858b"></path><path d="m232.21 112.02v90l-77.942 45v22.5l97.428-56.25v-112.5z" fill="#72727c"></path></g>'}let Rr=document.getElementById("icon--block_world_biome"),Pe=document.getElementById("svg-sprite-component-wrap");Pe||(Pe=document.createElementNS("http://www.w3.org/2000/svg","svg"),Pe.id="svg-sprite-component-wrap",Pe.style.setProperty("display","none"),document.body.appendChild(Pe));if(!Rr){let e=document.createElementNS("http://www.w3.org/2000/svg","symbol");Pe.appendChild(e),e.setAttribute("viewBox","0 0 194.86 225"),e.setAttribute("id","icon--block_world_biome"),e.innerHTML='<g transform="translate(-56.845 -44.525)"><path d="m154.27 44.525-97.428 56.25 19.486 11.25 77.942-45 77.942 45 19.486-11.25z" fill="#2c8ed9"></path><path d="m154.27 157.02-77.942-45 77.942-45 77.942 45z" fill="#46c0f1"></path><path d="m56.845 213.27v-112.5l19.486 11.25v90l77.942 45v22.5z" fill="#e15915"></path><path d="m76.33 202.02v-90l77.942 45v90z" fill="#ea952b"></path><path d="m232.21 202.02v-90l-77.942 45v90z" fill="#b5279f"></path><path d="m232.21 112.02v90l-77.942 45v22.5l97.428-56.25v-112.5z" fill="#94116a"></path></g>'}let Dr=document.getElementById("icon--block_world_flat"),Ue=document.getElementById("svg-sprite-component-wrap");Ue||(Ue=document.createElementNS("http://www.w3.org/2000/svg","svg"),Ue.id="svg-sprite-component-wrap",Ue.style.setProperty("display","none"),document.body.appendChild(Ue));if(!Dr){let e=document.createElementNS("http://www.w3.org/2000/svg","symbol");Ue.appendChild(e),e.setAttribute("viewBox","0 0 224.88 224.88"),e.setAttribute("id","icon--block_world_flat"),e.innerHTML='<g transform="translate(-3.866 -14.578)"><rect x="11.366" y="22.078" width="209.88" height="209.88" ry="13.523" fill="#56bc3a"></rect><path d="M62.314 231.96h145.41a13.493 13.493 0 0 0 13.523-13.523V86.977c-109.53-19.382-158.93 144.98-158.93 144.98z" fill="#36c1df"></path></g><path opacity=".335" d="M173.19 92.012c-2.987 6.581 23.116 21.259 7.869 36.129-18.502 16.613 8.56 36.592-21.823 51.472-16.422 4.782-43.518-38.241-47.51-10.136-2.672 36.879-43.356 18.551-16.493 53.526H48.02c-4.77-46.459 15.402-83.567 38.889-91.661 63.696-21.95 27.812-40.803 67.037-69.23 24.344-20.731 39.502-33.812 69.05-22.989l-.694 39.645c-15.225 10.522-44.572 3.239-49.113 13.244z" fill="#dece95"></path><g transform="translate(-3.866 -14.578)"><path d="M171.44 100.97c-2.987 6.581 23.116 21.259 7.869 36.129-18.502 16.613 8.56 36.592-21.823 51.472-16.422 4.782-43.518-38.241-47.51-10.136-2.672 36.879-43.356 18.551-16.493 53.526H46.27c-4.77-46.459 15.402-83.567 38.889-91.661 63.695-21.95 27.812-40.803 67.037-69.23 24.344-20.731 39.502-33.812 69.05-22.989l-.694 39.645c-15.225 10.522-44.572 3.239-49.113 13.244z" fill="#dece95"></path><rect x="11.366" y="22.078" width="209.88" height="209.88" ry="13.523" fill="none" stroke="#437c33" stroke-width="15"></rect></g>'}let Hr=document.getElementById("icon--block_nether_flat"),Ne=document.getElementById("svg-sprite-component-wrap");Ne||(Ne=document.createElementNS("http://www.w3.org/2000/svg","svg"),Ne.id="svg-sprite-component-wrap",Ne.style.setProperty("display","none"),document.body.appendChild(Ne));if(!Hr){let e=document.createElementNS("http://www.w3.org/2000/svg","symbol");Ne.appendChild(e),e.setAttribute("viewBox","0 0 224.88 224.88"),e.setAttribute("id","icon--block_nether_flat"),e.innerHTML='<rect x="11.366" y="22.078" width="209.88" height="209.88" ry="13.523" fill="#443937" transform="translate(-3.866 -14.578)"></rect><path d="M58.448 217.382h145.41a13.493 13.493 0 0 0 13.523-13.523V72.399c-109.53-19.382-158.93 144.98-158.93 144.98z" fill="#dc6725"></path><path opacity=".335" d="M173.19 92.012c-2.987 6.581 23.116 21.259 7.869 36.129-18.502 16.613 8.56 36.592-21.823 51.472-16.422 4.782-43.518-38.241-47.51-10.136-2.672 36.879-43.356 18.551-16.493 53.526H48.02c-4.77-46.459 15.402-83.567 38.889-91.661 63.696-21.95 27.812-40.803 67.037-69.23 24.344-20.731 39.502-33.812 69.05-22.989l-.694 39.645c-15.225 10.522-44.572 3.239-49.113 13.244z" fill="#932626"></path><path d="M167.574 86.392c-2.987 6.581 23.116 21.259 7.869 36.129-18.502 16.613 8.56 36.592-21.823 51.472-16.422 4.782-43.518-38.241-47.51-10.136-2.672 36.879-43.356 18.551-16.493 53.526H42.404c-4.77-46.459 15.402-83.567 38.889-91.661 63.695-21.95 27.812-40.803 67.037-69.23 24.344-20.731 39.502-33.812 69.051-22.989l-.695 39.645c-15.225 10.522-44.572 3.239-49.113 13.244z" fill="#932626"></path><rect x="11.366" y="22.078" width="209.88" height="209.88" ry="13.523" fill="none" stroke="#532727" stroke-width="15" transform="translate(-3.866 -14.578)"></rect>'}let xr=document.getElementById("icon--block_nether_surface"),Oe=document.getElementById("svg-sprite-component-wrap");Oe||(Oe=document.createElementNS("http://www.w3.org/2000/svg","svg"),Oe.id="svg-sprite-component-wrap",Oe.style.setProperty("display","none"),document.body.appendChild(Oe));if(!xr){let e=document.createElementNS("http://www.w3.org/2000/svg","symbol");Oe.appendChild(e),e.setAttribute("viewBox","0 0 194.86 225"),e.setAttribute("id","icon--block_nether_surface"),e.innerHTML='<g transform="translate(-56.845 -44.525)"><path d="m154.27 44.525-97.428 56.25 19.486 11.25 77.942-45 77.942 45 19.486-11.25z" fill="#ca2717"></path><path d="m154.27 157.02-77.942-45 77.942-45 77.942 45z" fill="#dc442b"></path><path d="m56.845 213.27v-112.5l19.486 11.25v90l77.942 45v22.5z" fill="#9d0a17"></path><path d="m76.33 202.02v-90l77.942 45v90z" fill="#b02222"></path><path d="m232.21 202.02v-90l-77.942 45v90z" fill="#9b212d"></path><path d="m232.21 112.02v90l-77.942 45v22.5l97.428-56.25v-112.5z" fill="#8a0822"></path></g>'}let Br=document.getElementById("icon--block_the_end_flat"),Re=document.getElementById("svg-sprite-component-wrap");Re||(Re=document.createElementNS("http://www.w3.org/2000/svg","svg"),Re.id="svg-sprite-component-wrap",Re.style.setProperty("display","none"),document.body.appendChild(Re));if(!Br){let e=document.createElementNS("http://www.w3.org/2000/svg","symbol");Re.appendChild(e),e.setAttribute("viewBox","0 0 224.88 224.88"),e.setAttribute("id","icon--block_the_end_flat"),e.innerHTML='<g transform="translate(-3.866 -14.578)"><rect x="11.366" y="22.078" width="209.88" height="209.88" ry="13.523" fill="#bfbd7a"></rect><path d="M62.314 231.96h145.41a13.493 13.493 0 0 0 13.523-13.523V86.977c-109.53-19.382-158.93 144.98-158.93 144.98z" fill="#0c0902"></path><path d="M171.44 100.97c-2.987 6.581 23.116 21.259 7.869 36.129-18.502 16.613 8.56 36.592-21.823 51.472-16.422 4.782-43.518-38.241-47.51-10.136-2.672 36.879-43.356 18.551-16.493 53.526H46.27c-4.77-46.459 15.402-83.567 38.889-91.661 63.695-21.95 27.812-40.803 67.037-69.23 24.344-20.731 39.502-33.812 69.05-22.989l-.694 39.645c-15.225 10.522-44.572 3.239-49.113 13.244z" fill="#e6eca4"></path><rect x="11.366" y="22.078" width="209.88" height="209.88" ry="13.523" fill="none" stroke="#534427" stroke-width="15"></rect></g>'}let Wr=document.getElementById("icon--block_the_end_surface"),De=document.getElementById("svg-sprite-component-wrap");De||(De=document.createElementNS("http://www.w3.org/2000/svg","svg"),De.id="svg-sprite-component-wrap",De.style.setProperty("display","none"),document.body.appendChild(De));if(!Wr){let e=document.createElementNS("http://www.w3.org/2000/svg","symbol");De.appendChild(e),e.setAttribute("viewBox","0 0 194.86 225"),e.setAttribute("id","icon--block_the_end_surface"),e.innerHTML='<g transform="translate(-56.845 -44.525)"><path d="m154.27 44.525-97.428 56.25 19.486 11.25 77.942-45 77.942 45 19.486-11.25z" fill="#cdc683"></path><path d="m154.27 157.02-77.942-45 77.942-45 77.942 45z" fill="#e1e5ab"></path><path d="m56.845 213.27v-112.5l19.486 11.25v90l77.942 45v22.5z" fill="#b8b372"></path><path d="m76.33 202.02v-90l77.942 45v90z" fill="#cdc683"></path><path d="m232.21 202.02v-90l-77.942 45v90z" fill="#b4a665"></path><path d="m232.21 112.02v90l-77.942 45v22.5l97.428-56.25v-112.5z" fill="#908046"></path></g>'}let Zr=document.getElementById("icon--block_other"),He=document.getElementById("svg-sprite-component-wrap");He||(He=document.createElementNS("http://www.w3.org/2000/svg","svg"),He.id="svg-sprite-component-wrap",He.style.setProperty("display","none"),document.body.appendChild(He));if(!Zr){let e=document.createElementNS("http://www.w3.org/2000/svg","symbol");He.appendChild(e),e.setAttribute("viewBox","0 0 194.86 225"),e.setAttribute("id","icon--block_other"),e.innerHTML='<g transform="translate(-56.845 -44.525)"><path d="m154.27 44.525-97.428 56.25 19.486 11.25 77.942-45 77.942 45 19.486-11.25z" fill="#5e6464"></path><path d="m154.27 157.02-77.942-45 77.942-45 77.942 45z" fill="#929594"></path><path d="m56.845 213.27v-112.5l19.486 11.25v90l77.942 45v22.5z" fill="#525252"></path><path d="m76.33 202.02v-90l77.942 45v90z" fill="#696969"></path><path d="m232.21 202.02v-90l-77.942 45v90z" fill="#555356"></path><path d="m232.21 112.02v90l-77.942 45v22.5l97.428-56.25v-112.5z" fill="#3c373d"></path></g>'}let Vr=document.getElementById("icon--block_other_flat"),xe=document.getElementById("svg-sprite-component-wrap");xe||(xe=document.createElementNS("http://www.w3.org/2000/svg","svg"),xe.id="svg-sprite-component-wrap",xe.style.setProperty("display","none"),document.body.appendChild(xe));if(!Vr){let e=document.createElementNS("http://www.w3.org/2000/svg","symbol");xe.appendChild(e),e.setAttribute("viewBox","0 0 224.88 224.88"),e.setAttribute("id","icon--block_other_flat"),e.innerHTML='<g transform="translate(-3.866 -14.578)"><rect x="11.366" y="22.078" width="209.88" height="209.88" ry="13.523" fill="#4c4b51"></rect><path d="M62.314 231.96h145.41a13.493 13.493 0 0 0 13.523-13.523V86.977c-109.53-19.382-158.93 144.98-158.93 144.98z" fill="#332f2e"></path></g><path opacity=".335" d="M173.19 92.012c-2.987 6.581 23.116 21.259 7.869 36.129-18.502 16.613 8.56 36.592-21.823 51.472-16.422 4.782-43.518-38.241-47.51-10.136-2.672 36.879-43.356 18.551-16.493 53.526H48.02c-4.77-46.459 15.402-83.567 38.889-91.661 63.696-21.95 27.812-40.803 67.037-69.23 24.344-20.731 39.502-33.812 69.05-22.989l-.694 39.645c-15.225 10.522-44.572 3.239-49.113 13.244z" fill="#6a7072"></path><g transform="translate(-3.866 -14.578)"><path d="M171.44 100.97c-2.987 6.581 23.116 21.259 7.869 36.129-18.502 16.613 8.56 36.592-21.823 51.472-16.422 4.782-43.518-38.241-47.51-10.136-2.672 36.879-43.356 18.551-16.493 53.526H46.27c-4.77-46.459 15.402-83.567 38.889-91.661 63.695-21.95 27.812-40.803 67.037-69.23 24.344-20.731 39.502-33.812 69.05-22.989l-.694 39.645c-15.225 10.522-44.572 3.239-49.113 13.244z" fill="#6a7072"></path><rect x="11.366" y="22.078" width="209.88" height="209.88" ry="13.523" fill="none" stroke="#13212c" stroke-width="15"></rect></g>'}let jr=document.getElementById("icon--block_skylands"),Be=document.getElementById("svg-sprite-component-wrap");Be||(Be=document.createElementNS("http://www.w3.org/2000/svg","svg"),Be.id="svg-sprite-component-wrap",Be.style.setProperty("display","none"),document.body.appendChild(Be));if(!jr){let e=document.createElementNS("http://www.w3.org/2000/svg","symbol");Be.appendChild(e),e.setAttribute("viewBox","0 0 194.86 225"),e.setAttribute("id","icon--block_skylands"),e.innerHTML='<g transform="translate(-56.845 -44.525)"><path d="m154.27 44.525-97.428 56.25 19.486 11.25 77.942-45 77.942 45 19.486-11.25z" fill="#5cd1e9"></path><path d="m154.27 157.02-77.942-45 77.942-45 77.942 45z" fill="#79edf4"></path><path d="m56.845 213.27v-112.5l19.486 11.25v90l77.942 45v22.5z" fill="#2076bf"></path><path d="m76.33 202.02v-90l77.942 45v90z" fill="#34a7dc"></path><path d="m232.21 202.02v-90l-77.942 45v90z" fill="#005ec9"></path><path d="m232.21 112.02v90l-77.942 45v22.5l97.428-56.25v-112.5z" fill="#0043aa"></path></g>'}const Fr=$({name:"WorldListItem",components:{SvgIcon:ge},props:{world:{type:Object,required:!0},name:{type:String,default:"map"}},setup(e){const t=E(),o=d(()=>t.state.configuration.singleMapWorlds),a=d(()=>{const n=[];return e.world.maps.forEach(s=>{(!s.appendedWorld||s.appendedWorld.name===e.world.name)&&n.push(s)}),n});return{currentMap:d({get:()=>t.state.currentMap?[t.state.currentWorld.name,t.state.currentMap.name]:void 0,set:n=>n&&t.commit(m.SET_CURRENT_MAP,{worldName:n[0],mapName:n[1]})}),singleMapWorlds:o,maps:a}}});const Gr=["id","name","value","aria-labelledby"],qr=["id","for"],Kr={key:0,class:"world"},Yr={class:"world__name","aria-hidden":"true"},Qr={class:"world__maps menu"},Jr=["id","name","value","aria-labelledby"],Xr=["id","for","title"],en=["src"];function tn(e,t,o,a,r,n){const s=S("SvgIcon");return e.singleMapWorlds?(u(),v(x,{key:0},[B(h("input",{id:`${e.name}-${e.maps[0].world.name}-${e.maps[0].name}`,type:"radio",name:e.name,value:[e.maps[0].world.name,e.maps[0].name],"onUpdate:modelValue":t[0]||(t[0]=i=>e.currentMap=i),"aria-labelledby":`${e.name}-${e.maps[0].world.name}-${e.maps[0].name}-label`},null,8,Gr),[[ct,e.currentMap]]),h("label",{id:`${e.name}-${e.maps[0].world.name}-${e.maps[0].name}-label`,for:`${e.name}-${e.maps[0].world.name}-${e.maps[0].name}`},M(e.maps[0].world.displayName),9,qr)],64)):(u(),v(x,{key:1},[e.maps.length?(u(),v("div",Kr,[h("span",Yr,M(e.world.displayName),1),h("div",Qr,[(u(!0),v(x,null,Y(e.maps,i=>(u(),v(x,{key:`${i.world.name}_${i.name}`},[B(h("input",{id:`${e.name}-${i.world.name}-${i.name}`,type:"radio",name:e.name,value:[i.world.name,i.name],"onUpdate:modelValue":t[1]||(t[1]=l=>e.currentMap=l),"aria-labelledby":`${e.name}-${i.world.name}-${i.name}-label`},null,8,Jr),[[ct,e.currentMap]]),h("label",{id:`${e.name}-${i.world.name}-${i.name}-label`,class:"map",for:`${e.name}-${i.world.name}-${i.name}`,title:`${i.world.displayName} - ${i.displayName}`},[i.hasCustomIcon()?(u(),v("img",{key:0,src:i.getIcon(),alt:""},null,8,en)):(u(),T(s,{key:1,name:i.getIcon()},null,8,["name"]))],8,Xr)],64))),128))])])):I("",!0)],64))}const Uo=R(Fr,[["render",tn],["__scopeId","data-v-393a93f5"]]),on=$({name:"MapContextMenu",components:{WorldListItem:Uo},props:{leaflet:{type:Object,required:!0}},setup(e){const t=E(),o=L(null),a=L(null),r=d(()=>t.state.messages.contextMenuCopyLink),n=d(()=>t.state.messages.contextMenuCenterHere),s=L(null),i=d(()=>!!o.value),l=d(()=>t.state.currentMap),p=d(()=>t.state.currentZoom),g=d(()=>{var b,j;return l.value?(b=l.value)!=null&&b.appendedWorld?(j=l.value)==null?void 0:j.appendedWorld.maps.size:l.value.world.maps.size:0}),y=d(()=>!o.value||!l.value?{x:0,y:0,z:0}:l.value.latLngToLocation(o.value.latlng,64)),_=d(()=>`X: ${Math.round(y.value.x)}, Z: ${Math.round(y.value.z)}`),C=d(()=>`${Math.round(y.value.x)}, ${Math.round(y.value.z)}`),z=d(()=>{if(!l.value)return"";const b=new URL(window.location.href);return b.hash=lo(l.value,y.value,p.value),b}),O=d(()=>{if(!o.value)return{visibility:"hidden",left:"-1000px"};const b=Math.min(window.innerWidth-s.value.offsetWidth-10,o.value.originalEvent.clientX),j=Math.min(window.innerHeight-s.value.offsetHeight-10,o.value.originalEvent.clientY);return{transform:`translate(${b}px, ${j}px)`}}),U=b=>{b.key==="Escape"&&i.value&&k()},w=b=>{zt(b,Array.from(s.value.querySelectorAll("button, input")))},P=()=>{if(s.value){const b=s.value.querySelector("button");b&&b.focus()}},k=()=>o.value=null,N=()=>{o.value&&(e.leaflet.panTo(o.value.latlng),e.leaflet.getContainer().focus())};return A(o,b=>{b&&(e.leaflet.closePopup(),re(()=>s.value&&P()))}),V(()=>{window.addEventListener("click",k),window.addEventListener("keyup",U)}),G(()=>{window.removeEventListener("click",k),window.removeEventListener("keyup",U)}),e.leaflet.on("movestart",k),e.leaflet.on("zoomstart",k),e.leaflet.on("contextmenu",b=>{b.originalEvent.target&&b.originalEvent.target.closest(".leaflet-control")||(b.originalEvent.stopImmediatePropagation(),b.originalEvent.preventDefault(),o.value=b)}),e.leaflet.on("mousemove",b=>{a.value=b}),window.addEventListener("contextmenu",b=>{b.target&&b.target instanceof HTMLElement&&b.target.classList.contains("leaflet-zoom-animated")&&(b.preventDefault(),b.stopImmediatePropagation(),a.value&&(o.value=a.value))}),{messageCopyLink:r,messageCenterHere:n,copySuccess:Vt(t),copyError:jt(t),menuVisible:i,menuElement:s,url:z,locationLabel:_,locationCopy:C,currentMap:l,mapCount:g,style:O,pan:N,handleKeydown:w}}});const an={class:"menu",role:"menu"},rn={role:"none"},nn={type:"button",role:"menuitem"},sn={role:"none"},ln={type:"button",role:"menuitem"},dn={role:"none"};function cn(e,t,o,a,r,n){const s=S("WorldListItem"),i=no("clipboard");return u(),v("nav",{role:"none",id:"map-context-menu",ref:"menuElement",style:xo(e.style),onKeydown:t[1]||(t[1]=(...l)=>e.handleKeydown&&e.handleKeydown(...l))},[h("ul",an,[h("li",rn,[B((u(),v("button",nn,[te(M(e.locationLabel),1)])),[[i,e.locationCopy,"copy"],[i,e.copySuccess,"success"],[i,e.copyError,"error"]])]),h("li",sn,[B((u(),v("button",ln,[te(M(e.messageCopyLink),1)])),[[i,e.url,"copy"],[i,e.copySuccess,"success"],[i,e.copyError,"error"]])]),h("li",dn,[h("button",{type:"button",role:"menuitem",onClick:t[0]||(t[0]=J((...l)=>e.pan&&e.pan(...l),["prevent"]))},M(e.messageCenterHere),1)]),e.currentMap&&e.mapCount>1?(u(),T(s,{key:0,world:e.currentMap.appendedWorld||e.currentMap.world,name:"context"},null,8,["world"])):I("",!0)])],36)}const mn=R(on,[["render",cn],["__scopeId","data-v-2e9b61c9"]]);let pn=document.getElementById("icon--login"),We=document.getElementById("svg-sprite-component-wrap");We||(We=document.createElementNS("http://www.w3.org/2000/svg","svg"),We.id="svg-sprite-component-wrap",We.style.setProperty("display","none"),document.body.appendChild(We));if(!pn){let e=document.createElementNS("http://www.w3.org/2000/svg","symbol");We.appendChild(e),e.setAttribute("viewBox","0 0 281.34 277.13"),e.setAttribute("id","icon--login"),e.innerHTML='<g stroke-linecap="round"><path d="M117.345 0c-15.437 0-28.178 12.74-28.178 28.176v87.008h20V28.176c0-4.702 3.476-8.175 8.178-8.175h135.817c4.703 0 8.177 3.473 8.177 8.175v220.778c0 4.702-3.474 8.176-8.176 8.176H117.344c-4.702 0-8.178-3.474-8.178-8.176V167.24h-20v81.712c0 15.437 12.742 28.178 28.178 28.178h135.817c15.437 0 28.176-12.741 28.176-28.178V28.176C281.339 12.74 268.6 0 253.163 0H117.345z"></path><path d="M148.458 77.933a12.5 12.5 0 0 0-8.848 3.643 12.5 12.5 0 0 0-.04 17.678l29.329 29.457H12.508a12.5 12.5 0 0 0-12.5 12.501 12.5 12.5 0 0 0 12.5 12.5h156.39l-29.328 29.457a12.5 12.5 0 0 0 .04 17.678 12.5 12.5 0 0 0 17.677-.038l50.552-50.777a12.501 12.501 0 0 0 0-17.64l-50.551-50.774a12.5 12.5 0 0 0-8.83-3.683z"></path></g>'}let un=document.getElementById("icon--logout"),Ze=document.getElementById("svg-sprite-component-wrap");Ze||(Ze=document.createElementNS("http://www.w3.org/2000/svg","svg"),Ze.id="svg-sprite-component-wrap",Ze.style.setProperty("display","none"),document.body.appendChild(Ze));if(!un){let e=document.createElementNS("http://www.w3.org/2000/svg","symbol");Ze.appendChild(e),e.setAttribute("viewBox","0 0 281.34 277.13"),e.setAttribute("id","icon--logout"),e.innerHTML='<g stroke-linecap="round"><path d="M117.345 0c-15.437 0-28.178 12.74-28.178 28.176v87.008h20V28.176c0-4.702 3.476-8.175 8.178-8.175h135.817c4.703 0 8.177 3.473 8.177 8.175v220.778c0 4.702-3.474 8.176-8.176 8.176H117.344c-4.702 0-8.178-3.474-8.178-8.176V167.24h-20v81.712c0 15.437 12.742 28.178 28.178 28.178h135.817c15.437 0 28.176-12.741 28.176-28.178V28.176C281.339 12.74 268.6 0 253.163 0z"></path><path d="M63.024 77.933a12.5 12.5 0 0 1 8.848 3.643 12.5 12.5 0 0 1 .04 17.678l-29.329 29.457h156.39a12.5 12.5 0 0 1 12.5 12.501 12.5 12.5 0 0 1-12.5 12.5H42.583l29.328 29.457a12.5 12.5 0 0 1-.04 17.678 12.5 12.5 0 0 1-17.677-.038L3.642 150.032a12.501 12.501 0 0 1 0-17.64l50.552-50.774a12.5 12.5 0 0 1 8.83-3.683z"></path></g>'}class hn extends f.Control{constructor(o){super(o);c(this,"store",E());c(this,"loggedIn",d(()=>this.store.state.loggedIn));c(this,"_button");this._button=f.DomUtil.create("button","leaflet-control-bottom leaflet-control-button leaflet-control-login"),this._button.type="button",this._button.addEventListener("click",async r=>{r.stopPropagation(),r.preventDefault(),await this.handleClick()}),f.DomEvent.on(this._button,"keydown",async r=>{r.key==="ArrowRight"&&(r.stopPropagation(),r.preventDefault(),await this.handleClick())}),A(this.loggedIn,()=>{this.update()});const a=d(()=>this.store.state.ui.visibleModal);A(a,(r,n)=>{this._button.setAttribute("aria-expanded",(r==="login").toString()),this._map&&!r&&n==="login"&&this._button.focus()}),this.update()}onAdd(){return this._button}update(){this._button.title=this.loggedIn.value?this.store.state.messages.logoutTitle:this.store.state.messages.loginTitle,this._button.innerHTML=`
			<svg class="svg-icon">
			  <use xlink:href="#icon--${this.loggedIn.value?"logout":"login"}" />
			</svg>`}async handleClick(){const o=d(()=>this.store.state.messages.logoutSuccess),a=d(()=>this.store.state.messages.logoutErrorUnknown);if(this.loggedIn.value)try{await this.store.dispatch(D.LOGOUT,void 0),nt(o.value)}catch{nt(a.value)}else await this.store.dispatch(D.LOGIN,null)}}const gn=$({props:{leaflet:{type:Object,required:!0}},setup(e){const t=new hn({position:"topleft"});V(()=>e.leaflet.addControl(t)),G(()=>e.leaflet.removeControl(t))},render(){return null}}),fn=$({props:{options:{type:Object,required:!0},leaflet:{type:Object,required:!0}},setup(e){let o=E().state.currentMapProvider.createTileLayer(Object.freeze(JSON.parse(JSON.stringify(e.options.tileLayerOptions))));e.leaflet.getLayerManager().addHiddenLayer(o,e.options.label,e.options.priority),G(()=>{e.leaflet.getLayerManager().removeLayer(o),o.remove()})},render(){return null}});let yn=document.getElementById("icon--marker_point"),Ve=document.getElementById("svg-sprite-component-wrap");Ve||(Ve=document.createElementNS("http://www.w3.org/2000/svg","svg"),Ve.id="svg-sprite-component-wrap",Ve.style.setProperty("display","none"),document.body.appendChild(Ve));if(!yn){let e=document.createElementNS("http://www.w3.org/2000/svg","symbol");Ve.appendChild(e),e.setAttribute("viewBox","0 0 286.89162 286.89163"),e.setAttribute("id","icon--marker_point"),e.innerHTML=`
   <path transform="translate(-59.399373,-0.17905527)" d="m 202.21483,0.17905527 c -49.2926,0 -89.25212,39.95956873 -89.25212,89.25210973 0,49.292555 82.37686,197.611115 89.25212,197.611115 7.99783,0 89.25211,-148.31856 89.25211,-197.611115 0,-49.292541 -39.95957,-89.25210973 -89.25211,-89.25210973 z m 0,51.39320173 c 20.91016,-0.0011 37.86223,16.948751 37.86389,37.858908 0.001,20.912125 -16.95177,37.865025 -37.86389,37.863935 -20.91214,0.001 -37.86506,-16.9518 -37.86394,-37.863935 0.002,-20.910176 16.95376,-37.86003 37.86394,-37.858908 z"></path>
`}const wn=$({components:{TileLayerOverlay:fn,MapContextMenu:mn,TileLayer:Ya,PlayersLayer:or,MarkerSetLayer:sr,CoordinatesControl:ir,ClockControl:hr,LinkControl:yr,ChatControl:_r,LogoControl:Sr,LoginControl:gn},setup(){const e=E(),t=void 0,o=L(0),a=L(64),r=L(0),n=L(""),s=L([]),i=L(!1),l=d(()=>e.state.maps),p=d(()=>{var oe;return(oe=e.state.currentMap)==null?void 0:oe.overlays}),g=d(()=>e.state.markerSets),y=d(()=>e.state.configuration),_=d(()=>e.getters.playerMarkersEnabled),C=d(()=>e.getters.coordinatesControlEnabled),z=d(()=>e.getters.clockControlEnabled),O=d(()=>e.state.components.linkControl),U=d(()=>e.state.components.chatBox),w=d(()=>e.state.components.login),P=d(()=>!e.state.ui.disableContextMenu),k=d(()=>e.state.components.logoControls),N=d(()=>e.state.currentWorld),b=d(()=>e.state.currentMap),j=d(()=>e.getters.mapBackground),ne=d(()=>e.state.followTarget),fe=d(()=>e.state.viewTarget),ye=d(()=>e.state.parsedUrl),we=L(null),lt=d(()=>e.state.messages.mapTitle);return{leaflet:t,maps:l,overlays:p,markerSets:g,configuration:y,playerMarkersEnabled:_,coordinatesControlEnabled:C,clockControlEnabled:z,linkControlEnabled:O,chatBoxEnabled:U,loginEnabled:w,contextMenuEnabled:P,logoControls:k,followTarget:ne,viewTarget:fe,parsedUrl:ye,mapBackground:j,currentWorld:N,currentMap:b,scheduledView:we,mapTitle:lt,inputX:o,inputY:a,inputZ:r,newWaypointName:n,waypoints:s,coordinatePanelCollapsed:i}},watch:{followTarget:{handler(e,t){e&&this.updateFollow(e,!t||e.name!==t.name)},deep:!0},viewTarget:{handler(e){e&&(this.currentWorld&&e.location.world===this.currentWorld.name&&E().commit(m.CLEAR_VIEW_TARGET,void 0),this.setView(e))},deep:!0},currentMap(e,t){const o=E();if(e&&(o.state.currentMapProvider.populateMap(e),this.leaflet)){let a=this.scheduledView;!a&&t?a={location:t.latLngToLocation(this.leaflet.getCenter(),64)}:a||(a={location:{x:0,y:0,z:0}}),a.options={animate:!1,noMoveStart:!1},this.setView(a),this.scheduledView=null}},currentWorld(e,t){var a,r,n,s,i,l,p,g;const o=E();if(e){o.state.currentMapProvider.populateWorld(e);let y=this.scheduledView||{};if(o.state.followTarget&&o.state.followTarget.location.world===e.name)return;if(o.state.viewTarget&&o.state.viewTarget.location.world===e.name){o.commit(m.CLEAR_VIEW_TARGET,void 0);return}else(a=o.state.parsedUrl)!=null&&a.location?(y.location=o.state.parsedUrl.location,t||(typeof((r=o.state.parsedUrl)==null?void 0:r.zoom)<"u"?y.zoom=(n=o.state.parsedUrl)==null?void 0:n.zoom:typeof((s=o.state.currentMap)==null?void 0:s.defaultZoom)<"u"?y.zoom=(i=o.state.currentMap)==null?void 0:i.defaultZoom:y.zoom=o.state.configuration.defaultZoom),o.commit(m.CLEAR_PARSED_URL,void 0)):y.location=((l=o.state.currentMap)==null?void 0:l.center)||e.center;y.zoom==null&&(typeof((p=o.state.currentMap)==null?void 0:p.defaultZoom)<"u"?y.zoom=(g=o.state.currentMap)==null?void 0:g.defaultZoom:y.zoom=o.state.configuration.defaultZoom),this.scheduledView=y}},parsedUrl:{handler(e){!e||!this.currentMap||!this.leaflet||this.setView({location:{...e.location,world:e.world},map:e.map,zoom:e.zoom,options:{animate:!1,noMoveStart:!0}})},deep:!0}},mounted(){this.loadWaypoints(),this.leaflet=new Tr(this.$el.nextElementSibling,Object.freeze({zoom:this.configuration.defaultZoom,center:new f.LatLng(0,0),fadeAnimation:!1,zoomAnimation:!0,zoomControl:!0,preferCanvas:!0,attributionControl:!1,crs:f.CRS.Simple,worldCopyJump:!1})),window.addEventListener("keydown",this.handleKeydown),this.leaflet.createPane("vectors"),this.leaflet.addControl(new $r({position:"topleft",delayIndicator:500})),this.leaflet.on("moveend",()=>{this.currentMap&&E().commit(m.SET_CURRENT_LOCATION,this.currentMap.latLngToLocation(this.leaflet.getCenter(),64))}),this.leaflet.on("zoomend",()=>{E().commit(m.SET_CURRENT_ZOOM,this.leaflet.getZoom())})},unmounted(){window.removeEventListener("keydown",this.handleKeydown),this.leaflet.remove()},methods:{handleKeydown(e){e.key==="Escape"&&(e.preventDefault(),this.leaflet.getContainer().focus())},setView(e){var n,s,i,l;const t=E(),o=t.state.currentWorld,a=(n=t.state.currentMap)==null?void 0:n.name,r=e.location.world?t.state.worlds.get(e.location.world):o;if(!this.leaflet){console.warn("Ignoring setView as leaflet not initialised");return}if(!r){console.warn(`Ignoring setView with unknown world ${e.location.world}`);return}if(r&&r!==o||e.map&&a!==e.map){const p=t.state.maps.get(`${r.name}_${e.map}`),g=p?p.name:r.maps.values().next().value.name;this.scheduledView=e;try{t.commit(m.SET_CURRENT_MAP,{worldName:r.name,mapName:g})}catch(y){console.warn("Failed to handle map setView",y),this.scheduledView=null}}else if(console.debug("Moving to",JSON.stringify(e)),typeof e.zoom<"u"&&this.leaflet.setZoom(e.zoom,e.options),"min"in e.location)this.leaflet.fitBounds(new f.LatLngBounds((s=t.state.currentMap)==null?void 0:s.locationToLatLng(e.location.min),(i=t.state.currentMap)==null?void 0:i.locationToLatLng(e.location.max)),e.options);else{const p=(l=t.state.currentMap)==null?void 0:l.locationToLatLng(e.location);this.leaflet.panTo(p,e.options)}},updateFollow(e,t){const o=E(),a=o.state.currentWorld;let r;if(e.hidden){console.warn(`Cannot follow ${e.name}. Player is hidden from the map.`);return}(!a||a.name!==e.location.world||t)&&(r=o.state.configuration.followMap),this.setView({location:e.location,map:r,zoom:t?o.state.configuration.followZoom:void 0})},goToCoordinates(){!this.currentMap||!this.leaflet||this.setView({location:{x:this.inputX,y:this.inputY,z:this.inputZ}})},loadWaypoints(){const e=localStorage.getItem("liveatlas-waypoints");if(e)try{this.waypoints=JSON.parse(e)}catch(t){console.warn("Failed to load waypoints:",t)}},saveWaypoints(){localStorage.setItem("liveatlas-waypoints",JSON.stringify(this.waypoints))},addWaypoint(){if(!this.newWaypointName.trim()||!this.currentMap||!this.leaflet)return;if(this.waypoints.some(o=>o.name.toLowerCase()===this.newWaypointName.toLowerCase())){alert("A waypoint with this name already exists");return}const t=this.currentMap.latLngToLocation(this.leaflet.getCenter(),64);this.waypoints.push({name:this.newWaypointName.trim(),location:t}),this.newWaypointName="",this.saveWaypoints()},goToWaypoint(e){!this.currentMap||!this.leaflet||this.setView({location:e.location})},removeWaypoint(e){this.waypoints.splice(e,1),this.saveWaypoints()}}});const vn=e=>(Wo("data-v-6498566c"),e=e(),Zo(),e),_n=["aria-label"],bn={key:1,class:"leaflet-control-container coordinate-control-wrapper"},Sn={class:"leaflet-top leaflet-right coordinate-control-position"},kn={class:"leaflet-control leaflet-bar coordinate-control"},En=["title","aria-expanded"],Ln=vn(()=>h("svg",{class:"svg-icon","aria-hidden":"true"},[h("use",{"xlink:href":"#icon--marker_point"})],-1)),Cn=[Ln],Mn={class:"leaflet-control coordinate-panel"},Tn={class:"coordinate-input"},In=te("X: "),$n=te("Y: "),An=te("Z: "),zn={class:"waypoint-input"},Pn={key:0,class:"waypoints-list"},Un={class:"waypoint-name"},Nn={class:"waypoint-coords"},On=["onClick"],Rn=["onClick"];function Dn(e,t,o,a,r,n){const s=S("TileLayer"),i=S("TileLayerOverlay"),l=S("PlayersLayer"),p=S("MarkerSetLayer"),g=S("LogoControl"),y=S("CoordinatesControl"),_=S("LinkControl"),C=S("ClockControl"),z=S("LoginControl"),O=S("ChatControl"),U=S("MapContextMenu");return u(),v(x,null,[h("div",wt({class:"map",style:{backgroundColor:e.mapBackground}},e.$attrs,{"aria-label":e.mapTitle}),[e.leaflet?(u(),v(x,{key:0},[(u(!0),v(x,null,Y(e.maps,([w,P])=>(u(),T(s,{key:w,options:P,leaflet:e.leaflet},null,8,["options","leaflet"]))),128)),(u(!0),v(x,null,Y(e.overlays,([w,P])=>(u(),T(i,{key:w,options:P,leaflet:e.leaflet},null,8,["options","leaflet"]))),128)),e.playerMarkersEnabled?(u(),T(l,{key:0,leaflet:e.leaflet},null,8,["leaflet"])):I("",!0),(u(!0),v(x,null,Y(e.markerSets,([w,P])=>(u(),T(p,{key:w,markerSet:P,leaflet:e.leaflet},null,8,["markerSet","leaflet"]))),128)),(u(!0),v(x,null,Y(e.logoControls,w=>(u(),T(g,{key:JSON.stringify(w),options:w,leaflet:e.leaflet},null,8,["options","leaflet"]))),128)),e.coordinatesControlEnabled?(u(),T(y,{key:1,leaflet:e.leaflet},null,8,["leaflet"])):I("",!0),e.linkControlEnabled?(u(),T(_,{key:2,leaflet:e.leaflet},null,8,["leaflet"])):I("",!0),e.clockControlEnabled?(u(),T(C,{key:3,leaflet:e.leaflet},null,8,["leaflet"])):I("",!0),e.loginEnabled?(u(),T(z,{key:4,leaflet:e.leaflet},null,8,["leaflet"])):I("",!0),e.chatBoxEnabled?(u(),T(O,{key:5,leaflet:e.leaflet},null,8,["leaflet"])):I("",!0)],64)):I("",!0)],16,_n),e.contextMenuEnabled&&e.leaflet?(u(),T(U,{key:0,leaflet:e.leaflet},null,8,["leaflet"])):I("",!0),e.leaflet?(u(),v("div",bn,[h("div",Sn,[h("div",kn,[h("button",{class:"leaflet-control-button coordinate-toggle",onClick:t[0]||(t[0]=w=>e.coordinatePanelCollapsed=!e.coordinatePanelCollapsed),title:e.coordinatePanelCollapsed?"Go to coordinates":"Hide coordinate panel","aria-expanded":!e.coordinatePanelCollapsed},Cn,8,En)]),B(h("div",Mn,[h("div",Tn,[h("label",null,[In,B(h("input",{type:"number","onUpdate:modelValue":t[1]||(t[1]=w=>e.inputX=w)},null,512),[[Q,e.inputX,void 0,{number:!0}]])]),h("label",null,[$n,B(h("input",{type:"number","onUpdate:modelValue":t[2]||(t[2]=w=>e.inputY=w)},null,512),[[Q,e.inputY,void 0,{number:!0}]])]),h("label",null,[An,B(h("input",{type:"number","onUpdate:modelValue":t[3]||(t[3]=w=>e.inputZ=w)},null,512),[[Q,e.inputZ,void 0,{number:!0}]])]),h("button",{onClick:t[4]||(t[4]=(...w)=>e.goToCoordinates&&e.goToCoordinates(...w)),title:"Go to coordinates"},"Go")]),h("div",zn,[B(h("input",{type:"text","onUpdate:modelValue":t[5]||(t[5]=w=>e.newWaypointName=w),placeholder:"Waypoint name",onKeyup:t[6]||(t[6]=Bo((...w)=>e.addWaypoint&&e.addWaypoint(...w),["enter"]))},null,544),[[Q,e.newWaypointName]]),h("button",{onClick:t[7]||(t[7]=(...w)=>e.addWaypoint&&e.addWaypoint(...w)),title:"Save current location as waypoint"},"Save")]),e.waypoints.length>0?(u(),v("div",Pn,[(u(!0),v(x,null,Y(e.waypoints,(w,P)=>(u(),v("div",{key:w.name,class:"waypoint-item"},[h("span",Un,M(w.name),1),h("span",Nn,"("+M(Math.round(w.location.x))+", "+M(Math.round(w.location.z))+")",1),h("button",{onClick:k=>e.goToWaypoint(w),title:"Go to waypoint"},"โ",8,On),h("button",{onClick:k=>e.removeWaypoint(P),title:"Remove waypoint",class:"remove"},"ร",8,Rn)]))),128))])):I("",!0)],512),[[Rt,!e.coordinatePanelCollapsed]])])])):I("",!0)],64)}const Hn=R(wn,[["render",Dn],["__scopeId","data-v-6498566c"]]);let xn=document.getElementById("icon--cross"),je=document.getElementById("svg-sprite-component-wrap");je||(je=document.createElementNS("http://www.w3.org/2000/svg","svg"),je.id="svg-sprite-component-wrap",je.style.setProperty("display","none"),document.body.appendChild(je));if(!xn){let e=document.createElementNS("http://www.w3.org/2000/svg","symbol");je.appendChild(e),e.setAttribute("viewBox","0 0 228.57 228.45"),e.setAttribute("id","icon--cross"),e.innerHTML='<path d="M16.682 0A15.46 15.46 0 0 0 5.719 4.556L4.554 5.72a15.47 15.47 0 0 0 0 21.924l86.578 86.578L4.554 200.8a15.47 15.47 0 0 0 0 21.924l1.165 1.165a15.46 15.46 0 0 0 10.963 4.556 15.45 15.45 0 0 0 10.96-4.556l86.646-86.644 86.643 86.644a15.468 15.468 0 0 0 21.923 0l1.165-1.165a15.47 15.47 0 0 0 0-21.924l-86.578-86.578 86.578-86.578a15.47 15.47 0 0 0 0-21.924l-1.165-1.164a15.468 15.468 0 0 0-21.923 0L114.288 91.2 27.642 4.556A15.45 15.45 0 0 0 16.682 0z"></path>'}const Bn=$({name:"PlayerImage",components:{},props:{player:{type:Object,required:!0}},setup(e){const t=E(),o=L(St),a=d(()=>typeof e.player=="string"?e.player:e.player.name),r=d(()=>t.state.components.players.showImages),n=d(()=>t.state.components.players.imageUrl),s=async()=>{if(o.value=St,r.value)try{const i=await ho(e.player,"small");o.value=i.src}catch{}};return A(a,()=>s()),A(n,()=>s()),V(()=>s()),{image:o}}}),Wn=["src"];function Zn(e,t,o,a,r,n){return u(),v("img",{width:"16",height:"16",src:e.image,alt:""},null,8,Wn)}const Jt=R(Bn,[["render",Zn]]),Vn=$({name:"FollowTargetSection",components:{PlayerImage:Jt,SvgIcon:ge},props:{target:{type:Object,required:!0}},setup(e){const t=E(),o=d(()=>t.state.components.players.showImages),a=d(()=>t.state.messages.followingHeading),r=d(()=>t.state.messages.followingUnfollow),n=d(()=>t.state.messages.followingTitleUnfollow),s=d(()=>t.state.messages.followingHidden),i=d(()=>{if(e.target.hidden)return s.value;const g=t.state.worlds.get(e.target.location.world||"");return g?g.displayName:s.value}),l=d(()=>e.target.hidden?"":`${Math.floor(e.target.location.x)}, ${e.target.location.y}, ${Math.floor(e.target.location.z)}`);return{imagesEnabled:o,unfollow:()=>{t.commit(m.CLEAR_FOLLOW_TARGET,void 0)},heading:a,messageUnfollow:r,messageUnfollowTitle:n,messageHidden:s,status:i,location:l,copySuccess:Vt(t),copyError:jt(t)}}});const jn={class:"sidebar__section following"},Fn=["innerHTML"],Gn={class:"target__status"},qn={class:"target__location"},Kn=["title","aria-label"];function Yn(e,t,o,a,r,n){const s=S("PlayerImage"),i=S("SvgIcon"),l=no("clipboard");return u(),v("section",jn,[h("h2",null,M(e.heading),1),h("div",{class:le({following__target:!0,"following__target--hidden":e.target.hidden})},[e.imagesEnabled?(u(),T(s,{key:0,player:e.target,class:"target__icon",width:"48",height:"48"},null,8,["player"])):I("",!0),h("span",{class:"target__name",innerHTML:e.target.displayName},null,8,Fn),h("span",Gn,M(e.status),1),B((u(),v("span",qn,[te(M(e.location)+"โ",1)])),[[l,e.location,"copy"],[l,e.copySuccess,"success"],[l,e.copyError,"error"]]),h("button",{class:"target__unfollow",type:"button",title:e.messageUnfollowTitle,onClick:t[0]||(t[0]=J((...p)=>e.unfollow&&e.unfollow(...p),["prevent"])),"aria-label":e.messageUnfollow},[Z(i,{name:"cross"})],8,Kn)],2)])}const Qn=R(Vn,[["render",Yn],["__scopeId","data-v-8139d0bb"]]);let Jn=document.getElementById("icon--arrow"),Fe=document.getElementById("svg-sprite-component-wrap");Fe||(Fe=document.createElementNS("http://www.w3.org/2000/svg","svg"),Fe.id="svg-sprite-component-wrap",Fe.style.setProperty("display","none"),document.body.appendChild(Fe));if(!Jn){let e=document.createElementNS("http://www.w3.org/2000/svg","symbol");Fe.appendChild(e),e.setAttribute("viewBox","0 0 234.46 247.78"),e.setAttribute("id","icon--arrow"),e.innerHTML='<path d="M19.626 58.589a15.46 15.46 0 0 0-10.963 4.556l-1.165 1.164a15.47 15.47 0 0 0 0 21.925l98.421 98.421a15.436 15.436 0 0 0 11.312 4.537 15.435 15.435 0 0 0 11.31-4.537l98.42-98.42a15.47 15.47 0 0 0 0-21.926l-1.164-1.164a15.468 15.468 0 0 0-21.923 0L117.23 149.79 30.586 63.145a15.45 15.45 0 0 0-10.96-4.556z"></path>'}const Xn=$({name:"SidebarSection",components:{SvgIcon:ge},props:{name:{type:String,required:!0},collapsible:{type:Boolean,required:!1,default:!0}},setup(e){const t=E(),o=d(()=>t.state.messages.toggleTitle),a=d(()=>t.state.ui.sidebar[e.name].collapsed),r=d(()=>t.state.ui.smallScreen);return{title:o,collapsed:a,smallScreen:r,toggle:()=>{e.collapsible&&t.commit(m.TOGGLE_SIDEBAR_SECTION_COLLAPSED_STATE,e.name)}}}});const es=["data-section"],ts={class:"section__heading"},os=["id","title","aria-expanded","aria-controls"],as=["id","aria-hidden"];function rs(e,t,o,a,r,n){const s=S("SvgIcon");return u(),v("section",{class:le({sidebar__section:!0,"section--collapsible":e.collapsible,"section--collapsed":e.collapsed}),"data-section":e.name},[h("h2",ts,[h("button",{id:`${e.name}-heading`,type:"button",onClick:t[0]||(t[0]=J((...i)=>e.toggle&&e.toggle(...i),["prevent"])),title:e.title,"aria-expanded":!e.collapsed,"aria-controls":`${e.name}-content`},[h("span",null,[mt(e.$slots,"heading")]),e.collapsible?(u(),T(s,{key:0,name:"arrow"})):I("",!0)],8,os)]),h("div",{id:`${e.name}-content`,class:"section__content","aria-hidden":e.collapsed},[mt(e.$slots,"default")],8,as)],10,es)}const Pt=R(Xn,[["render",rs]]),ns=$({name:"PlayerListItem",components:{PlayerImage:Jt},props:{player:{type:Object,required:!0}},setup(e){const t=E(),o=d(()=>t.state.components.players.showImages),a=d(()=>t.state.components.players.grayHiddenPlayers&&!e.player.hidden&&(!t.state.currentWorld||t.state.currentWorld.name!==e.player.location.world)),r=d(()=>e.player.hidden?t.state.messages.playersTitleHidden:a.value?t.state.messages.playersTitleOtherWorld:t.state.messages.playersTitle),n=d(()=>{var g;return(g=t.state.followTarget)==null?void 0:g.name}),s=()=>{e.player.hidden||t.commit(m.SET_VIEW_TARGET,{location:e.player.location})},i=()=>t.commit(m.SET_FOLLOW_TARGET,e.player);return{imagesEnabled:o,title:r,otherWorld:a,followTarget:n,onInputClick:g=>{g.preventDefault(),g.shiftKey?i():s()},onLabelClick:g=>{g.shiftKey||g.detail===2?i():s()}}}});const ss=["id","value"],is=["for","title"],ls=["innerHTML"];function ds(e,t,o,a,r,n){const s=S("PlayerImage");return u(),v(x,null,[B(h("input",{id:`player-${e.player.name}`,type:"radio",name:"player",value:e.player.name,"onUpdate:modelValue":t[0]||(t[0]=i=>e.followTarget=i),onClick:t[1]||(t[1]=J((...i)=>e.onInputClick&&e.onInputClick(...i),["prevent"]))},null,8,ss),[[ct,e.followTarget]]),h("label",{for:`player-${e.player.name}`,class:le({player:!0,"player--hidden":!!e.player.hidden,"player--other-world":e.otherWorld}),title:e.title,onClick:t[2]||(t[2]=J((...i)=>e.onLabelClick&&e.onLabelClick(...i),["prevent"]))},[e.imagesEnabled?(u(),T(s,{key:0,player:e.player,width:"16",height:"16",class:"player__icon","aria-hidden":"true"},null,8,["player"])):I("",!0),h("span",{class:"player__name",innerHTML:e.player.displayName},null,8,ls)],10,is)],64)}const cs=R(ns,[["render",ds],["__scopeId","data-v-d69ed699"]]),ms=$({name:"RadioList",props:{name:{type:String,required:!0}},setup(){return{onKeydown:o=>{zt(o,Array.from(o.currentTarget.elements))},moveFocus:o=>{o.target.nextElementSibling.focus()}}}});const ps=["name"];function us(e,t,o,a,r,n){return u(),v("fieldset",{class:"menu",role:"radiogroup",onKeydown:t[1]||(t[1]=(...s)=>e.onKeydown&&e.onKeydown(...s))},[h("input",{type:"radio",name:e.name,checked:"","data-ignore":"",onFocus:t[0]||(t[0]=(...s)=>e.moveFocus&&e.moveFocus(...s))},null,40,ps),mt(e.$slots,"default")],32)}const gt=R(ms,[["render",us]]),hs=$({components:{RadioList:gt,PlayerListItem:cs},props:{search:{type:Boolean,default:!0},players:{type:Object,required:!0},ariaLabelledby:{type:String,default:""}},setup(e){const t=E(),o=d(()=>t.state.messages.playersSkeleton),a=d(()=>t.state.messages.playersSearchSkeleton),r=d(()=>t.state.messages.playersSearchPlaceholder),n=L(""),s=L(null),i=d(()=>{const p=n.value.toLowerCase();return p?e.players.filter(g=>g.name.toLowerCase().indexOf(p)>-1):e.players}),l=p=>{p.stopImmediatePropagation()};return A(n,()=>s.value.nextElementSibling.scrollIntoView()),{messageSkeletonPlayers:o,messageSkeletonPlayersSearch:a,messagePlayersSearchPlaceholder:r,searchQuery:n,searchInput:s,filteredPlayers:i,onKeydown:l}}}),gs=["placeholder"],fs={key:2,class:"section__skeleton"},ys={key:3,class:"section__skeleton"};function ws(e,t,o,a,r,n){const s=S("PlayerListItem"),i=S("RadioList");return u(),v(x,null,[e.filteredPlayers&&e.search?B((u(),v("input",{key:0,ref:"searchInput",class:"section__search",type:"text",name:"search","onUpdate:modelValue":t[0]||(t[0]=l=>e.searchQuery=l),placeholder:e.messagePlayersSearchPlaceholder,onKeydown:t[1]||(t[1]=(...l)=>e.onKeydown&&e.onKeydown(...l))},null,40,gs)),[[Q,e.searchQuery]]):I("",!0),e.filteredPlayers.length?(u(),T(i,{key:1,name:"player","aria-labelledby":e.ariaLabelledby},{default:F(()=>[(u(!0),v(x,null,Y(e.filteredPlayers,l=>(u(),T(s,{key:l.name,player:l},null,8,["player"]))),128))]),_:1},8,["aria-labelledby"])):e.searchQuery?(u(),v("div",fs,M(e.messageSkeletonPlayersSearch),1)):(u(),v("div",ys,M(e.messageSkeletonPlayers),1))],64)}const vs=R(hs,[["render",ws]]),_s=$({components:{PlayerList:vs,SidebarSection:Pt},setup(){const e=E(),t=d(()=>e.getters.playersHeading),o=d(()=>e.state.ui.playersSearch),a=d(()=>e.state.sortedPlayers),r=d(()=>e.state.maxPlayers||0);return{messageHeading:t,searchEnabled:o,players:a,maxPlayers:r}}});function bs(e,t,o,a,r,n){const s=S("PlayerList"),i=S("SidebarSection");return u(),T(i,{name:"players",class:"players"},{heading:F(()=>[te(M(e.messageHeading),1)]),default:F(()=>[Z(s,{players:e.players,search:e.searchEnabled,"aria-labelledby":"players-heading"},null,8,["players","search"])]),_:1})}const Ss=R(_s,[["render",bs],["__scopeId","data-v-3d9c6b98"]]),ks=$({name:"ServerListItem",props:{server:{type:Object,required:!0}},setup(){const e=E();return{currentServer:d({get:()=>e.state.currentServer?e.state.currentServer.id:void 0,set:o=>o&&e.commit(m.SET_CURRENT_SERVER,o)})}}}),Es=["id","value"],Ls=["for"];function Cs(e,t,o,a,r,n){return u(),v(x,null,[B(h("input",{id:`server-${e.server.id}`,type:"radio",name:"server",value:e.server.id,"onUpdate:modelValue":t[0]||(t[0]=s=>e.currentServer=s)},null,8,Es),[[ct,e.currentServer]]),h("label",{for:`server-${e.server.id}`},M(e.server.label||e.server.id),9,Ls)],64)}const Ms=R(ks,[["render",Cs]]),Ts=$({name:"ServerList",components:{RadioList:gt,ServerListItem:Ms},props:{servers:{type:Object,required:!0}}});function Is(e,t,o,a,r,n){const s=S("ServerListItem"),i=S("RadioList");return u(),T(i,{name:"server","aria-labelledby":"servers-heading"},{default:F(()=>[(u(!0),v(x,null,Y(e.servers,([l,p])=>(u(),T(s,{server:p,key:l},null,8,["server"]))),128))]),_:1})}const $s=R(Ts,[["render",Is]]),As=$({name:"ServersSection",components:{ServerList:$s,SidebarSection:Pt},setup(){const e=E(),t=d(()=>e.state.messages.serversHeading),o=d(()=>e.state.servers);return{heading:t,servers:o}}});function zs(e,t,o,a,r,n){const s=S("ServerList"),i=S("SidebarSection");return e.servers.size>1?(u(),T(i,{key:0,name:"servers"},{heading:F(()=>[te(M(e.heading),1)]),default:F(()=>[Z(s,{servers:e.servers,"aria-labelledby":"servers-heading"},null,8,["servers"])]),_:1})):I("",!0)}const Ps=R(As,[["render",zs]]),Us=$({name:"WorldList",components:{RadioList:gt,WorldListItem:Uo},props:{prefix:{type:String,default:"map"},worlds:{type:Object,required:!0}},setup(){const e=E();return{currentServer:d(()=>e.state.currentServer?e.state.currentServer.id:void 0)}}});function Ns(e,t,o,a,r,n){const s=S("WorldListItem"),i=S("RadioList");return e.worlds.size?(u(),T(i,{key:0,name:"map","aria-labelledby":"maps-heading"},{default:F(()=>[(u(!0),v(x,null,Y(e.worlds,([l,p])=>(u(),T(s,{world:p,key:`${e.prefix}_${e.currentServer}_${l}`},null,8,["world"]))),128))]),_:1})):I("",!0)}const Os=R(Us,[["render",Ns]]),Rs=$({name:"WorldsSection",components:{WorldList:Os,SidebarSection:Pt},props:{prefix:{type:String,default:"map"}},setup(){const e=E(),t=d(()=>e.state.messages.worldsHeading),o=d(()=>e.state.messages.worldsSkeleton),a=d(()=>e.state.worlds),r=d(()=>e.state.currentServer?e.state.currentServer.id:void 0);return{heading:t,skeleton:o,worlds:a,currentServer:r}}}),Ds={key:1,class:"section__skeleton"};function Hs(e,t,o,a,r,n){const s=S("WorldList"),i=S("SidebarSection");return u(),T(i,{name:"maps"},{heading:F(()=>[te(M(e.heading),1)]),default:F(()=>[e.worlds.size?(u(),T(s,{key:0,worlds:e.worlds,prefix:e.prefix,"aria-labelledby":"maps-heading"},null,8,["worlds","prefix"])):(u(),v("div",Ds,M(e.skeleton),1))]),_:1})}const xs=R(Rs,[["render",Hs]]);let Bs=document.getElementById("icon--marker_line"),Ge=document.getElementById("svg-sprite-component-wrap");Ge||(Ge=document.createElementNS("http://www.w3.org/2000/svg","svg"),Ge.id="svg-sprite-component-wrap",Ge.style.setProperty("display","none"),document.body.appendChild(Ge));if(!Bs){let e=document.createElementNS("http://www.w3.org/2000/svg","symbol");Ge.appendChild(e),e.setAttribute("viewBox","0 0 286.89 286.89"),e.setAttribute("id","icon--marker_line"),e.innerHTML='<path d="m138.25 1.7383a8.5 8.5 0 0 0-6.125 2.1953l-115.74 105.05a8.5008 8.5008 0 0 0 2.084 13.98l222.54 105.04-84.184 41.338a8.5 8.5 0 0 0-3.8848 11.377 8.5 8.5 0 0 0 11.377 3.8828l100.03-49.119a8.5008 8.5008 0 0 0-0.11718-15.316l-227-107.15 106.32-96.5a8.5 8.5 0 0 0 0.58204-12.006 8.5 8.5 0 0 0-5.8828-2.7773z"></path>'}let Ws=document.getElementById("icon--marker_area"),qe=document.getElementById("svg-sprite-component-wrap");qe||(qe=document.createElementNS("http://www.w3.org/2000/svg","svg"),qe.id="svg-sprite-component-wrap",qe.style.setProperty("display","none"),document.body.appendChild(qe));if(!Ws){let e=document.createElementNS("http://www.w3.org/2000/svg","symbol");qe.appendChild(e),e.setAttribute("viewBox","0 0 286.89 286.89"),e.setAttribute("id","icon--marker_area"),e.innerHTML='<path d="m80.789 0.381-78.122 110.68s84.697 175.47 87.791 173.92c3.094-1.5426 194.15-35.093 194.15-35.093l-23.978-169.3z"></path>'}let Zs=document.getElementById("icon--marker_circle"),Ke=document.getElementById("svg-sprite-component-wrap");Ke||(Ke=document.createElementNS("http://www.w3.org/2000/svg","svg"),Ke.id="svg-sprite-component-wrap",Ke.style.setProperty("display","none"),document.body.appendChild(Ke));if(!Zs){let e=document.createElementNS("http://www.w3.org/2000/svg","symbol");Ke.appendChild(e),e.setAttribute("viewBox","0 0 286.89 286.89"),e.setAttribute("id","icon--marker_circle"),e.innerHTML='<circle cx="142.68" cy="143.06" r="137.35"></circle>'}const Vs=$({name:"MarkerListItem",components:{SvgIcon:ge},props:{id:{type:String,required:!0},marker:{type:Object,required:!0}},setup(e){const t=Vo(),o=d(()=>t.state.messages.markersUnnamed),a=d(()=>({x:Math.round(e.marker.location.x),z:Math.round(e.marker.location.z)})),r=d(()=>{if("iconUrl"in e.marker)return e.marker.iconUrl}),n=d(()=>{switch(e.marker.type){case W.POINT:default:return"marker_point";case W.AREA:return"marker_area";case W.LINE:return"marker_line";case W.CIRCLE:return"marker_circle"}});return{icon:r,defaultIcon:n,messageUnnamed:o,pan:()=>{e.marker.type===W.POINT?t.commit(m.SET_VIEW_TARGET,{location:e.marker.location}):t.commit(m.SET_VIEW_TARGET,{location:e.marker.bounds,options:{padding:[10,10]}})},location:a}}});const js=["id","value"],Fs=["for","title"],Gs=["src"],qs={class:"marker__label"},Ks={class:"marker__location"};function Ys(e,t,o,a,r,n){const s=S("SvgIcon");return u(),v(x,null,[h("input",{id:`marker-${e.id}`,type:"radio",name:"marker",value:e.id,onClick:t[0]||(t[0]=J((...i)=>e.pan&&e.pan(...i),["prevent"]))},null,8,js),h("label",{for:`marker-${e.id}`,class:"marker",title:e.marker.tooltip,onClick:t[1]||(t[1]=J((...i)=>e.pan&&e.pan(...i),["prevent"]))},[e.icon?(u(),v("img",{key:0,width:"16",height:"16",class:"marker__icon",src:e.icon,alt:""},null,8,Gs)):(u(),T(s,{key:1,name:e.defaultIcon,class:"marker__icon"},null,8,["name"])),h("span",qs,M(e.marker.tooltip||e.messageUnnamed),1),h("span",Ks,"X: "+M(e.location.x)+", Z: "+M(e.location.z),1)],8,Fs)],64)}const Qs=R(Vs,[["render",Ys],["__scopeId","data-v-fe50340c"]]),Js=$({name:"MarkerList",components:{MarkerListItem:Qs,RadioList:gt},props:{markerSet:{type:Object,required:!0},search:{type:Boolean,default:!0}},setup(e){let t=0;const o=E(),a=d(()=>o.state.messages.showMore),r=d(()=>o.state.messages.markersSearchPlaceholder),n=d(()=>o.state.messages.markersSearchSkeleton),s=d(()=>o.state.messages.markersSetSkeleton),i=K.markers.get(e.markerSet.id),l=L(""),p=L(new Map),g=L(null),y=L(0),_=L(0),C=L(50),z=L(null),O=b=>{b.key==="f"&&b.ctrlKey&&(b.preventDefault(),z.value.focus())},U=()=>{if(p.value.clear(),!i)return;_.value=i.size;let b=0;i.forEach((j,ne)=>{l.value&&!j.tooltip.toLowerCase().includes(l.value)||(b++,b<C.value&&p.value.set(ne,Fo(j)))}),y.value=b},w=()=>{const b=g.value.previousElementSibling;C.value+=50,t=requestAnimationFrame(()=>b.nextElementSibling.focus())},P=b=>{_.value=i.size,b.removed||l.value&&!b.payload.tooltip.toLowerCase().includes(l.value)?p.value.delete(b.id):(p.value.has(b.id)||p.value.size<C.value)&&p.value.set(b.id,b.payload)},k=b=>{l.value=b.target.value.toLowerCase()},N=jo(()=>{C.value=50,U(),z.value.nextElementSibling.scrollIntoView()},100);return U(),A(C,()=>U()),A(l,()=>N()),V(()=>Co(P,e.markerSet.id)),G(()=>{t&&cancelAnimationFrame(t),N.cancel(),Mo(P,e.markerSet.id)}),{messageShowMore:a,messageMarkersSearchPlaceholder:r,messageSkeletonMarkersSearch:n,messageSkeletonMarkers:s,searchQuery:l,markers:p,showMoreButton:g,viewLimit:C,total:y,unfilteredTotal:_,searchInput:z,showMore:w,onListKeydown:O,onSearchInput:k}}}),Xs=["value","placeholder"];function ei(e,t,o,a,r,n){const s=S("MarkerListItem"),i=S("RadioList");return u(),v(x,null,[e.search&&e.unfilteredTotal?(u(),v("input",{key:0,ref:"searchInput",id:"markers__search",class:"section__search",type:"text",name:"search",value:e.searchQuery,placeholder:e.messageMarkersSearchPlaceholder,onKeydown:t[0]||(t[0]=l=>l.stopImmediatePropagation()),onInput:t[1]||(t[1]=(...l)=>e.onSearchInput&&e.onSearchInput(...l))},null,40,Xs)):I("",!0),e.markers.size?(u(),T(i,wt({key:1,name:"marker"},e.$attrs,{onKeydown:e.onListKeydown}),{default:F(()=>[(u(!0),v(x,null,Y(e.markers,([l,p])=>(u(),T(s,{key:l,marker:p,id:l},null,8,["marker","id"]))),128)),e.viewLimit<e.total?(u(),v("button",{key:0,type:"button",ref:"showMoreButton",onClick:t[2]||(t[2]=J((...l)=>e.showMore&&e.showMore(...l),["prevent"]))},M(e.messageShowMore),513)):I("",!0)]),_:1},16,["onKeydown"])):e.searchQuery?(u(),v("div",wt({key:2,class:"section__skeleton"},e.$attrs),M(e.messageSkeletonMarkersSearch),17)):(u(),v("div",wt({key:3,class:"section__skeleton"},e.$attrs),M(e.messageSkeletonMarkers),17))],64)}const ti=R(Js,[["render",ei]]),oi=$({name:"MarkerSetList",components:{SvgIcon:ge,MarkerList:ti,RadioList:gt},props:{markerSets:{type:Object,required:!0},ariaLabelledby:{type:String,default:""}},setup(e){const t=L(new Map),o=L(void 0),a=L(null),r=L(null),n=L(null),s=()=>{var y;(y=e.markerSets)==null||y.forEach(_=>i(_))},i=y=>{const _=K.markers.get(y.id),C=_?_.size:0;t.value.set(y,C)},l=y=>{i(e.markerSets.get(y.set))},p=y=>{y.key==="Backspace"&&(o.value=void 0,y.preventDefault())},g=(y,_)=>{let C;y?C=r.value.parentNode.querySelector(".menu input")||n.value:_&&(C=a.value.$el.parentNode.querySelector(`[id="marker-set-${_.id}"]`)),C&&C.focus()};return A(e.markerSets,()=>s()),A(o,(y,_)=>re(()=>g(y,_))),V(()=>{s(),Ta(l)}),G(()=>{Ia(l)}),{markerCounts:t,currentSet:o,list:a,subHeader:r,backButton:n,onSubmenuKeydown:p}}});const ai=["id","value"],ri=["for"],ni={ref:"subHeader",class:"markers__header"},si={class:"markers__set"};function ii(e,t,o,a,r,n){const s=S("RadioList"),i=S("SvgIcon"),l=S("MarkerList");return e.currentSet?(u(),v(x,{key:1},[h("div",ni,[h("button",{type:"button",ref:"backButton",class:"markers__back",onClick:t[1]||(t[1]=J(p=>e.currentSet=void 0,["prevent"]))},[Z(i,{name:"arrow"})],512),h("h3",si,M(e.currentSet.label),1)],512),Z(l,{ref:"submenu","marker-set":e.currentSet,onKeydown:e.onSubmenuKeydown},null,8,["marker-set","onKeydown"])],64)):(u(),T(s,{key:0,ref:"list",name:"marker-set","aria-labelledby":e.ariaLabelledby},{default:F(()=>[(u(!0),v(x,null,Y(e.markerSets,([p,g])=>(u(),v(x,{key:p},[B(h("input",{id:`marker-set-${p}`,type:"radio",name:"marker-set","onUpdate:modelValue":t[0]||(t[0]=y=>e.currentSet=y),value:g},null,8,ai),[[ct,e.currentSet]]),h("label",{for:`marker-set-${p}`},[h("span",null,M(g.label||p),1),h("span",null,M(e.markerCounts.get(g))+" Marker(s)",1)],8,ri)],64))),128))]),_:1},8,["aria-labelledby"]))}const li=R(oi,[["render",ii],["__scopeId","data-v-adecd193"]]),di=$({name:"MarkersSection",components:{MarkerSetList:li,SidebarSection:Pt},setup(){const e=E(),t=d(()=>e.state.messages.markersHeading),o=d(()=>e.state.markerSets);return{heading:t,markerSets:o}}});function ci(e,t,o,a,r,n){const s=S("MarkerSetList"),i=S("SidebarSection");return e.markerSets.size?(u(),T(i,{key:0,name:"markers",class:"markers"},{heading:F(()=>[te(M(e.heading),1)]),default:F(()=>[Z(s,{markerSets:e.markerSets,"aria-labelledby":"markers-heading"},null,8,["markerSets"])]),_:1})):I("",!0)}const mi=R(di,[["render",ci],["__scopeId","data-v-a0069c5c"]]);let pi=document.getElementById("icon--players"),Ye=document.getElementById("svg-sprite-component-wrap");Ye||(Ye=document.createElementNS("http://www.w3.org/2000/svg","svg"),Ye.id="svg-sprite-component-wrap",Ye.style.setProperty("display","none"),document.body.appendChild(Ye));if(!pi){let e=document.createElementNS("http://www.w3.org/2000/svg","symbol");Ye.appendChild(e),e.setAttribute("viewBox","0 0 258.05 271.18"),e.setAttribute("id","icon--players"),e.innerHTML='<path transform="scale(.75)" d="M115.9.336c-38.033 0-68.865 31.036-68.865 69.32 0 33.275 23.296 61.06 54.363 67.766 5.86-43.301 38.447-78.411 80.457-87.72C173.34 21.149 147.041.337 115.9.337z"></path><path d="M95.745 173.72c-2.582 0-4.277 1.426-7.451 3.963-6.024 4.835-13.794 12.383-17.453 16.954-9.996 12.49-17.467 29.232-20.862 46.753-1.88 9.697-2.612 23.496-1.355 25.53 1.462 2.365 6.553 4.245 14.492 4.245 60.371.021 124.23.005 179.81 0 7.94 0 13.03-1.88 14.492-4.245 1.257-2.034.525-15.833-1.354-25.53-3.395-17.52-10.866-34.264-20.862-46.753-3.658-4.57-11.43-12.12-17.453-16.954-3.174-2.537-4.868-3.963-7.45-3.963-1.49 0-3.196 1.051-5.583 2.9-14.03 11.747-32.038 18.837-51.695 18.918-19.657-.081-37.665-7.172-51.695-18.918-2.389-1.849-4.095-2.9-5.584-2.9z"></path><g stroke-width=".921"><path d="M206.11 77.176c0 42.623-34.327 77.176-76.671 77.176-42.344 0-76.671-34.553-76.671-77.176C52.768 34.553 87.095 0 129.439 0c42.344 0 76.671 34.553 76.671 77.176" transform="translate(47.674 50.748) scale(.81399)"></path><path d="M129.44-.375c-42.548 0-77.045 34.726-77.045 77.551 0 42.824 34.497 77.551 77.045 77.551s77.047-34.726 77.047-77.551S171.988-.375 129.44-.375zm0 .75c42.14 0 76.297 34.379 76.297 76.801 0 42.422-34.157 76.801-76.297 76.801s-76.295-34.379-76.295-76.801C53.145 34.754 87.3.375 129.44.375z" transform="translate(47.674 50.748) scale(.81399)"></path></g><path transform="scale(.75)" d="M52.684 136.03c-2.85 0-4.718 1.573-8.22 4.373-6.647 5.334-15.222 13.665-19.259 18.709-11.03 13.781-19.273 32.255-23.02 51.588C.112 221.4-.698 236.628.69 238.872c1.613 2.61 7.232 4.684 15.992 4.684 21.846.008 42.85-.001 65.066 0 6.605-7.58 15.31-15.7 23.461-22.242l.012-.012.016-.014c2.044-1.635 4.034-3.417 7.6-5.517 1.973-1.163 4.658-2.296 7.571-3.086-11.19-15.375-18.287-33.905-19.69-53.941-15.745-2.765-30.084-9.644-41.872-19.514-2.635-2.04-4.516-3.2-6.16-3.2z"></path>'}let ui=document.getElementById("icon--maps"),Qe=document.getElementById("svg-sprite-component-wrap");Qe||(Qe=document.createElementNS("http://www.w3.org/2000/svg","svg"),Qe.id="svg-sprite-component-wrap",Qe.style.setProperty("display","none"),document.body.appendChild(Qe));if(!ui){let e=document.createElementNS("http://www.w3.org/2000/svg","symbol");Qe.appendChild(e),e.setAttribute("viewBox","0 0 268.83 266.53"),e.setAttribute("id","icon--maps"),e.innerHTML='<path d="M5.235.662C2.153.606 0 2.945 0 6.912v216.577c0 5.288 3.828 11.41 8.582 13.725l57.835 28.165c4.755 2.316 8.582-.078 8.582-5.367V43.434c0-5.288-3.827-11.41-8.582-13.727L8.582 1.544C7.394.965 6.262.681 5.235.662zm32.283 135.96c14.394 0 26.062 11.669 26.062 26.063 0 14.394-24.167 59.55-26.062 57.654-1.854 1.854-26.063-43.26-26.063-57.654 0-14.394 11.669-26.063 26.063-26.063zM202.388 1.013l57.833 28.165c4.755 2.315 8.583 8.437 8.583 13.726v216.58c0 5.29-3.828 7.683-8.583 5.367l-57.833-28.164c-4.755-2.316-8.583-8.438-8.583-13.727V6.38c0-5.289 3.828-7.682 8.583-5.367zM172.012.39c-1.051-.035-2.209.191-3.426.709l-68.342 29.053c-4.867 2.07-8.786 7.993-8.786 13.282V260.01c0 5.29 3.919 7.88 8.786 5.811l68.342-29.053c4.867-2.07 8.786-7.991 8.786-13.28V6.91c0-3.967-2.204-6.417-5.36-6.521zm-36.949 41.216c14.394 0 26.063 11.668 26.063 26.062 0 14.394-24.168 59.55-26.063 57.655C133.209 127.177 109 82.063 109 67.668c0-14.394 11.669-26.062 26.063-26.062z"></path><path d="M48.573 162.689a11.056 11.056 0 0 1-11.056 11.056 11.056 11.056 0 0 1-11.056-11.056 11.056 11.056 0 0 1 11.056-11.056 11.056 11.056 0 0 1 11.056 11.056zm97.547-95.02a11.056 11.056 0 0 1-11.057 11.056 11.056 11.056 0 0 1-11.056-11.056 11.056 11.056 0 0 1 11.056-11.056 11.056 11.056 0 0 1 11.056 11.056z"></path>'}let hi=document.getElementById("icon--servers"),Je=document.getElementById("svg-sprite-component-wrap");Je||(Je=document.createElementNS("http://www.w3.org/2000/svg","svg"),Je.id="svg-sprite-component-wrap",Je.style.setProperty("display","none"),document.body.appendChild(Je));if(!hi){let e=document.createElementNS("http://www.w3.org/2000/svg","symbol");Je.appendChild(e),e.setAttribute("viewBox","0 0 228.1 227.44"),e.setAttribute("id","icon--servers"),e.innerHTML='<g stroke-linecap="round" stroke-linejoin="bevel" stroke-width="30"><path d="M107.55 182.2v9.215h-.318a4.671 4.671 0 0 0-4.681 4.682v6.895h-.897a4.672 4.672 0 0 0-4.682 4.683v13.635a4.672 4.672 0 0 0 4.682 4.683h24.791a4.672 4.672 0 0 0 4.682-4.683v-13.635a4.672 4.672 0 0 0-4.682-4.683h-.895v-6.895a4.671 4.671 0 0 0-4.682-4.682h-.317V182.2zM11.637 0A11.611 11.611 0 0 0 0 11.637v30.895c0 6.447 5.19 11.637 11.637 11.637h204.82c6.447 0 11.638-5.19 11.638-11.637V11.637A11.613 11.613 0 0 0 216.457 0zm7.207 16.748h65.322a4.432 4.432 0 0 1 4.441 4.441V32.98a4.432 4.432 0 0 1-4.441 4.442H18.844a4.43 4.43 0 0 1-4.44-4.442V21.19a4.43 4.43 0 0 1 4.44-4.442zm184.49 0a10.336 10.336 0 0 1 10.337 10.337 10.336 10.336 0 0 1-10.337 10.336 10.336 10.336 0 0 1-10.336-10.336 10.336 10.336 0 0 1 10.336-10.337zM11.637 61.5A11.611 11.611 0 0 0 0 73.137v30.895c0 6.447 5.19 11.637 11.637 11.637h204.82c6.447 0 11.638-5.19 11.638-11.637V73.137A11.613 11.613 0 0 0 216.457 61.5zm7.207 16.748h65.322a4.432 4.432 0 0 1 4.441 4.441V94.48a4.432 4.432 0 0 1-4.441 4.442H18.844a4.43 4.43 0 0 1-4.44-4.442V82.69a4.43 4.43 0 0 1 4.44-4.442zm184.49 0a10.336 10.336 0 0 1 10.337 10.337 10.336 10.336 0 0 1-10.337 10.336 10.336 10.336 0 0 1-10.336-10.336 10.336 10.336 0 0 1 10.336-10.337zM11.637 123A11.612 11.612 0 0 0 0 134.637v30.895c0 6.447 5.19 11.637 11.637 11.637h204.82c6.447 0 11.638-5.19 11.638-11.637v-30.895A11.613 11.613 0 0 0 216.457 123zm7.207 16.748h65.322a4.432 4.432 0 0 1 4.441 4.441v11.791a4.432 4.432 0 0 1-4.441 4.442H18.844a4.43 4.43 0 0 1-4.44-4.442v-11.79a4.43 4.43 0 0 1 4.44-4.442zm184.49 0a10.336 10.336 0 0 1 10.337 10.337 10.336 10.336 0 0 1-10.337 10.336 10.336 10.336 0 0 1-10.336-10.336 10.336 10.336 0 0 1 10.336-10.337zM26.084 202.03a12.708 12.708 0 0 0-12.708 12.708 12.708 12.708 0 0 0 12.708 12.708 12.708 12.708 0 0 0 10.806-6.061h56v-13H37.087a12.708 12.708 0 0 0-11.002-6.353zm175.93 0a12.708 12.708 0 0 0-10.982 6.353h-55.824v13h56a12.708 12.708 0 0 0 10.806 6.061 12.708 12.708 0 0 0 12.708-12.707 12.708 12.708 0 0 0-12.708-12.708z"></path></g>'}let gi=document.getElementById("icon--day"),Xe=document.getElementById("svg-sprite-component-wrap");Xe||(Xe=document.createElementNS("http://www.w3.org/2000/svg","svg"),Xe.id="svg-sprite-component-wrap",Xe.style.setProperty("display","none"),document.body.appendChild(Xe));if(!gi){let e=document.createElementNS("http://www.w3.org/2000/svg","symbol");Xe.appendChild(e),e.setAttribute("xml:space","preserve"),e.setAttribute("id","icon--day"),e.setAttribute("viewBox","0 0 358.44 355.373"),e.innerHTML='<path d="M252.36.995a11.212 11.212 0 0 1 6.655 8.25l13.796 74.802 74.802 13.727a11.212 11.212 0 0 1 8.25 6.655c1.456 3.467 1.04 7.418-1.109 10.538l-43.19 62.67 43.19 62.602c2.15 3.12 2.565 7.071 1.11 10.537a11.212 11.212 0 0 1-8.25 6.656l-74.803 13.796-13.796 74.802a11.212 11.212 0 0 1-6.656 8.25c-3.466 1.456-7.417 1.04-10.537-1.109l-62.601-43.19-62.602 43.19c-3.12 2.15-7.071 2.565-10.537 1.11a11.212 11.212 0 0 1-6.656-8.25L85.63 271.227l-74.802-13.796a11.212 11.212 0 0 1-8.25-6.656c-1.456-3.466-1.04-7.417 1.11-10.537l43.19-62.601-43.19-62.602c-2.15-3.12-2.566-7.071-1.11-10.537a11.212 11.212 0 0 1 8.25-6.656L85.63 84.047 99.426 9.245a11.212 11.212 0 0 1 6.656-8.25c3.466-1.456 7.418-1.04 10.537 1.11l62.602 43.19 62.6-43.19c3.12-2.15 7.072-2.566 10.538-1.11zM112.667 177.638c0-36.757 29.796-66.553 66.553-66.553 36.756 0 66.553 29.796 66.553 66.553 0 36.756-29.797 66.553-66.553 66.553-36.757 0-66.553-29.797-66.553-66.553zm155.29 0c0-49.008-39.73-88.738-88.737-88.738-49.008 0-88.738 39.73-88.738 88.738s39.73 88.737 88.738 88.737 88.737-39.73 88.737-88.737z"></path>'}let fi=document.getElementById("icon--night"),et=document.getElementById("svg-sprite-component-wrap");et||(et=document.createElementNS("http://www.w3.org/2000/svg","svg"),et.id="svg-sprite-component-wrap",et.style.setProperty("display","none"),document.body.appendChild(et));if(!fi){let e=document.createElementNS("http://www.w3.org/2000/svg","symbol");et.appendChild(e),e.setAttribute("xml:space","preserve"),e.setAttribute("id","icon--night"),e.setAttribute("viewBox","0 0 358.44 355.373"),e.innerHTML='<path d="M203.928.187c-97.863 0-177.104 79.479-177.104 177.5s79.241 177.5 177.104 177.5c48.02 0 91.523-19.177 123.457-50.239 3.962-3.883 4.992-9.905 2.457-14.818-2.536-4.913-8.004-7.686-13.471-6.736a139.07 139.07 0 0 1-23.852 2.06c-76.784 0-139.068-62.441-139.068-139.463 0-52.141 28.527-97.546 70.762-121.477 4.834-2.773 7.29-8.32 6.102-13.709-1.189-5.388-5.785-9.43-11.332-9.905C213.991.504 209 .266 203.928.266z"></path>'}let yi=document.getElementById("icon--night_day"),tt=document.getElementById("svg-sprite-component-wrap");tt||(tt=document.createElementNS("http://www.w3.org/2000/svg","svg"),tt.id="svg-sprite-component-wrap",tt.style.setProperty("display","none"),document.body.appendChild(tt));if(!yi){let e=document.createElementNS("http://www.w3.org/2000/svg","symbol");tt.appendChild(e),e.setAttribute("xml:space","preserve"),e.setAttribute("id","icon--night_day"),e.setAttribute("viewBox","0 0 358.44 355.373"),e.innerHTML='<path d="M177.104 0C79.24 0 0 79.48 0 177.5S79.241 355 177.104 355c48.02 0 91.523-19.177 123.457-50.239 3.962-3.883 4.992-9.905 2.457-14.818-2.536-4.913-8.004-7.686-13.471-6.736a139.07 139.07 0 0 1-23.852 2.06c-76.784 0-139.068-62.441-139.068-139.463 0-52.141 28.527-97.546 70.762-121.477 4.834-2.773 7.29-8.32 6.102-13.709-1.189-5.388-5.785-9.43-11.332-9.905-4.992-.396-9.984-.634-15.055-.634z"></path><path d="M299.493 47.947a6.291 6.291 0 0 1 3.735 4.629l7.741 41.973 41.973 7.702a6.291 6.291 0 0 1 4.63 3.735 6.18 6.18 0 0 1-.623 5.912l-24.235 35.166 24.235 35.127a6.18 6.18 0 0 1 .622 5.913 6.291 6.291 0 0 1-4.629 3.734l-41.973 7.741-7.741 41.973a6.291 6.291 0 0 1-3.735 4.63 6.18 6.18 0 0 1-5.912-.623l-35.127-24.235-35.127 24.235a6.18 6.18 0 0 1-5.913.622 6.291 6.291 0 0 1-3.734-4.629l-7.741-41.973-41.973-7.741a6.291 6.291 0 0 1-4.63-3.734 6.18 6.18 0 0 1 .623-5.913l24.235-35.127-24.235-35.127a6.18 6.18 0 0 1-.622-5.912 6.291 6.291 0 0 1 4.629-3.735l41.973-7.741 7.741-41.973a6.291 6.291 0 0 1 3.734-4.63 6.18 6.18 0 0 1 5.913.623l35.127 24.235 35.127-24.235a6.18 6.18 0 0 1 5.912-.622zm-78.383 99.117c0-20.625 16.72-37.344 37.344-37.344 20.625 0 37.344 16.72 37.344 37.344 0 20.625-16.72 37.344-37.344 37.344-20.625 0-37.344-16.72-37.344-37.344zm87.136 0c0-27.5-22.293-49.792-49.792-49.792-27.5 0-49.792 22.293-49.792 49.792 0 27.5 22.293 49.792 49.792 49.792 27.5 0 49.792-22.293 49.792-49.792z"></path>'}const wi=$({components:{MarkersSection:mi,WorldsSection:xs,ServersSection:Ps,PlayersSection:Ss,FollowTargetSection:Qn,SvgIcon:ge},setup(){const e=E(),t=L(null),o=d(()=>e.state.firstLoad),a=d(()=>e.state.ui.visibleElements),r=d(()=>e.state.ui.previouslyVisibleElements),n=d(()=>e.state.ui.smallScreen),s=d(()=>e.state.maps.size),i=d(()=>e.state.servers.size),l=d(()=>e.state.followTarget),p=d(()=>{var H;return(H=e.state.currentMap)==null?void 0:H.nightAndDay}),g=d(()=>e.state.components.nightDay.mode),y=d(()=>e.state.messages.worldsHeading),_=d(()=>e.state.messages.serversHeading),C=d(()=>e.state.messages.markersHeading),z=d(()=>e.getters.playersHeading),O=d(()=>e.state.messages.day),U=d(()=>e.state.messages.night),w=d(()=>e.state.messages.nightDay),P=d(()=>e.getters.markerUIEnabled),k=d(()=>e.getters.playerMarkersEnabled),N=d(()=>a.value.has("players")),b=d(()=>a.value.has("maps")),j=d(()=>a.value.has("markers")),ne=d(()=>!n.value&&l.value||n.value&&N.value),fe=H=>{if(!H.target||!H.target.matches(".section__heading button"))return;const X=Array.from(t.value.querySelectorAll(".sidebar__section:not([hidden]) .section__heading button"));zt(H,X)},ye=H=>{const X=H.target.dataset.section;H.key==="ArrowDown"&&X&&(a.value.has(X)?oe(X):e.commit(m.SET_UI_ELEMENT_VISIBILITY,{element:X,state:!0}))},we=H=>{const X=H.target.dataset.section;X&&e.commit(m.TOGGLE_UI_ELEMENT_VISIBILITY,X)},lt=()=>{const H=["day","night","night_day"],X=H.indexOf(g.value),No=H[(X+1)%H.length];e.state.components.nightDay.mode=No},oe=H=>ia(`[data-section=${H}] .section__heading button`);return A(N,H=>H&&!o.value&&re(()=>oe("players"))),A(b,H=>H&&!o.value&&re(()=>oe("maps"))),A(j,H=>H&&!o.value&&re(()=>oe("markers"))),{sidebar:t,mapCount:s,serverCount:i,following:l,nightDay:p,nightDayMode:g,messageWorlds:y,messageServers:_,messageMarkers:C,messagePlayers:z,messageDay:O,messageNight:U,messageNightDay:w,previouslyVisible:r,playersVisible:N,mapsVisible:b,markersVisible:j,followVisible:ne,playerMakersEnabled:k,markerUIEnabled:P,handleSidebarKeydown:fe,handleSectionKeydown:ye,handleSectionClick:we,handleNightDayClick:lt}}});const vi={class:"sidebar",role:"none",ref:"sidebar"},_i={class:"sidebar__buttons"},bi=["title","aria-label"],Si=["title","aria-label","aria-expanded"],ki=["title","aria-label","aria-expanded"],Ei=["title","aria-label","aria-expanded"];function Li(e,t,o,a,r,n){const s=S("SvgIcon"),i=S("ServersSection"),l=S("WorldsSection"),p=S("MarkersSection"),g=S("PlayersSection"),y=S("FollowTargetSection");return u(),v("section",vi,[h("header",_i,[e.nightDay?(u(),v("button",{key:0,ref:"nightDay-button",type:"button",class:"button--night-day",title:e.nightDayMode==="night"?e.messageNight:e.nightDayMode==="day"?e.messageDay:e.messageNightDay,"aria-label":e.nightDayMode==="night"?e.messageNight:e.nightDayMode==="day"?e.messageDay:e.messageNightDay,onClick:t[0]||(t[0]=(..._)=>e.handleNightDayClick&&e.handleNightDayClick(..._))},[Z(s,{name:e.nightDayMode},null,8,["name"])],8,bi)):I("",!0),e.mapCount>1||e.serverCount>1?(u(),v("button",{key:1,ref:"maps-button",type:"button",class:"button--maps","data-section":"maps",title:e.mapCount>1?e.messageWorlds:e.messageServers,"aria-label":e.mapCount>1?e.messageWorlds:e.messageServers,"aria-expanded":e.mapsVisible,onClick:t[1]||(t[1]=(..._)=>e.handleSectionClick&&e.handleSectionClick(..._)),onKeydown:t[2]||(t[2]=(..._)=>e.handleSectionKeydown&&e.handleSectionKeydown(..._))},[Z(s,{ref:"maps-icon",name:e.mapCount>1?"maps":"servers"},null,8,["name"])],40,Si)):I("",!0),e.markerUIEnabled?(u(),v("button",{key:2,ref:"markers-button",type:"button",class:"button--markers","data-section":"markers",title:e.messageMarkers,"aria-label":e.messageMarkers,"aria-expanded":e.markersVisible,onClick:t[3]||(t[3]=(..._)=>e.handleSectionClick&&e.handleSectionClick(..._)),onKeydown:t[4]||(t[4]=(..._)=>e.handleSectionKeydown&&e.handleSectionKeydown(..._))},[Z(s,{name:"marker_point"})],40,ki)):I("",!0),e.playerMakersEnabled?(u(),v("button",{key:3,ref:"players-button",type:"button",class:"button--players","data-section":"players",title:e.messagePlayers,"aria-label":e.messagePlayers,"aria-expanded":e.playersVisible,onClick:t[5]||(t[5]=(..._)=>e.handleSectionClick&&e.handleSectionClick(..._)),onKeydown:t[6]||(t[6]=(..._)=>e.handleSectionKeydown&&e.handleSectionKeydown(..._))},[Z(s,{name:"players"})],40,Ei)):I("",!0)]),h("div",{class:"sidebar__content",onKeydown:t[7]||(t[7]=(..._)=>e.handleSidebarKeydown&&e.handleSidebarKeydown(..._))},[e.serverCount>1?(u(),T(i,{key:0,hidden:!e.mapsVisible},null,8,["hidden"])):I("",!0),e.mapCount>1?(u(),T(l,{key:1,hidden:!e.mapsVisible},null,8,["hidden"])):I("",!0),e.previouslyVisible.has("markers")?(u(),T(p,{key:2,hidden:!e.markersVisible},null,8,["hidden"])):I("",!0),e.playerMakersEnabled&&e.previouslyVisible.has("players")?(u(),T(g,{key:3,hidden:!e.playersVisible},null,8,["hidden"])):I("",!0),e.following?(u(),T(y,{key:4,hidden:!e.followVisible,target:e.following},null,8,["hidden","target"])):I("",!0)],32)],512)}const Ci=R(wi,[["render",Li]]),Mi=$({components:{PlayerImage:Jt},props:{message:{type:Object,required:!0}},setup(e){const t=E();let o=d(()=>{var s;return((s=t.state.components.chatBox)==null?void 0:s.showPlayerFaces)&&e.message.playerAccount}),a=d(()=>e.message.playerName&&e.message.type==="chat"),r=d(()=>e.message.type==="chat"?e.message.channel:void 0),n=d(()=>{switch(e.message.type){case"chat":return e.message.message;case"playerjoin":return e.message.playerName?t.state.messages.chatPlayerJoin.replace("%playername%",e.message.playerName):t.state.messages.chatAnonymousJoin;case"playerleave":return e.message.playerName?t.state.messages.chatPlayerQuit.replace("%playername%",e.message.playerName):t.state.messages.chatAnonymousQuit}});return{showFace:o,showSender:a,messageChannel:r,messageContent:n}}});const Ti=["innerHTML"],Ii=["innerHTML"],$i={class:"message__content"};function Ai(e,t,o,a,r,n){const s=S("PlayerImage");return u(),v("li",{class:le(`message message--${e.message.type}`)},[e.showFace&&e.message.playerAccount?(u(),T(s,{key:0,player:e.message.playerAccount,width:"16",height:"16",class:"message__face"},null,8,["player"])):I("",!0),e.messageChannel?(u(),v("span",{key:1,class:"message__channel",innerHTML:e.messageChannel},null,8,Ti)):I("",!0),e.showSender?(u(),v("span",{key:2,class:"message__sender",innerHTML:e.message.playerName},null,8,Ii)):I("",!0),h("span",$i,M(e.messageContent),1)],2)}const zi=R(Mi,[["render",Ai]]),Pi=$({components:{ChatMessage:zi},setup(){const e=E(),t=d(()=>e.state.components.chatBox),o=d(()=>e.state.ui.visibleElements.has("chat")),a=d(()=>e.state.components.chatSending&&e.state.components.chatSending.loginRequired&&!e.state.loggedIn),r=d(()=>e.state.components.chatSending&&!a.value),n=d(()=>{var w;return(w=e.state.components.chatSending)==null?void 0:w.maxLength}),s=L(null),i=L(""),l=L(!1),p=L(null),g=d(()=>t.value.messageHistory?e.state.chat.messages.slice(0,t.value.messageHistory):e.state.chat.messages),y=d(()=>e.state.messages.chatSend),_=d(()=>e.state.messages.chatPlaceholder),C=d(()=>e.state.messages.chatNoMessages),z=d(()=>e.state.messages.chatLogin),O=async()=>{const w=i.value.trim().substring(0,n.value);if(w){l.value=!0,p.value=null;try{await e.dispatch(D.SEND_CHAT_MESSAGE,w),i.value="",p.value=null}catch(P){P instanceof bt?p.value=P.message:p.value=e.state.messages.chatErrorUnknown}finally{l.value=!1,requestAnimationFrame(()=>s.value.focus())}}},U=()=>e.dispatch(D.LOGIN,null);return A(o,w=>{w&&r.value&&requestAnimationFrame(()=>s.value.focus())}),{chatInput:s,enteredMessage:i,sendMessage:O,login:U,chatMessages:g,loginRequired:a,sendingEnabled:r,sendingMessage:l,sendingError:p,maxMessageLength:n,messageLogin:z,messageSend:y,messageNoMessages:C,messagePlaceholder:_}}});const Ui={class:"chat"},Ni={class:"chat__messages",role:"log","aria-live":"polite","aria-relevant":"additions"},Oi={key:0,class:"message message--skeleton",role:"none"},Ri={key:0,role:"alert",class:"chat__error"},Di=["maxlength","placeholder","disabled"],Hi=["disabled"];function xi(e,t,o,a,r,n){const s=S("ChatMessage");return u(),v("section",Ui,[h("ul",Ni,[(u(!0),v(x,null,Y(e.chatMessages,i=>(u(),T(s,{key:i.timestamp,message:i},null,8,["message"]))),128)),e.chatMessages.length?I("",!0):(u(),v("li",Oi,M(e.messageNoMessages),1))]),e.sendingEnabled?(u(),v("form",{key:0,class:"chat__form",onSubmit:t[1]||(t[1]=J((...i)=>e.sendMessage&&e.sendMessage(...i),["prevent"]))},[e.sendingError?(u(),v("div",Ri,M(e.sendingError),1)):I("",!0),B(h("input",{ref:"chatInput","onUpdate:modelValue":t[0]||(t[0]=i=>e.enteredMessage=i),class:"chat__input",type:"text",maxlength:e.maxMessageLength,placeholder:e.messagePlaceholder,disabled:e.sendingMessage},null,8,Di),[[Q,e.enteredMessage]]),h("button",{class:"chat__send",disabled:!e.enteredMessage||e.sendingMessage},M(e.messageSend),9,Hi)],32)):I("",!0),e.loginRequired?(u(),v("button",{key:1,type:"button",class:"chat__login",onClick:t[2]||(t[2]=(...i)=>e.login&&e.login(...i))},M(e.messageLogin),1)):I("",!0)])}const Bi=R(Pi,[["render",xi]]),Lt=document.getElementById("app"),ce=document.getElementById("splash"),Ct=document.getElementById("splash__spinner"),Mt=document.getElementById("splash__error"),Nt=document.getElementById("splash__error-message"),at=document.getElementById("splash__error-retry"),Wi=function(e){!ce||!Lt||(e&&(Mt&&Mt.setAttribute("aria-hidden","true"),Ct&&(Ct.style.visibility="visible"),at&&(at.hidden=!0)),ce.hidden=!1,Lt.setAttribute("aria-hidden","true"),requestAnimationFrame(function(){ce.style.opacity="1"}))},Zi=()=>{!ce||!Lt||requestAnimationFrame(()=>{ce.style.opacity="0",Lt.removeAttribute("aria-hidden"),window.getComputedStyle(ce).opacity==="0"&&(ce.hidden=!0)})},Tt=(e,t,o)=>{Mt&&Mt.setAttribute("aria-hidden","false"),Nt&&Nt.innerText!==e&&(Nt.innerText=e||"Unknown error"),Ct&&t&&(Ct.style.visibility="hidden"),at&&(t?at.hidden=!0:o&&(at.hidden=!1,at.textContent=`Retrying... (${o.toString()})`))},Vi=$({setup(){const e=E(),t=L(null),o=L(null),a=d(()=>e.state.ui.visibleModal==="login"),r=d(()=>e.state.messages.loginHeading),n=d(()=>e.state.messages.loginHeading),s=d(()=>e.state.messages.loginUsernameLabel),i=d(()=>e.state.messages.loginPasswordLabel),l=d(()=>e.state.messages.loginSubmit),p=d(()=>e.state.messages.loginSuccess),g=L(""),y=L(""),_=L(!1),C=L(!1),z=L(null);return V(()=>{Go(async()=>{await re(),a.value?o.value.focus():(g.value="",y.value="")})}),{form:t,usernameField:o,heading:r,loginHeading:n,usernameLabel:s,passwordLabel:i,loginSubmit:l,loginUsername:g,loginPassword:y,submitting:_,invalid:C,error:z,login:async()=>{if(z.value=null,C.value=!t.value.reportValidity(),!C.value)try{_.value=!0,await e.dispatch(D.LOGIN,{username:g.value,password:y.value}),e.commit(m.HIDE_UI_MODAL,"login"),nt(p.value)}catch(U){z.value=U}finally{_.value=!1}}}}}),ji={class:"form__group"},Fi={for:"login-username",class:"form__label"},Gi={class:"form__group"},qi={for:"login-password",class:"form__label"},Ki={key:0,role:"alert","aria-live":"assertive",class:"form__group alert"},Yi={class:"form__group"},Qi=["disabled"];function Ji(e,t,o,a,r,n){return u(),v("form",{class:le({form:!0,"form--invalid":e.invalid}),onSubmit:t[2]||(t[2]=J((...s)=>e.login&&e.login(...s),["prevent"])),ref:"form",novalidate:""},[h("h3",null,M(e.loginHeading),1),h("div",ji,[h("label",Fi,M(e.usernameLabel),1),B(h("input",{id:"login-username",type:"text",name:"username",autocomplete:"username","onUpdate:modelValue":t[0]||(t[0]=s=>e.loginUsername=s),required:"",ref:"usernameField"},null,512),[[Q,e.loginUsername]])]),h("div",Gi,[h("label",qi,M(e.passwordLabel),1),B(h("input",{id:"login-password",type:"password",name:"password",autocomplete:"current-password","onUpdate:modelValue":t[1]||(t[1]=s=>e.loginPassword=s),required:""},null,512),[[Q,e.loginPassword]])]),e.error?(u(),v("div",Ki,M(e.error),1)):I("",!0),h("div",Yi,[h("button",{type:"submit",disabled:e.submitting},M(e.loginSubmit),9,Qi)])],34)}const Xi=R(Vi,[["render",Ji]]),el=$({setup(){const e=E(),t=L(null),o=L(null),a=d(()=>e.state.ui.visibleModal==="login"),r=d(()=>e.state.messages.loginUsernameLabel),n=d(()=>e.state.messages.loginPasswordLabel),s=d(()=>e.state.messages.registerConfirmPasswordLabel),i=d(()=>e.state.messages.registerCodeLabel),l=d(()=>e.state.messages.registerHeading),p=d(()=>e.state.messages.registerDescription),g=d(()=>e.state.messages.registerSubmit),y=d(()=>e.state.messages.registerErrorVerifyFailed),_=L(""),C=L(""),z=L(""),O=L(""),U=L(!1),w=L(!1),P=L(null);A(a,b=>{b||(_.value="",C.value="",z.value="",O.value="")});const k=()=>{C.value!==z.value?o.value.setCustomValidity(y.value):o.value.setCustomValidity("")};return{form:t,confirmPasswordField:o,messageHeading:l,messageDescription:p,messageUsernameLabel:r,messagePasswordLabel:n,messageConfirmPasswordLabel:s,messageRegisterCodeLabel:i,messageSubmit:g,valueUsername:_,valuePassword:C,valuePassword2:z,valueCode:O,submitting:U,invalid:w,error:P,register:async()=>{if(P.value=null,k(),w.value=!t.value.reportValidity(),!w.value)try{U.value=!0,await e.dispatch(D.REGISTER,{username:_.value,password:C.value,code:O.value}),e.commit(m.HIDE_UI_MODAL,"login")}catch(b){P.value=b}finally{U.value=!1}}}}});const tl={class:"form__group"},ol={for:"register-username",class:"form__label"},al={class:"form__group"},rl={for:"register-password",class:"form__label"},nl={class:"form__group"},sl={for:"register-confirm-password",class:"form__label"},il={class:"form__group"},ll={for:"register-code",class:"form__label"},dl={key:0,role:"alert","aria-live":"assertive",class:"form__group alert"},cl={class:"form__group"},ml=["disabled"];function pl(e,t,o,a,r,n){return u(),v("form",{class:le({form:!0,"form--invalid":e.invalid}),onSubmit:t[4]||(t[4]=J((...s)=>e.register&&e.register(...s),["prevent"])),ref:"form",novalidate:""},[h("h3",null,M(e.messageHeading),1),h("p",null,M(e.messageDescription),1),h("div",tl,[h("label",ol,M(e.messageUsernameLabel),1),B(h("input",{id:"register-username",type:"text",name:"username",autocomplete:"username","onUpdate:modelValue":t[0]||(t[0]=s=>e.valueUsername=s),required:""},null,512),[[Q,e.valueUsername]])]),h("div",al,[h("label",rl,M(e.messagePasswordLabel),1),B(h("input",{id:"register-password",type:"password",name:"password",autocomplete:"new-password","onUpdate:modelValue":t[1]||(t[1]=s=>e.valuePassword=s),required:""},null,512),[[Q,e.valuePassword]])]),h("div",nl,[h("label",sl,M(e.messageConfirmPasswordLabel),1),B(h("input",{id:"register-confirm-password",type:"password",name:"confirm_password",autocomplete:"new-password","onUpdate:modelValue":t[2]||(t[2]=s=>e.valuePassword2=s),required:"",ref:"confirmPasswordField"},null,512),[[Q,e.valuePassword2]])]),h("div",il,[h("label",ll,M(e.messageRegisterCodeLabel),1),B(h("input",{id:"register-code",type:"tel",name:"code",minlength:"9",maxlength:"9","onUpdate:modelValue":t[3]||(t[3]=s=>e.valueCode=s),required:""},null,512),[[Q,e.valueCode]])]),e.error?(u(),v("div",dl,M(e.error),1)):I("",!0),h("div",cl,[h("button",{type:"submit",disabled:e.submitting},M(e.messageSubmit),9,ml)])],34)}const ul=R(el,[["render",pl],["__scopeId","data-v-e611b0ab"]]),hl=$({components:{SvgIcon:ge},props:{id:{required:!0,type:String},closeable:{default:!0,type:Boolean},backdrop:{default:!0,type:Boolean}},setup(e){const t=E(),o=L(null),a=d(()=>t.state.messages.closeTitle),r=d(()=>t.state.ui.visibleModal===e.id),n=l=>{e.closeable&&r.value&&l.key==="Escape"&&(i(),l.preventDefault(),l.stopImmediatePropagation())},s=l=>{e.closeable&&l.target===o.value&&i()},i=()=>e.closeable&&t.commit(m.HIDE_UI_MODAL,e.id);return V(()=>{window.addEventListener("keydown",n)}),G(()=>{window.removeEventListener("keydown",n)}),{visible:r,modal:o,onBackdropClick:s,close:i,messageClose:a}}});const gl=["id","aria-labelledby"],fl={class:"modal__header"},yl=["aria-label"],wl={class:"modal__content"};function vl(e,t,o,a,r,n){const s=S("SvgIcon");return u(),v("div",{class:le({modal:!0,"modal--visible":e.visible,"modal--backdrop":e.backdrop}),role:"dialog",id:`modal--${e.id}`,"aria-labelledby":`${e.id}__heading`,"aria-modal":"true",onClick:t[1]||(t[1]=(...i)=>e.onBackdropClick&&e.onBackdropClick(...i)),ref:"modal"},[h("div",fl,[mt(e.$slots,"header"),e.closeable?(u(),v("button",{key:0,class:"modal__close",type:"button",onClick:t[0]||(t[0]=(...i)=>e.close&&e.close(...i)),"aria-label":e.messageClose},[Z(s,{name:"cross"})],8,yl)):I("",!0)]),h("div",wl,[mt(e.$slots,"default")])],10,gl)}const _l=R(hl,[["render",vl]]),bl=$({components:{BaseModal:_l,RegisterForm:ul,LoginForm:Xi},props:{required:{default:!1,type:Boolean}},setup(){const e=E();return{heading:d(()=>e.state.messages.loginTitle)}}});const Sl={id:"login__heading"};function kl(e,t,o,a,r,n){const s=S("LoginForm"),i=S("RegisterForm"),l=S("BaseModal");return u(),T(l,{id:"login",closeable:!e.required,backdrop:!e.required},{header:F(()=>[h("h2",Sl,M(e.heading),1)]),default:F(()=>[Z(s),Z(i)]),_:1},8,["closeable","backdrop"])}const El=R(bl,[["render",kl],["__scopeId","data-v-96d9e2ef"]]),Ll=$({name:"App",components:{Map:Hn,Sidebar:Ci,ChatBox:Bi,LoginModal:El},setup(){let e=null;const t=E(),o=d(()=>t.getters.pageTitle),a=d(()=>t.getters.url),r=d(()=>t.state.currentServer),n=d(()=>t.state.configurationHash),s=d(()=>t.state.components.chatBox),i=d(()=>t.state.ui.visibleElements.has("chat")),l=d(()=>t.state.components.players.imageUrl),p=d(()=>t.state.loggedIn),g=d(()=>t.state.loginRequired),y=d(()=>t.getters.loginEnabled),_=d(()=>t.state.ui.visibleModal==="login"&&(!g.value||!t.state.ui.visibleElements.has("maps"))),C=L(!1),z=L(0),O=async()=>{try{clearTimeout(Number(e)),Wi(!z.value),C.value=!0,await t.dispatch(D.LOAD_CONFIGURATION,void 0),await t.dispatch(D.START_UPDATES,void 0),requestAnimationFrame(()=>{Zi();const k=document.getElementById("#app");k&&k.focus()})}catch(k){if(!(k instanceof DOMException&&k.name==="AbortError")&&!g.value){const N=`Failed to load server configuration for '${t.state.currentServer.id}'`;console.error(`${N}:`,k),Tt(`${N}
${k}`,!1,++z.value),clearTimeout(Number(e)),e=setTimeout(()=>O(),1e3)}}finally{C.value=!1}},U=()=>{const k=new URL(window.location.href),N=ra(k);N&&(N.legacy&&(k.searchParams.delete("worldname"),k.searchParams.delete("world"),k.searchParams.delete("mapname"),k.searchParams.delete("x"),k.searchParams.delete("y"),k.searchParams.delete("z"),k.searchParams.delete("zoom"),history.replaceState({},"",k.toString())),t.commit(m.SET_PARSED_URL,N))},w=()=>{t.commit(m.SET_SCREEN_SIZE,{width:window.innerWidth,height:window.innerHeight})},P=k=>{if(!k.ctrlKey||!k.shiftKey)return;let N;if(!(t.state.ui.visibleModal&&(!g.value||k.key!=="M"))){switch(k.key){case"M":N="maps";break;case"I":N="markers";break;case"C":N="chat";break;case"P":N="players";break;case"L":N="layers";break;default:return}k.preventDefault(),t.commit(m.TOGGLE_UI_ELEMENT_VISIBILITY,N)}};return A(o,k=>document.title=k),A(a,k=>window.history.replaceState({},"",k)),A(r,k=>{k&&(to(),z.value=0,window.history.replaceState({},"",k.id),O())},{deep:!0}),A(n,async(k,N)=>{k&&N&&await O()}),A(p,async()=>{C.value||(console.log("Login state changed. Reloading configuration"),await O())}),A(g,k=>{k?(t.commit(m.SET_UI_ELEMENT_VISIBILITY,{element:"maps",state:!1}),t.dispatch(D.LOGIN,null),nt("Login required"),Tt("Login required",!0,1)):t.commit(m.HIDE_UI_MODAL,"login")}),A(l,()=>{to()}),U(),w(),V(()=>{window.addEventListener("resize",w),window.addEventListener("keydown",P),window.addEventListener("hashchange",U),O()}),qo(()=>{t.dispatch(D.STOP_UPDATES,void 0),clearTimeout(Number(e)),window.removeEventListener("resize",w),window.removeEventListener("keydown",P),window.removeEventListener("hashchange",U)}),{chatBoxEnabled:s,chatVisible:i,loginEnabled:y,loginRequired:g,loginModalVisible:_}}});function Cl(e,t,o,a,r,n){const s=S("Map"),i=S("ChatBox"),l=S("LoginModal"),p=S("Sidebar"),g=S("notifications");return u(),v(x,null,[Z(s),e.chatBoxEnabled?B((u(),T(i,{key:0},null,512)),[[Rt,e.chatBoxEnabled&&e.chatVisible]]):I("",!0),e.loginEnabled?B((u(),T(l,{key:1,required:e.loginRequired},null,8,["required"])),[[Rt,e.loginModalVisible]]):I("",!0),Z(p),Z(g,{position:"bottom center",speed:250,max:3,ignoreDuplicates:!0,classes:"notification"})],64)}const Ml=R(Ll,[["render",Cl]]);class Tl extends ht{constructor(t){super(t),this._url=`${t.baseUrl}{z}/{x}_{y}.png`,f.Util.setOptions(this,{zoomReverse:!1})}}class q extends he{constructor(o,a){super(o,a);c(this,"configurationAbort");c(this,"markersAbort");c(this,"playersAbort");c(this,"updatesEnabled",!1);c(this,"playerUpdateTimeout",null);c(this,"playerUpdateTimestamp",new Date);c(this,"playerUpdateInterval",3e3);c(this,"markerUpdateTimeout",null);c(this,"markerUpdateInterval",3e3);c(this,"worldPlayerUpdateIntervals",new Map);c(this,"worldMarkerUpdateIntervals",new Map);c(this,"worldComponents",new Map);c(this,"markerSets",new Map);c(this,"markers",new Map);this.config===!0&&(this.config=window.location.pathname),de(a,o,"map"),this.config.slice(-1)!=="/"&&(this.config=`${a}/`)}static buildServerConfig(o){var a,r,n;return{title:(((a=o.ui)==null?void 0:a.title)||"Pl3xmap").replace(so,""),expandUI:((n=(r=o.ui)==null?void 0:r.sidebar)==null?void 0:n.pinned)==="pinned",singleMapWorlds:!0,defaultZoom:1,defaultMap:void 0,defaultWorld:void 0,followMap:void 0,followZoom:void 0}}static buildMessagesConfig(o){var a,r,n,s;return{worldsHeading:((r=(a=o.ui)==null?void 0:a.sidebar)==null?void 0:r.world_list_label)||"",playersHeading:((s=(n=o.ui)==null?void 0:n.sidebar)==null?void 0:s.player_list_label)||"",chatPlayerJoin:"",chatPlayerQuit:"",chatAnonymousJoin:"",chatAnonymousQuit:"",chatErrorNotAllowed:"",chatErrorRequiresLogin:"",chatErrorCooldown:""}}buildWorlds(o,a){const r=[];return this.worldComponents.clear(),this.worldMarkerUpdateIntervals.clear(),this.worldPlayerUpdateIntervals.clear(),(o.worlds||[]).filter(s=>s&&!!s.name).sort((s,i)=>s.order-i.order).forEach((s,i)=>{var C,z,O,U,w,P,k,N,b,j,ne,fe;const l=a[i],p={components:{players:{markers:void 0,imageUrl:ut,grayHiddenPlayers:!0,showImages:!0}}};if(this.worldMarkerUpdateIntervals.set(s.name,l.marker_update_interval||3e3),(C=l.player_tracker)!=null&&C.enabled){const ye=!!((O=(z=l.player_tracker)==null?void 0:z.nameplates)!=null&&O.show_health),we=!!((w=(U=l.player_tracker)==null?void 0:U.nameplates)!=null&&w.show_armor),lt=!!((k=(P=l.player_tracker)==null?void 0:P.nameplates)!=null&&k.show_heads),oe=l.player_tracker.update_interval?l.player_tracker.update_interval*1e3:3e3;this.worldPlayerUpdateIntervals.set(s.name,oe),(b=(N=l.player_tracker)==null?void 0:N.nameplates)!=null&&b.heads_url&&(p.components.players.imageUrl=H=>l.player_tracker.nameplates.heads_url.replace("{uuid}",H.uuid).replace("{name}",encodeURIComponent(H.name))),p.components.players.markers={hideByDefault:!!((j=l.player_tracker)!=null&&j.default_hidden),layerName:((ne=l.player_tracker)==null?void 0:ne.label)||"",layerPriority:(fe=l.player_tracker)==null?void 0:fe.priority,imageSize:lt?ye&&we?"large":"small":"none",showHealth:ye,showArmor:we,showYaw:!0}}if(this.worldComponents.set(s.name,p),!l){console.warn(`World ${s.name} has no matching world config. Ignoring.`);return}let g="overworld";s.type==="nether"?g="nether":s.type==="the_end"&&(g="end");const y=new Set,_={name:s.name||"(Unnamed world)",displayName:s.display_name||s.name,dimension:g,seaLevel:0,maps:y};y.add(Object.freeze(new $t({world:_,name:"flat",displayName:"Flat",icon:s.icon?`${this.config}images/icon/${s.icon}.png`:void 0,baseUrl:`${this.config}tiles/${_.name}/`,imageFormat:"png",tileSize:512,background:"transparent",backgroundDay:"transparent",backgroundNight:"transparent",nativeZoomLevels:l.zoom.max||1,extraZoomLevels:l.zoom.extra,defaultZoom:l.zoom.def||1,tileUpdateInterval:l.tiles_update_interval?l.tiles_update_interval*1e3:void 0,center:{x:l.spawn.x,y:0,z:l.spawn.z}}))),r.push(_)}),Array.from(r.values())}static buildComponents(o){var r,n,s,i,l,p,g,y;const a={coordinatesControl:void 0,linkControl:!!((n=(r=o.ui)==null?void 0:r.link)!=null&&n.enabled),layerControl:!!((i=(s=o.ui)==null?void 0:s.coordinates)!=null&&i.enabled),players:{markers:void 0,imageUrl:ut,showImages:!0,grayHiddenPlayers:!0},markers:{showLabels:!1},nightDay:{mode:"night_day",value:-1},chatBox:void 0,chatBalloons:!1,clockControl:void 0,logoControls:[],login:!1};if((p=(l=o.ui)==null?void 0:l.coordinates)!=null&&p.enabled){const _=(((y=(g=o.ui)==null?void 0:g.coordinates)==null?void 0:y.html)||"Location: ").replace(/{x}.*{z}/gi,"").trim(),C=new DOMParser().parseFromString(_,"text/html").body.textContent||"";a.coordinatesControl={showY:!1,label:C,showRegion:!1,showChunk:!1}}return a}async getMarkerSets(o){const a=`${this.config}tiles/${encodeURIComponent(o.name)}/markers.json`;this.markersAbort&&this.markersAbort.abort(),this.markersAbort=new AbortController;const r=await q.getJSON(a,this.markersAbort.signal);Array.isArray(r)&&r.forEach(n=>{if(!n||!n.id){console.warn("Ignoring marker set without id");return}const s=n.id,i=Object.freeze(new Map);(n.markers||[]).forEach(l=>{let p;switch(l.type){case"icon":p=`point_${i.size}`,i.set(p,this.buildMarker(p,l));break;case"polyline":p=`line_${i.size}`,i.set(p,q.buildLine(p,l));break;case"rectangle":case"polygon":p=`area_${i.size}`,i.set(p,q.buildArea(p,l));break;case"circle":case"ellipse":p=`circle_${i.size}`,i.set(p,q.buildCircle(p,l));break;default:console.warn("Marker type "+l.type+" not supported")}}),this.markerSets.set(s,{id:s,label:n.name||"Unnamed set",hidden:n.hide||!1,priority:n.order||0,showLabels:!1}),this.markers.set(s,i)})}buildMarker(o,a){var r,n;return{id:o,type:W.POINT,location:{x:((r=a.point)==null?void 0:r.x)||0,y:0,z:((n=a.point)==null?void 0:n.z)||0},iconSize:a.size?[a.size.x||16,a.size.z||16]:[16,16],iconUrl:`${this.config}images/icon/registered/${a.icon||"default"}.png`,tooltip:a.tooltip?ae(a.tooltip):"",tooltipHTML:a.tooltip,popup:a.popup,isPopupHTML:!0}}static buildArea(o,a){let r;a.type==="rectangle"?r=[{x:a.points[0].x,y:0,z:a.points[0].z},{x:a.points[0].x,y:0,z:a.points[1].z},{x:a.points[1].x,y:0,z:a.points[1].z},{x:a.points[1].x,y:0,z:a.points[0].z}]:r=this.addY(a.points);const n=Ht(r);return{id:o,type:W.AREA,style:{stroke:(typeof a.stroke>"u"||!!a.stroke)&&!!a.color,color:a.color||"#3388ff",weight:a.weight||3,opacity:typeof a.opacity<"u"?a.opacity:1,fill:(typeof a.fill>"u"||!!a.fill)&&!!a.fillColor,fillColor:a.fillColor||a.color||"#3388ff",fillOpacity:a.fillOpacity||.2,fillRule:a.fillRule},points:r,bounds:n,location:pt(n),outline:!1,tooltip:a.tooltip?ae(a.tooltip):"",tooltipHTML:a.tooltip,popup:a.popup,isPopupHTML:!0}}static buildLine(o,a){const r=this.addY(a.points),n=Ht(r);return{id:o,type:W.LINE,style:{stroke:(typeof a.stroke>"u"||!!a.stroke)&&!!a.color,color:a.color||"#3388ff",weight:a.weight||3,opacity:typeof a.opacity<"u"?a.opacity:1},points:r,bounds:n,location:pt(n),tooltip:a.tooltip?ae(a.tooltip):"",tooltipHTML:a.tooltip,popup:a.popup,isPopupHTML:!0}}static buildCircle(o,a){var s,i;const r=[a.radiusX||a.radius||0,a.radiusZ||a.radius||0],n={x:((s=a.center)==null?void 0:s.x)||0,y:0,z:((i=a.center)==null?void 0:i.z)||0};return{id:o,type:W.CIRCLE,location:n,radius:r,bounds:{max:{x:n.x+r[0],y:0,z:n.z+r[1]},min:{x:n.x-r[0],y:0,z:n.z-r[1]}},style:{stroke:(typeof a.stroke>"u"||!!a.stroke)&&!!a.color,color:a.color||"#3388ff",weight:a.weight||3,opacity:typeof a.opacity<"u"?a.opacity:1,fill:(typeof a.fill>"u"||!!a.fill)&&!!a.fillColor,fillColor:a.fillColor||a.color||"#3388ff",fillOpacity:a.fillOpacity||.2,fillRule:a.fillRule},tooltip:a.tooltip?ae(a.tooltip):"",tooltipHTML:a.tooltip,popup:a.popup,isPopupHTML:!0}}static addY(o){for(const a of o)a.y=0;return o}async loadServerConfiguration(){this.configurationAbort&&this.configurationAbort.abort(),this.configurationAbort=new AbortController;const o=this.config,a=await q.getJSON(`${o}tiles/settings.json`,this.configurationAbort.signal);if(a.error)throw new Error(a.error);const r=q.buildServerConfig(a),n=(a.worlds||[]).filter(i=>i&&!!i.name).map(i=>i.name),s=await Promise.all(n.map(i=>q.getJSON(`${o}tiles/${i}/settings.json`,this.configurationAbort.signal)));this.store.commit(m.SET_SERVER_CONFIGURATION,r),this.store.commit(m.SET_MESSAGES,q.buildMessagesConfig(a)),this.store.commit(m.SET_WORLDS,this.buildWorlds(a,s)),this.store.commit(m.SET_COMPONENTS,q.buildComponents(a))}async populateWorld(o){const a=this.worldComponents.get(o.name);await this.getMarkerSets(o),this.playerUpdateInterval=this.worldPlayerUpdateIntervals.get(o.name)||3e3,this.markerUpdateInterval=this.worldMarkerUpdateIntervals.get(o.name)||3e3,this.store.commit(m.SET_MARKER_SETS,this.markerSets),this.store.commit(m.SET_MARKERS,this.markers),this.store.commit(m.SET_COMPONENTS,a.components),this.markerSets.clear(),this.markers.clear()}createTileLayer(o){return new Tl(o)}async getPlayers(){const o=`${this.config}tiles/players.json`;this.playersAbort&&this.playersAbort.abort(),this.playersAbort=new AbortController;const a=await q.getJSON(o,this.playersAbort.signal),r=new Set;return(a.players||[]).forEach(n=>{r.add({name:(n.name||"").toLowerCase(),uuid:n.uuid,displayName:n.display_name||n.name||"",health:n.health||0,armor:n.armor||0,sort:0,hidden:!1,location:{x:isNaN(n.x)?0:n.x+.5,y:0,z:isNaN(n.z)?0:n.z+.5,world:n.world},yaw:isNaN(n.yaw)?0:parseFloat(n.yaw)+180})}),this.store.commit(m.SET_MAX_PLAYERS,a.max||0),r}startUpdates(){this.updatesEnabled=!0,this.updatePlayers(),this.updateMarkers()}async updatePlayers(){try{if(this.store.getters.playerMarkersEnabled){const o=await this.getPlayers();this.playerUpdateTimestamp=new Date,await this.store.dispatch(D.SET_PLAYERS,o)}}finally{this.updatesEnabled&&(this.playerUpdateTimeout&&clearTimeout(this.playerUpdateTimeout),this.playerUpdateTimeout=setTimeout(()=>this.updatePlayers(),this.playerUpdateInterval))}}async updateMarkers(){}stopUpdates(){this.updatesEnabled=!1,this.markerUpdateTimeout&&clearTimeout(this.markerUpdateTimeout),this.playerUpdateTimeout&&clearTimeout(this.playerUpdateTimeout),this.markerUpdateTimeout=null,this.playerUpdateTimeout=null,this.configurationAbort&&this.configurationAbort.abort(),this.playersAbort&&this.playersAbort.abort(),this.markersAbort&&this.markersAbort.abort()}}class Il extends ht{constructor(t){super(t),f.Util.setOptions(this,{zoomReverse:!1})}getTileUrl(t){let o=this.options.prefix;const a=t.z;if(t.x<0||t.x>=Math.pow(2,a)||t.y<0||t.y>=Math.pow(2,a))o+="/blank";else if(a===0)o+="/base";else for(let r=a-1;r>=0;--r){const n=Math.floor(t.x/Math.pow(2,r))%2,s=Math.floor(t.y/Math.pow(2,r))%2;o+="/"+(n+2*s)}return o+=`.${this.options.imageFormat}`,this.options.baseUrl+o}}class $l{constructor(t){c(this,"upperRight");c(this,"lowerRight");c(this,"lowerLeft");c(this,"northDirection");c(this,"nativeZoomLevels");c(this,"tileSize");c(this,"perPixel");this.upperRight=t.upperRight,this.lowerRight=t.lowerRight,this.lowerLeft=t.lowerLeft,this.northDirection=t.northDirection,this.nativeZoomLevels=t.nativeZoomLevels||1,this.tileSize=t.tileSize,this.perPixel=1/(this.tileSize*Math.pow(2,this.nativeZoomLevels))}locationToLatLng(t){let o=.5-1/Math.pow(2,this.nativeZoomLevels+1),a=.5;if(this.northDirection===this.upperRight){const r=t.x;t.x=-t.z+15,t.z=r}else if(this.northDirection===this.lowerRight)t.x=-t.x+15,t.z=-t.z+15;else if(this.northDirection===this.lowerLeft){const r=t.x;t.x=t.z,t.z=-r+15}return o+=12*t.x*this.perPixel,a-=6*t.x*this.perPixel,o+=12*t.z*this.perPixel,a+=6*t.z*this.perPixel,o+=12*this.perPixel,a+=12*(256-t.y)*this.perPixel,new f.LatLng(-a*this.tileSize,o*this.tileSize)}latLngToLocation(t,o){const a=-t.lat/this.tileSize-.5,r=t.lng/this.tileSize-(.5-1/Math.pow(2,this.nativeZoomLevels+1)),n=Math.floor((r-2*a)/(24*this.perPixel))+(256-o),s=Math.floor((r+2*a)/(24*this.perPixel))-(256-o);return this.northDirection==this.upperRight?{x:s,y:o,z:-n+15}:this.northDirection==this.lowerRight?{x:-n+15,y:o,z:-o+15}:this.northDirection==this.lowerLeft?{x:-s+15,y:o,z:n}:{x:n,y:o,z:s}}}class ie extends he{constructor(o,a){super(o,a);c(this,"configurationAbort");c(this,"markersAbort");c(this,"markersRegex",/^overviewer.util.injectMarkerScript\('([\w.]+)'\);?$/mgi);c(this,"mapMarkerSets",new Map);c(this,"mapMarkers",Object.freeze(new Map));de(a,o,"map"),this.config.slice(-1)!=="/"&&(this.config=`${a}/`)}static buildServerConfig(o){return{title:E().state.initialTitle,singleMapWorlds:!1,expandUI:!1,defaultZoom:0,defaultMap:void 0,defaultWorld:void 0,followMap:void 0,followZoom:void 0}}static buildMessagesConfig(o){return{worldsHeading:"Worlds",playersHeading:"",chatPlayerJoin:"",chatPlayerQuit:"",chatAnonymousJoin:"",chatAnonymousQuit:"",chatErrorNotAllowed:"",chatErrorRequiresLogin:"",chatErrorCooldown:""}}buildWorlds(o){const a=o.CONST.tileSize,r=new Map;return(o.worlds||[]).forEach(n=>{r.set(n,{name:n,displayName:n,dimension:po(n),seaLevel:64,maps:new Set})}),(o.tilesets||[]).forEach(n=>{var O,U;if(!(n!=null&&n.world)||!r.has(n.world)){console.warn(`Ignoring tileset with unknown world ${n.world}`);return}const s=r.get(n.world),i=n.base?`${this.config}${n.base}/${n.path}`:this.config+n.path,l=n.base,p=n.imgextension,g=n.zoomLevels,y=n.minZoom,_=n.maxZoom;if(n.isOverlay)return;s.maps.add(new $t({world:s,name:n.path,displayName:n.name||n.path,baseUrl:i,tileSize:a,projection:new $l({upperRight:o.CONST.UPPERRIGHT,lowerLeft:o.CONST.LOWERLEFT,lowerRight:o.CONST.LOWERRIGHT,northDirection:n.north_direction,nativeZoomLevels:g,tileSize:a}),prefix:l,background:n.bgcolor,imageFormat:p,nativeZoomLevels:g,minZoom:y,maxZoom:_,defaultZoom:n.defaultZoom,center:{x:(n==null?void 0:n.center[0])||0,y:(n==null?void 0:n.center[1])||64,z:(n==null?void 0:n.center[2])||0},overlays:new Map}));const C=new Map,z=new Map;if(Array.isArray(n.spawn)){C.set("spawn",{id:"spawn",label:n.poititle,hidden:!1,priority:0});const w=new Map;w.set("spawn",{id:"spawn",type:W.POINT,iconUrl:this.config+((U=(O=o==null?void 0:o.CONST)==null?void 0:O.image)==null?void 0:U.spawnMarker),iconSize:[32,37],iconAnchor:[15,33],tooltip:"Spawn",location:{x:n.spawn[0]||0,y:n.spawn[1]||64,z:n.spawn[2]||0}}),z.set("spawn",w)}this.mapMarkerSets.set(n.path,C),this.mapMarkers.set(n.path,z)}),(o.tilesets||[]).forEach(n=>{var i;if(!n.isOverlay)return;const s={id:n.path,label:n.name||n.path,hidden:!0,priority:0,tileLayerOptions:{baseUrl:n.base?`${this.config}${n.base}/${n.path}`:this.config+n.path,tileSize:a,prefix:n.base,imageFormat:n.imgextension,nativeZoomLevels:n.zoomLevels,minZoom:n.minZoom,maxZoom:n.maxZoom}};(((i=r.get(n.world))==null?void 0:i.maps)||[]).forEach(l=>{var p;(!((p=n==null?void 0:n.tilesets)!=null&&p.length)||n.tilesets.includes(l.name))&&l.overlays.set(n.path,s)})}),Array.from(r.values())}static buildComponents(o){var r,n,s,i;const a={coordinatesControl:void 0,linkControl:!0,layerControl:(n=(r=o==null?void 0:o.map)==null?void 0:r.controls)==null?void 0:n.overlays,markers:{showLabels:!1},nightDay:{mode:"night_day",value:-1},players:{markers:void 0,imageUrl:ut,showImages:!1,grayHiddenPlayers:!1},chatBox:void 0,chatBalloons:!1,clockControl:void 0,logoControls:[],login:!1};return(i=(s=o==null?void 0:o.map)==null?void 0:s.controls)!=null&&i.coordsBox&&(a.coordinatesControl={showY:!1,label:"Location: ",showRegion:!0,showChunk:!1}),a}async getMarkerSets(){this.markersAbort=new AbortController;const o=await ie.getText(`${this.config}baseMarkers.js`,this.markersAbort.signal),a=o.matchAll(this.markersRegex);let r={},n={},s;for(const i of a){let l=await ie.getText(`${this.config}${i[1]}`,this.markersAbort.signal);switch(i[1]){case"markers.js":r=await ft(l+="return markers || {};");break;case"markersDB.js":n=await ft(l+="return markersDB || {};");break;default:s=await ft(`var markers = {}, markersDB = {}; ${l} return {markers, markersDB}`),r=Object.assign(r,s.markers),n=Object.assign(n,s.markersDB);break}}for(const i in r){if(!Object.prototype.hasOwnProperty.call(r,i)||!this.mapMarkerSets.has(i)){console.warn(`Ignoring unknown map ${i} in marker set list`);continue}r[i].forEach((l,p)=>{var y;this.mapMarkerSets.get(i).set(l.groupName,{id:l.groupName,hidden:!l.checked,label:l.displayName,priority:p});const g=new Map;(((y=n[l.groupName])==null?void 0:y.raw)||[]).forEach((_,C)=>{const z=`marker_${C}`;g.set(z,this.buildMarker(z,_,l))}),this.mapMarkers.get(i).set(l.groupName,g)})}}buildMarker(o,a,r){const n={id:o,tooltip:ae(a.hovertext.trim()),tooltipHTML:a.hovertext.trim(),popup:r.createInfoWindow?a.text:void 0,isPopupHTML:!0};return typeof a.points<"u"?(n.style={color:a.strokeColor,weight:a.strokeWeight,fill:a.fill},n.location=pt(Ht(a.points)),n.points=a.points,n.type=a.isLine?W.LINE:W.AREA):(n.type=W.POINT,n.location={x:a.x,y:a.y,z:a.z},n.iconUrl=this.config+(a.icon||r.icon)),n}async loadServerConfiguration(){this.configurationAbort&&this.configurationAbort.abort(),this.configurationAbort=new AbortController;const o=this.config,a=await ie.getText(`${o}overviewerConfig.js`,this.configurationAbort.signal);try{const r=await ft(a+" return overviewerConfig;");this.store.commit(m.SET_SERVER_CONFIGURATION,ie.buildServerConfig(r)),this.store.commit(m.SET_MESSAGES,ie.buildMessagesConfig(r)),this.store.commit(m.SET_WORLDS,this.buildWorlds(r)),this.store.commit(m.SET_COMPONENTS,ie.buildComponents(r)),await this.getMarkerSets()}catch(r){throw console.error(r),r}}async populateMap(o){this.store.commit(m.SET_MARKER_SETS,this.mapMarkerSets.get(o.name)||new Map),this.store.commit(m.SET_MARKERS,this.mapMarkers.get(o.name)||new Map)}createTileLayer(o){return new Il(o)}}const dt=document.getElementById("splash");dt&&dt.addEventListener("transitionend",e=>{e.target===dt&&dt.style.opacity==="0"&&(dt.hidden=!0)});console.info(`LiveAtlas version ${ee.state.version} - https://github.com/JLyne/LiveAtlas`);ee.subscribe((e,t)=>{(e.type==="toggleSidebarSectionCollapsedState"||e.type==="setSidebarSectionCollapsedState")&&localStorage.setItem("uiSettings",JSON.stringify({sidebar:t.ui.sidebar}))});At("dynmap",rt);At("pl3xmap",q);At("squaremap",q);At("overviewer",ie);const Ot=window.liveAtlasConfig;window.liveAtlasLoaded=!0;(async()=>{try{if(Ot.servers=Ga(Ot),await ee.dispatch(D.INIT,Ot),ee.state.servers.size>1){const t=window.location.pathname.split("/").pop(),o=t&&ee.state.servers.has(t)?t:ee.state.servers.keys().next().value;o!==t&&window.history.replaceState({},"",o+window.location.hash),ee.commit(m.SET_CURRENT_SERVER,o)}else ee.commit(m.SET_CURRENT_SERVER,ee.state.servers.keys().next().value);Ko(Ml).use(ee).use(Yo).use(Qo).mount("#app")}catch(e){e instanceof ue?(console.error("LiveAtlas configuration is invalid:",e),Tt(`LiveAtlas configuration is invalid:
`+e,!0)):(console.error("LiveAtlas failed to load:",e),Tt(`LiveAtlas failed to load:
`+e,!0))}})();
